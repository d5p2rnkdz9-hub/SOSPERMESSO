# v3.1 Milestone Audit

**Milestone:** v3.1 Prassi Locali + Notion-11ty Completion
**Audited:** 2026-02-14
**Status:** gaps_found

## Scores

| Category | Score | Details |
|----------|-------|---------|
| Requirements (formal) | 12/12 | DOC-01..04, PERM-01..04, BUILD-01..04 all satisfied |
| Requirements (roadmap) | 12/20 | PRASSI-01..04 unverified, CONTENT/COSTI/VALID/DIZIO not started |
| Phases | 3/8 functional | 39, 40, 42 passed. 41 has critical integration break. 43-46 pending |
| Integration | 8/9 wired | 1 critical break: prassi section not rendering in built document pages |
| E2E Flows | 2/5 complete | Document + permit rendering work. Prassi submit/vote/rebuild broken |

## Phase Status

| Phase | Name | Verification | Status |
|-------|------|-------------|--------|
| 39 | Document Pages | PASSED (8/8) | Functional |
| 40 | Permit Pages | PASSED (5/5) | Functional |
| 41 | Prassi Locali MVP | **NO VERIFICATION FILE** | **CRITICAL BREAK** |
| 42 | Build Pipeline | PASSED (12/12) | Functional |
| 43 | Populate Blank Permits | Not started | Pending |
| 44 | Costi Section | Not started | Pending |
| 45 | Content Validation | Not started | Pending |
| 46 | Dizionario Link Revision | Not started | Pending |

## Critical Gaps

### 1. Phase 41: Prassi Locali — Template Truncation (CRITICAL)

**Symptom:** Built document pages are missing the prassi locali section, CSS link, and JS script despite these being present in the source Liquid templates.

**Evidence:**
- Source template (documents-primo.liquid): 282 lines including prassi section at lines 168-211
- Built HTML output: ~252 lines — prassi CSS link (line 35), prassi section, and prassi.js script all absent
- All code exists (data file, CSS, JS, API functions) but is not wired into output

**Impact:**
- PRASSI-01 (submission form): NOT FUNCTIONAL — modal never loads
- PRASSI-02 (display section): NOT FUNCTIONAL — section not rendered
- PRASSI-03 (voting): NOT FUNCTIONAL — voting UI never enhances
- PRASSI-04 (moderation workflow): PARTIAL — Notion side works, display does not

**Orphaned artifacts:**
- `src/scripts/prassi.js` (715 lines) — copied to _site but never included
- `src/styles/prassi.css` (8.4KB) — copied to _site but never linked
- `netlify/functions/submit-prassi.mjs` — endpoint exists, no callers
- `netlify/functions/vote-prassi.mjs` — endpoint exists, no callers

**Root cause hypothesis:** Liquid conditional rendering issue or template truncation during 11ty build. Needs debugging.

### 2. Phase 41: Missing Verification File

Phase 41 has 3 plan summaries (01, 02, 03) but no VERIFICATION.md. Plan 04 (visual verification checkpoint) has a PLAN.md but no SUMMARY — suggesting it was never executed.

### 3. Requirements Tracking Gap

REQUIREMENTS.md tracks 12 requirements (DOC, PERM, BUILD) — all satisfied. But the ROADMAP lists additional requirements (PRASSI-01..04, CONTENT-01..02, COSTI-01..02, VALID-01..02, DIZIO-01..02) that are part of the v3.1 milestone scope but not tracked in REQUIREMENTS.md.

**8 additional requirements not formally tracked:**
- PRASSI-01..04 (Phase 41) — code exists but broken
- CONTENT-01..02 (Phase 43) — not started
- COSTI-01..02 (Phase 44) — not started
- VALID-01..02 (Phase 45) — not started
- DIZIO-01..02 (Phase 46) — not started

## Minor Issues

### 4. PRASSI_DB_ID Missing from .env.example

`.env.example` documents 3 env vars but omits PRASSI_DB_ID, which is required by `prassiLocali.js` and `submit-prassi.mjs`. Graceful degradation hides this silently.

### 5. Webhook File Evolution

Phase 41 created `notion-webhook.js`, Phase 42 upgraded to `notion-webhook.mjs` with debounce. Only .mjs exists (no conflict), but the extension change should be noted.

## Tech Debt (from Phase Verifications)

### Phase 39
- Old static document HTML files coexist with Liquid templates (ignored via eleventyConfig)

### Phase 40
- Liquid boolean gotcha documented (use `== true` not truthy)

### Phase 42
- Build time not precisely measured (requirement BUILD-03 says "under 120s" — verified as passing but exact time not recorded)

## Content Audit (from Phase 42)

28 issues across 47 pages:
- 8 permits missing document lists (Phase 43 scope)
- 11 overly long document names
- 3 vague/unclear wordings
- 2 duplicate names (Residenza elettiva, Motivi religiosi)
- 4 parent/child variants to verify

## E2E Flow Status

| Flow | Status | Break Point |
|------|--------|-------------|
| Document page rendering | WORKING | — |
| Permit page rendering | WORKING | — |
| Prassi submission | BROKEN | Template truncation — prassi.js never loads |
| Prassi voting | BROKEN | Template truncation — voting UI never enhances |
| Auto-rebuild (webhook) | PARTIAL | Code complete, deployment config pending |
| Redirect pages | WORKING | — |

---

*Audited: 2026-02-14*
*Auditor: Claude (gsd-integration-checker + manual verification)*
