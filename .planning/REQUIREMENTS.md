# Requirements: SOS Permesso v3.2

**Defined:** 2026-02-18
**Core Value:** Users can quickly find accurate, understandable information about their specific permit type and what documents they need for the Questura.

## v3.2 Requirements

Requirements for EN translation pipeline and incremental build caching.

### Notion Cache

- [x] **CACHE-01**: Notion API responses cached locally per page with `last_edited_time` tracking
- [x] **CACHE-02**: Build only re-fetches pages whose `last_edited_time` changed since last cache
- [x] **CACHE-03**: Cache clearable via `npm run cache:clear`

### Translation Script

- [ ] **TRANS-01**: `npm run translate` translates IT permit Q&A content to EN via Claude API
- [ ] **TRANS-02**: `npm run translate` translates IT document content (names, notes, methods) to EN via Claude API
- [ ] **TRANS-03**: Translations written back to Notion DB as EN properties/columns
- [ ] **TRANS-04**: Section-level hashing — only re-translates sections whose Italian source text changed
- [ ] **TRANS-05**: Translation glossary applied consistently (existing 35+ terms from v2.0)

### EN Page Generation

- [ ] **ENGEN-01**: EN permit pages generated by 11ty from Notion EN data (`/en/permesso-*.html`)
- [ ] **ENGEN-02**: EN document pages (primo + rinnovo) generated by 11ty from Notion EN data
- [ ] **ENGEN-03**: EN pages output at `/en/` prefix with correct asset paths
- [ ] **ENGEN-04**: Language switcher links correctly between IT and EN for all page types

### Static Pages

- [ ] **STATIC-01**: Static pages that changed since v2.0 are re-translated to EN

### Cleanup

- [ ] **CLEAN-01**: Old static EN files removed after generated replacements verified

## v3.1 Requirements (Complete)

<details>
<summary>All 20 requirements complete (Phases 39-44)</summary>

### Documents
- [x] **DOC-01**: 11ty data file fetches document data from Notion
- [x] **DOC-02**: Liquid template renders document pages (primo/rinnovo)
- [x] **DOC-03**: Generated pages have same URLs as current
- [x] **DOC-04**: Redirect pages generated via 11ty for URL aliases

### Permits
- [x] **PERM-01**: 11ty data file fetches permit data and page blocks from Notion
- [x] **PERM-02**: Liquid template renders permit Q&A pages
- [x] **PERM-03**: Flat permit pages (1 Notion page = 1 HTML page)
- [x] **PERM-04**: Generated pages have same URLs as current

### Build Pipeline
- [x] **BUILD-01**: Single `npm run build` command generates all pages
- [x] **BUILD-02**: Netlify configured with `NOTION_API_KEY` env var
- [x] **BUILD-03**: Build completes in under 120 seconds
- [x] **BUILD-04**: Old build scripts removed after migration verified

### Prassi Locali
- [x] **PRASSI-01**: Submission form on document pages
- [x] **PRASSI-02**: Prassi locali section with city filter
- [x] **PRASSI-03**: Upvote/downvote system
- [x] **PRASSI-04**: Manual moderation workflow

### Content Population
- [x] **CONTENT-01**: All placeholder permits populated
- [x] **CONTENT-02**: Generated pages render correctly

### Costi Section
- [x] **COSTI-01**: Cost data sourced from Notion
- [x] **COSTI-02**: Costi section rendered on document pages

</details>

## Deferred

| Feature | Reason |
|---------|--------|
| Content validation (VALID-01, VALID-02) | Deferred from v3.1 — translate what's there, validate later |
| Dizionario links (DIZIO-01, DIZIO-02) | Deferred from v3.1 — separate concern |
| Additional languages (FR, ES, ZH) | EN only for v3.2, architecture supports adding later |
| Sitemap updates for EN | Existing sitemap script works, update separately |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| CACHE-01 | Phase 47 | Complete |
| CACHE-02 | Phase 47 | Complete |
| CACHE-03 | Phase 47 | Complete |
| TRANS-01 | Phase 48 | Pending |
| TRANS-02 | Phase 48 | Pending |
| TRANS-03 | Phase 48 | Pending |
| TRANS-04 | Phase 48 | Pending |
| TRANS-05 | Phase 48 | Pending |
| ENGEN-01 | Phase 49 | Pending |
| ENGEN-02 | Phase 49 | Pending |
| ENGEN-03 | Phase 49 | Pending |
| ENGEN-04 | Phase 49 | Pending |
| STATIC-01 | Phase 50 | Pending |
| CLEAN-01 | Phase 50 | Pending |

**Coverage:**
- v3.2 requirements: 14 total
- Mapped to phases: 14 (100%)
- Unmapped: 0

---
*Requirements defined: 2026-02-18*
*Last updated: 2026-02-18 — traceability updated, all 14 requirements mapped to Phases 47-50*
