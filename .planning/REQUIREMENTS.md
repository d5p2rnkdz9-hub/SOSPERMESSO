# Requirements: SOS Permesso v4.0

**Defined:** 2026-02-18
**Core Value:** Users can quickly find accurate, understandable information about their specific permit type and what documents they need for the Questura.

## v4.0 Requirements

Requirements for French translation via the same Notion + 11ty pipeline as EN. ES follows in v4.1.

### Translation Script

- [ ] **TRANS-01**: `npm run translate --lang fr` translates IT permit Q&A and document content to French via Claude API
- [ ] **TRANS-03**: French translation glossary created (legal/immigration terms mapped to FR equivalents)
- [ ] **TRANS-05**: Section-level hashing prevents re-translating unchanged sections for FR (same mechanism as EN)

### Notion Database

- [ ] **NOTION-01**: French Notion database created with translated permit Q&A + document content

### FR Page Generation

- [ ] **FGEN-01**: FR permit pages generated by 11ty from Notion FR data at `/fr/permesso-*.html`
- [ ] **FGEN-02**: FR document pages (primo + rinnovo) generated by 11ty at `/fr/documenti-*-primo.html` and `/fr/documenti-*-rinnovo.html`
- [ ] **FGEN-03**: FR static pages (homepage, database listing, documenti-questura, chi-siamo) created at `/fr/`

### SEO

- [ ] **SEO-01**: Hreflang tags in base layout include FR alternate for all page types
- [ ] **SEO-02**: sitemap-fr.xml added to sitemap index with hreflang cross-references

## v3.2 Requirements (Complete)

<details>
<summary>All 14 requirements complete (Phases 47-50)</summary>

### Notion Cache
- [x] **CACHE-01**: Notion API responses cached locally per page with `last_edited_time` tracking
- [x] **CACHE-02**: Build only re-fetches pages whose `last_edited_time` changed since last cache
- [x] **CACHE-03**: Cache clearable via `npm run cache:clear`

### Translation Script
- [x] **TRANS-EN-01**: `npm run translate` translates IT permit Q&A content to EN via Claude API
- [x] **TRANS-EN-02**: `npm run translate` translates IT document content (names, notes, methods) to EN via Claude API
- [x] **TRANS-EN-03**: Translations written back to Notion DB as EN properties/columns
- [x] **TRANS-EN-04**: Section-level hashing — only re-translates sections whose Italian source text changed
- [x] **TRANS-EN-05**: Translation glossary applied consistently (existing 35+ terms from v2.0)

### EN Page Generation
- [x] **ENGEN-01**: EN permit pages generated by 11ty from Notion EN data (`/en/permesso-*.html`)
- [x] **ENGEN-02**: EN document pages (primo + rinnovo) generated by 11ty from Notion EN data
- [x] **ENGEN-03**: EN pages output at `/en/` prefix with correct asset paths
- [x] **ENGEN-04**: Language switcher links correctly between IT and EN for all page types

### Static Pages + Cleanup
- [x] **STATIC-01**: Static pages that changed since v2.0 are re-translated to EN
- [x] **CLEAN-01**: Old static EN files removed after generated replacements verified

</details>

## v3.1 Requirements (Complete)

<details>
<summary>All 20 requirements complete (Phases 39-44)</summary>

### Documents
- [x] **DOC-01**: 11ty data file fetches document data from Notion
- [x] **DOC-02**: Liquid template renders document pages (primo/rinnovo)
- [x] **DOC-03**: Generated pages have same URLs as current
- [x] **DOC-04**: Redirect pages generated via 11ty for URL aliases

### Permits
- [x] **PERM-01**: 11ty data file fetches permit data and page blocks from Notion
- [x] **PERM-02**: Liquid template renders permit Q&A pages
- [x] **PERM-03**: Flat permit pages (1 Notion page = 1 HTML page)
- [x] **PERM-04**: Generated pages have same URLs as current

### Build Pipeline
- [x] **BUILD-01**: Single `npm run build` command generates all pages
- [x] **BUILD-02**: Netlify configured with `NOTION_API_KEY` env var
- [x] **BUILD-03**: Build completes in under 120 seconds
- [x] **BUILD-04**: Old build scripts removed after migration verified

### Prassi Locali
- [x] **PRASSI-01**: Submission form on document pages
- [x] **PRASSI-02**: Prassi locali section with city filter
- [x] **PRASSI-03**: Upvote/downvote system
- [x] **PRASSI-04**: Manual moderation workflow

### Content Population
- [x] **CONTENT-01**: All placeholder permits populated
- [x] **CONTENT-02**: Generated pages render correctly

### Costi Section
- [x] **COSTI-01**: Cost data sourced from Notion
- [x] **COSTI-02**: Costi section rendered on document pages

</details>

## Deferred

| Feature | Reason |
|---------|--------|
| Content validation (VALID-01, VALID-02) | Deferred from v3.1 — validate content separately |
| Dizionario links (DIZIO-01, DIZIO-02) | Deferred from v3.1 — separate concern |
| ES translation script (TRANS-02) | FR first — ES in v4.1 if FR pipeline works well |
| ES translation glossary (TRANS-04) | FR first — ES in v4.1 if FR pipeline works well |
| ES Notion database (NOTION-02) | FR first — ES in v4.1 if FR pipeline works well |
| ES page generation (ESGEN-01, ESGEN-02, ESGEN-03) | FR first — ES in v4.1 if FR pipeline works well |
| Additional languages (ZH, AR) | FR/ES only for v4.x, architecture supports adding later |
| Language switcher in nav bar | Tech debt — current dropdown works for now |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| TRANS-01 | Phase 51 | Pending |
| TRANS-03 | Phase 51 | Pending |
| TRANS-05 | Phase 51 | Pending |
| NOTION-01 | Phase 52 | Pending |
| FGEN-01 | Phase 53 | Pending |
| FGEN-02 | Phase 53 | Pending |
| FGEN-03 | Phase 53 | Pending |
| SEO-01 | Phase 54 | Pending |
| SEO-02 | Phase 54 | Pending |

**Coverage:**
- v4.0 requirements: 9 total
- Mapped to phases: 9/9 (100%)
- Unmapped: 0

---
*Requirements defined: 2026-02-18*
*Last updated: 2026-02-18 — scoped to FR only; ES requirements moved to Deferred*
