---
phase: 53.1-tech-debt
plan: 01
subsystem: ui
tags: [typeform, footer, netlify, liquid, redirects]

# Dependency graph
requires:
  - phase: 53-fr-page-generation
    provides: FR permit templates (permits-fr.liquid) that needed the same Typeform fix
provides:
  - Typeform G6YT01Vj wired to Scrivici/Contact us/Contactez-nous CTA on all permit pages (IT/EN/FR)
  - Footer "Contattaci/Contact Us/Contactez-nous" link to Typeform in all three languages
  - External link handling in footer.liquid (target=_blank, no url filter mangling)
  - Netlify 301 redirects for /index.html -> / (IT/EN/FR)
affects: [54-seo-phase, future-permit-templates]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "external: true property on footer links triggers target=_blank rendering without url filter"
    - "Netlify redirects for homepage canonical URLs before security headers section"

key-files:
  created: []
  modified:
    - src/pages/permits.liquid
    - en/src/pages/permits-en.liquid
    - fr/src/pages/permits-fr.liquid
    - _data/footer.js
    - _includes/components/footer.liquid
    - netlify.toml

key-decisions:
  - "Removed dead contact-form-container div + fetch script from all three permit templates since contact modal is replaced by direct Typeform link"
  - "Footer external links use raw href (not url filter) with target=_blank to prevent Netlify/11ty URL mangling"

patterns-established:
  - "Footer link pattern: { label, href, external: true } for external links in footer.js"
  - "Netlify redirect blocks go before [[headers]] section in netlify.toml"

# Metrics
duration: 2min
completed: 2026-02-19
---

# Phase 53.1 Plan 01: Tech Debt Fixes Summary

**Typeform G6YT01Vj wired to permit page CTA buttons (IT/EN/FR) and footer Contattaci link added; Netlify 301 redirects for homepage canonical URLs**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-19T10:20:18Z
- **Completed:** 2026-02-19T10:21:46Z
- **Tasks:** 2
- **Files modified:** 6

## Accomplishments
- Replaced broken `openContactModal()` button with direct Typeform link on all three permit templates (IT, EN, FR); removed dead contact-form-container div and fetch script
- Added "Contattaci / Contact Us / Contactez-nous" footer link pointing to Typeform G6YT01Vj in all three language footers
- Updated footer.liquid to conditionally render external links with `target="_blank"` (bypassing the `url` filter that would mangle absolute Typeform URLs)
- Added 301 redirects in netlify.toml for `/index.html` → `/`, `/en/index.html` → `/en/`, `/fr/index.html` → `/fr/` to fix homepage canonical duplication

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix Scrivici Typeform button on permit pages** - `9194f38` (fix)
2. **Task 2: Add Contattaci footer item and fix homepage canonical + redirects** - `2288ada` (fix)

**Plan metadata:** (docs commit below)

## Files Created/Modified
- `src/pages/permits.liquid` - Scrivici button now links to Typeform; contact-form-container removed
- `en/src/pages/permits-en.liquid` - Contact us button now links to Typeform; contact-form-container removed
- `fr/src/pages/permits-fr.liquid` - Contactez-nous button now links to Typeform; contact-form-container removed
- `_data/footer.js` - Added external Typeform link entry for IT/EN/FR
- `_includes/components/footer.liquid` - Added `{% if link.external %}` branch for target=_blank rendering
- `netlify.toml` - Added three 301 redirect rules for homepage canonical URLs

## Decisions Made
- Removed the dead `<div id="contact-form-container">` and its `fetch()` script from all permit templates — these relied on a `/src/components/contact-form.html` file that no longer drives the CTA, so they were dead weight
- Used `external: true` property pattern on footer links instead of checking if href starts with `http` — more explicit and maintainable

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Permit page Typeform CTA is now functional for all languages
- Footer shows contact link in all three languages
- Homepage canonical redirect is handled at CDN level via Netlify
- Ready for Phase 53.1 Plan 02 (next tech debt item)

---
*Phase: 53.1-tech-debt*
*Completed: 2026-02-19*
