---
phase: 53.1-tech-debt
verified: 2026-02-19T11:18:08Z
status: passed
score: 7/7 must-haves verified
re_verification: false
---

# Phase 53.1: Tech Debt Verification Report

**Phase Goal:** Fix 7 accumulated tech debt issues before SEO work: broken sitemap generation, missing permits in listing pages, homepage canonical duplication, missing dizionario links in EN/FR, broken "Scrivici" Typeform button, missing "Contattaci" footer item, and language switcher integration into main nav.
**Verified:** 2026-02-19T11:18:08Z
**Status:** passed
**Re-verification:** No — initial verification

---

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Sitemap generated by 11ty with correct URLs | VERIFIED | 4 liquid templates at src/pages/sitemap-{it,en,fr,index}.liquid with `.xml` permalinks; pages.11tydata.js has .xml bypass; old static XML files removed from root |
| 2 | database.html lists all generated permits (IT=41, EN=39, FR=39) | VERIFIED | grep -Eo count: IT=41, EN=39, FR=39 unique permesso- slugs confirmed |
| 3 | documenti-questura.html lists all documents (IT=41, EN=39, FR=39) | VERIFIED | badge-primo count: IT=41, EN=39, FR=39 confirmed |
| 4 | Homepage canonical 301 redirects in netlify.toml | VERIFIED | /index.html → /, /en/index.html → /en/, /fr/index.html → /fr/ with status=301, force=true |
| 5 | Dizionario links appear in EN and FR pages | VERIFIED | dizionario-map.json has 32 EN + 29 FR terms (130 total); linkToDizionario accepts lang param; all 4 EN/FR templates call `linkToDizionario: lang` |
| 6 | "Scrivici" button links to correct Typeform G6YT01Vj | VERIFIED | All three permit templates (IT/EN/FR) have `href="https://form.typeform.com/to/G6YT01Vj"`; openContactModal removed |
| 7 | "Contattaci" in footer + language switcher in nav | VERIFIED | footer.js has external Contattaci/Contact Us/Contactez-nous entries; footer.liquid renders target=_blank; nav.liquid has nav-language as first item with flag emojis; header.liquid no longer includes language-switcher.liquid |

**Score:** 7/7 truths verified

---

## Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `src/pages/sitemap-it.liquid` | IT sitemap template | VERIFIED | Exists, 57 lines, iterates permits/documents data, permalink: sitemap-it.xml |
| `src/pages/sitemap-en.liquid` | EN sitemap template | VERIFIED | Exists, permalink: sitemap-en.xml |
| `src/pages/sitemap-fr.liquid` | FR sitemap template | VERIFIED | Exists, permalink: sitemap-fr.xml |
| `src/pages/sitemap-index.liquid` | Sitemap index | VERIFIED | Exists, 16 lines, points to all 3 language sitemaps |
| `src/pages/pages.11tydata.js` | .xml permalink bypass | VERIFIED | Has `if permalink.endsWith('.xml') return permalink` check |
| Root `sitemap-*.xml` | Removed (old static files) | VERIFIED | No sitemap-*.xml files at project root |
| `src/pages/database.html` | 41 IT permit links | VERIFIED | 41 unique permesso- slugs |
| `en/src/pages/database.html` | 39 EN permit links | VERIFIED | 39 unique permesso- slugs |
| `fr/src/pages/database.html` | 39 FR permit links | VERIFIED | 39 unique permesso- slugs |
| `src/pages/documenti-questura.html` | 41 IT document entries | VERIFIED | 41 badge-primo elements |
| `en/src/pages/documenti-questura.html` | 39 EN document entries | VERIFIED | 39 badge-primo elements |
| `fr/src/pages/documenti-questura.html` | 39 FR document entries | VERIFIED | 39 badge-primo elements |
| `netlify.toml` | 3 homepage 301 redirects | VERIFIED | All three redirects before [[headers]] section |
| `scripts/templates/dizionario-map.json` | EN and FR term entries | VERIFIED | 134 lines, includes EN and FR translated terms (32 EN + 29 FR) |
| `scripts/templates/helpers.js` | linkToDizionario accepts lang | VERIFIED | Function signature `linkToDizionario(documentName, lang)`, null-safe default to 'it' |
| `en/src/pages/documents-primo-en.liquid` | Calls linkToDizionario with lang | VERIFIED | `linkToDizionario: lang` at line 106; frontmatter has `lang: en` |
| `en/src/pages/documents-rinnovo-en.liquid` | Calls linkToDizionario with lang | VERIFIED | `linkToDizionario: lang` at lines 121, 139 |
| `fr/src/pages/documents-primo-fr.liquid` | Calls linkToDizionario with lang | VERIFIED | `linkToDizionario: lang` at line 106; frontmatter has `lang: fr` |
| `fr/src/pages/documents-rinnovo-fr.liquid` | Calls linkToDizionario with lang | VERIFIED | `linkToDizionario: lang` at lines 121, 139 |
| `src/pages/permits.liquid` | Typeform G6YT01Vj, no openContactModal | VERIFIED | Typeform link present; openContactModal absent |
| `en/src/pages/permits-en.liquid` | Typeform G6YT01Vj | VERIFIED | Confirmed |
| `fr/src/pages/permits-fr.liquid` | Typeform G6YT01Vj | VERIFIED | Confirmed |
| `_data/footer.js` | Contattaci with external: true | VERIFIED | All three language entries with `external: true` and Typeform URL |
| `_includes/components/footer.liquid` | Renders external links with target=_blank | VERIFIED | `{% if link.external %}` branch confirmed |
| `_includes/components/nav.liquid` | Language dropdown as first nav item | VERIFIED | nav-language li as first item in ul.nav-menu; flag emojis; Liquid URL computation for IT/EN/FR |
| `_includes/components/header.liquid` | No language-switcher.liquid include | VERIFIED | Only includes `components/nav.liquid`; language-switcher.liquid not referenced |
| `src/styles/mobile.css` | nav-language pill styles | VERIFIED | `.nav-language` with `order: -1`, flex row pills, active-lang styling |
| `src/styles/components.css` | nav-language desktop styles | VERIFIED | `.nav-language .nav-link` and `.nav-language .active-lang` defined |
| `eleventy.config.mjs` | linkToDizionario filter registered; sitemap passthrough removed | VERIFIED | Filter registered at line ~109; comment confirms XML files now generated by 11ty |

---

## Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| sitemap-it.liquid | permits data | for permit in permits | WIRED | Liquid for-loop iterates permits array directly |
| sitemap-it.liquid | documents data | for doc in documents.primo/rinnovo | WIRED | Iterates documents.primo and documents.rinnovo arrays |
| pages.11tydata.js | sitemap permalinks | .xml bypass | WIRED | `permalink.endsWith('.xml')` check passes through .xml permalinks unchanged |
| EN/FR templates | linkToDizionario filter | `lang` frontmatter variable | WIRED | `lang: en` / `lang: fr` in frontmatter flows to `linkToDizionario: lang` calls |
| linkToDizionario | dizionario-map.json | require() at helpers.js top | WIRED | `const dizionarioMap = require('./scripts/templates/dizionario-map.json')` |
| footer.liquid | footer.js external entries | `{% if link.external %}` | WIRED | External branch renders `target="_blank"` without url filter |
| nav.liquid | page.url | Liquid replace_first/append | WIRED | URL computation derives IT/EN/FR URLs from current `page.url` |
| permits.liquid | Typeform G6YT01Vj | direct href | WIRED | `<a href="https://form.typeform.com/to/G6YT01Vj">` |
| netlify.toml | /index.html redirects | [[redirects]] blocks | WIRED | Three redirect rules before [[headers]] section |

---

## Anti-Patterns Found

No blockers or warnings found in key modified files.

| File | Pattern | Severity | Notes |
|------|---------|----------|-------|
| `_includes/components/language-switcher.liquid` | Orphaned file (not included anywhere) | Info | Old standalone component kept on disk but no longer included; can be deleted later as noted in decisions |

---

## Human Verification Required

The following items cannot be verified programmatically and should be checked by a human during the next deploy:

### 1. Language Switcher Visual Appearance

**Test:** Open the site on desktop and mobile, look at the navigation bar.
**Expected:** Language switcher appears as first nav item (before Database, Guide, etc.) on desktop as a dropdown; on mobile hamburger menu it appears as horizontal pill buttons at the very top.
**Why human:** CSS visual layout and hamburger interaction cannot be verified by grep.

### 2. Sitemap XML Output Correctness

**Test:** After a full build, open `_site/sitemap-it.xml` and check that URLs are clean (no `src/pages/` prefix) and `_site/sitemap-index.xml` points to all three language sitemaps.
**Expected:** URLs like `https://www.sospermesso.it/permesso-lavoro-subordinato.html` (no path prefix); sitemap-index.xml lists all three language sitemaps.
**Why human:** Build not run during verification; file inspection covers template structure but not rendered output.

### 3. Typeform CTA on Permit Pages

**Test:** Open any permit page (e.g., permesso-lavoro-subordinato.html) and click the "Scrivici" / "Contact us" / "Contactez-nous" button.
**Expected:** Typeform at form.typeform.com/to/G6YT01Vj opens in a new tab.
**Why human:** External service link-click behavior.

### 4. Dizionario Links in EN/FR Document Pages

**Test:** Open any EN or FR document page (e.g., en/documenti-lavoro-subordinato-primo.html) and check if dizionario-mapped terms (e.g., "Questura", "permit", "Authorization") appear as clickable links.
**Expected:** Terms linking to `/dizionario.html` (absolute root path) appear highlighted/linked in the document list.
**Why human:** Requires actual render with live Notion data; whether terms actually appear in EN/FR document names depends on Notion content.

---

## Summary

All 7 tech debt items have been implemented correctly. Every artifact exists, is substantive, and is wired into the system. The key structural verifications are:

- **DEBT-01 (Sitemap):** 4 Liquid sitemap templates in `src/pages/` with correct `.xml` permalinks; `pages.11tydata.js` bypass prevents permalink override; old static XML files removed.
- **DEBT-02 (Listing pages):** All 6 listing pages updated — IT at 41 entries, EN/FR at 39 each for both database.html and documenti-questura.html.
- **DEBT-03 (Homepage canonical):** Three 301 redirects in netlify.toml (`/index.html` → `/`, `/en/index.html` → `/en/`, `/fr/index.html` → `/fr/`).
- **DEBT-04 (Dizionario EN/FR):** 130-term dizionario-map.json with EN/FR translations; language-aware `linkToDizionario(doc, lang)` helper; all 4 EN/FR document templates pass `lang` from frontmatter.
- **DEBT-05 (Scrivici button):** All three permit templates (IT/EN/FR) link to `https://form.typeform.com/to/G6YT01Vj`; dead `openContactModal` references removed.
- **DEBT-06 (Contattaci footer):** `_data/footer.js` has `external: true` Contattaci entries for IT/EN/FR; `footer.liquid` renders `target="_blank"` for external links.
- **DEBT-07 (Language switcher in nav):** `nav.liquid` has `.nav-language` as the first `has-dropdown` item with Liquid URL computation and flag emojis; `header.liquid` no longer includes standalone `language-switcher.liquid`; mobile pill styles in `mobile.css` with `order: -1`.

The phase goal is fully achieved.

---

_Verified: 2026-02-19T11:18:08Z_
_Verifier: Claude (gsd-verifier)_
