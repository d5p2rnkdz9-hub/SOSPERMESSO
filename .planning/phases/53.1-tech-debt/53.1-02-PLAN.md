---
phase: 53.1-tech-debt
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/database.html
  - en/src/pages/database.html
  - fr/src/pages/database.html
  - src/pages/documenti-questura.html
  - en/src/pages/documenti-questura.html
  - fr/src/pages/documenti-questura.html
autonomous: true

must_haves:
  truths:
    - "Every generated permit page has a corresponding entry in its language's database.html"
    - "Every generated document page has a corresponding entry in its language's documenti-questura.html"
    - "IT, EN, and FR listing pages are in sync (same slugs, same categories)"
  artifacts:
    - path: "src/pages/database.html"
      provides: "IT permit listing with all generated permits"
      min_lines: 130
    - path: "en/src/pages/database.html"
      provides: "EN permit listing matching IT structure"
      min_lines: 130
    - path: "fr/src/pages/database.html"
      provides: "FR permit listing matching IT structure"
      min_lines: 130
    - path: "src/pages/documenti-questura.html"
      provides: "IT document listing with all generated document pages"
      min_lines: 200
    - path: "en/src/pages/documenti-questura.html"
      provides: "EN document listing matching IT structure"
      min_lines: 200
    - path: "fr/src/pages/documenti-questura.html"
      provides: "FR document listing matching IT structure"
      min_lines: 200
  key_links:
    - from: "src/pages/database.html"
      to: "permesso-*.html"
      via: "anchor hrefs"
      pattern: "permesso-[a-z-]+\\.html"
    - from: "src/pages/documenti-questura.html"
      to: "documenti-*-primo.html"
      via: "anchor hrefs"
      pattern: "documenti-[a-z-]+-primo\\.html"
---

<objective>
Add all missing permits and documents to the listing pages (database.html and documenti-questura.html) across IT, EN, and FR so every generated page is discoverable from the listing.

Purpose: Users currently cannot find 13+ permits from the database listing page because they were added to Notion but never added to the hardcoded listing pages.
Output: All 6 listing pages (IT/EN/FR x database/documenti-questura) updated with complete permit/document coverage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/53.1-tech-debt/53.1-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and update database.html (IT, EN, FR)</name>
  <files>src/pages/database.html, en/src/pages/database.html, fr/src/pages/database.html</files>
  <action>
**Step 1: Discover all generated permits.**
Run `npm run build` (or check existing `_site/` output) and list all generated `permesso-*.html` files at root level. Compare this list against the permits currently listed in `src/pages/database.html`.

Alternative: Read `_data/permits.js` output (the data file) to get the authoritative list of permit slugs generated by 11ty. The permits data returns objects with `.slug` and `.tipo` properties.

**Step 2: Identify missing permits.**
The current IT database.html lists ~28 permits across 4 categories. The Notion database has 43 permits for IT (39 for EN/FR, since 4 permits are filtered at Notion DB level). Find which slugs are in the generated output but NOT in database.html.

Expected final counts:
- IT database.html: ~43 permits (matching all IT Notion entries)
- EN database.html: ~39 permits (matching EN Notion entries)
- FR database.html: ~39 permits (matching FR Notion entries)

Known missing permits (from context: "13 missing permits") likely include permits like:
- Protezione sociale (vittime di tratta, art. 18)
- Protezione sociale (violenza domestica, art. 18-bis)
- Sfruttamento lavorativo (art. 18-ter)
- Familiari di titolari di status di rifugiato o protezione sussidiaria
- Lavoro autonomo (conversione) — already listed, double-check
- Others that were populated in Phase 43 but never added to listing pages

**Step 3: Add missing permits to correct categories in IT database.html.**
Follow the existing HTML pattern exactly:
```html
<li><a href="permesso-{slug}.html" class="permit-link"><span class="icon">{emoji}</span><span class="title">{Italian title}</span></a></li>
```

Place each permit in the correct category (STUDIO/LAVORO, PROTEZIONE, CURE MEDICHE, MOTIVI FAMILIARI). If a permit doesn't fit an existing category, create a new category section (e.g., "ALTRI PERMESSI" with an appropriate color like `category-green` or use an existing color).

**Step 4: Update EN and FR database.html.**
Mirror the same additions in EN and FR database pages:
- EN: Use translated English titles (check the EN permit data or translate from IT titles following existing patterns in the EN page)
- FR: Use translated French titles (check the FR permit data or translate from IT titles following existing patterns in the FR page)
- All three pages MUST have the same slugs (same `href` values) — only the display `title` text differs.
- EN/FR pages should list only permits that exist in their respective Notion databases (~39 each). If a permit exists in IT but not EN/FR, omit it from the EN/FR listing.

**Important:** The listing pages use relative paths (e.g., `permesso-{slug}.html` not `/permesso-{slug}.html`). EN/FR pages also use relative paths since they render at `en/database.html` and `fr/database.html` respectively, and the permit pages are at `en/permesso-{slug}.html` etc.
  </action>
  <verify>
  Count the number of permit links in each database.html and compare against generated pages:
  grep -c "permesso-" src/pages/database.html (expected: ~43, matching IT generated permits)
  grep -c "permesso-" en/src/pages/database.html (expected: ~39, matching EN generated permits)
  grep -c "permesso-" fr/src/pages/database.html (expected: ~39, matching FR generated permits)
  Cross-check: ls _site/permesso-*.html | wc -l (should match IT count)
  Cross-check: ls _site/en/permesso-*.html | wc -l (should match EN count)
  </verify>
  <done>IT, EN, and FR database.html pages list every generated permit with correct slugs, titles, and categories. IT lists ~43 permits; EN/FR list ~39 each (4 permits filtered at Notion DB level). No generated permit is missing from the listing.</done>
</task>

<task type="auto">
  <name>Task 2: Audit and update documenti-questura.html (IT, EN, FR)</name>
  <files>src/pages/documenti-questura.html, en/src/pages/documenti-questura.html, fr/src/pages/documenti-questura.html</files>
  <action>
**Step 1: Discover all generated document pages.**
List all generated `documenti-*-primo.html` files. Each permit should have both a primo and a rinnovo document page. Compare against what's currently listed in `src/pages/documenti-questura.html`.

**Step 2: Identify missing document entries.**
The IT documenti-questura.html currently lists entries matching the database.html categories. Every permit in database.html should have a corresponding row in documenti-questura.html with [Primo] and [Rinnovo] badge links.

Expected final counts (matching database.html):
- IT documenti-questura.html: ~43 entries with primo+rinnovo badges
- EN documenti-questura.html: ~39 entries
- FR documenti-questura.html: ~39 entries

**Step 3: Add missing entries to IT documenti-questura.html.**
Follow the existing HTML pattern:
```html
<li>
  <div class="permit-link-wrapper">
    <div class="permit-info">
      <span class="icon">{emoji}</span>
      <span class="title">{Italian title}</span>
    </div>
    <div class="badge-group">
      <a href="documenti-{slug}-primo.html" class="doc-badge badge-primo">Primo</a>
      <a href="documenti-{slug}-rinnovo.html" class="doc-badge badge-rinnovo">Rinnovo</a>
    </div>
  </div>
</li>
```

Place each in the correct category, matching the same categories used in database.html.

**Step 4: Update EN and FR documenti-questura.html.**
Mirror all additions with translated titles. Badge labels stay as "Primo" / "Rinnovo" in IT; use "First" / "Renewal" in EN; use "Premier" / "Renouvellement" in FR (match existing badge labels in each language version).

Ensure the same slug structure is used across all three languages.
  </action>
  <verify>
  Count document entries in each version and compare against generated pages:
  grep -c "badge-primo" src/pages/documenti-questura.html (expected: ~43, matching IT permits)
  grep -c "badge-primo" en/src/pages/documenti-questura.html (expected: ~39, matching EN permits)
  grep -c "badge-primo" fr/src/pages/documenti-questura.html (expected: ~39, matching FR permits)
  Cross-check: ls _site/documenti-*-primo.html | wc -l (should match IT count)
  Cross-check: ls _site/en/documenti-*-primo.html | wc -l (should match EN count)
  </verify>
  <done>IT, EN, and FR documenti-questura.html pages list every generated document page with correct primo/rinnovo badge links. IT lists ~43 entries; EN/FR list ~39 each. No generated document page is missing from the listing.</done>
</task>

</tasks>

<verification>
1. Every `permesso-*.html` in `_site/` has a matching entry in `src/pages/database.html`
2. Every `documenti-*-primo.html` in `_site/` has a matching entry in `src/pages/documenti-questura.html`
3. IT, EN, FR listing pages have identical slug coverage for shared permits (same hrefs, different display titles)
4. All new entries are placed in correct categories
5. IT has ~43 permits/docs; EN/FR have ~39 each
</verification>

<success_criteria>
- database.html (IT/EN/FR) lists all generated permits with no gaps
- documenti-questura.html (IT/EN/FR) lists all generated document pages with Primo + Rinnovo badges
- All three language versions have matching permit/document coverage for their respective generated pages
</success_criteria>

<output>
After completion, create `.planning/phases/53.1-tech-debt/53.1-02-SUMMARY.md`
</output>
