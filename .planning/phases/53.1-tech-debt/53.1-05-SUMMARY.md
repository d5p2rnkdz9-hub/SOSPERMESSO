---
phase: 53.1-tech-debt
plan: 05
subsystem: ui
tags: [dizionario, linking, multilingual, helpers, liquid, eleventy]

# Dependency graph
requires:
  - phase: 53-fr-page-generation
    provides: FR document templates (documents-primo-fr.liquid, documents-rinnovo-fr.liquid)
  - phase: 53.1-tech-debt (plan 01-04)
    provides: FR infrastructure and templates

provides:
  - dizionario-map.json with EN and FR translated term equivalents (130 total terms)
  - linkToDizionario filter that is language-aware (relative path for IT, absolute for EN/FR)
  - EN and FR document templates updated to call linkToDizionario with lang parameter

affects:
  - Any future language additions (copy pattern: pass lang from frontmatter to linkToDizionario)
  - Future dizionario expansion (add terms to JSON, they auto-link in all 3 languages)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Language-aware URL generation: pass lang from Liquid frontmatter to JS filter; filter uses lang to decide relative vs absolute base URL"
    - "Null-safe lang default: internal JS calls without lang param default to 'it'; external template calls pass lang from frontmatter"
    - "Single term mapping: all languages map to same IT anchor IDs (one dizionario page, IT as source of truth)"

key-files:
  created: []
  modified:
    - scripts/templates/dizionario-map.json
    - scripts/templates/helpers.js
    - en/src/pages/documents-primo-en.liquid
    - en/src/pages/documents-rinnovo-en.liquid
    - fr/src/pages/documents-primo-fr.liquid
    - fr/src/pages/documents-rinnovo-fr.liquid
    - src/pages/documents-primo.liquid
    - src/pages/documents-rinnovo.liquid

key-decisions:
  - "Absolute path /dizionario.html for EN/FR (served at /en/ and /fr/ prefix); relative dizionario.html for IT (at root)"
  - "Null-safe guard: linkToDizionario(doc, lang) where lang defaults to 'it' when nil - allows internal formatNotesContent() call to remain unchanged"
  - "Single IT dizionario page is source of truth; all EN/FR links point there (no translated dizionario pages)"

patterns-established:
  - "Filter lang-awareness pattern: pass lang from Liquid frontmatter variable; JS filter checks lang to pick URL prefix"
  - "Translation term mapping: add both cased variants (Title Case and lowercase) for each translated term to catch all occurrences"

# Metrics
duration: 3min
completed: 2026-02-19
---

# Phase 53.1 Plan 05: Dizionario EN/FR Linking Summary

**Expanded dizionario-map.json with 62 EN/FR term translations and made linkToDizionario filter language-aware so EN/FR document pages link to IT dizionario with correct absolute URLs**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-19T10:23:23Z
- **Completed:** 2026-02-19T10:26:01Z
- **Tasks:** 2
- **Files modified:** 8

## Accomplishments

- Added 32 English and 29 French translated term equivalents to dizionario-map.json (72 IT + 62 EN/FR = 130 total terms)
- Made `linkToDizionario` filter language-aware: EN/FR pages use absolute `/dizionario.html`, IT uses relative `dizionario.html`
- Updated all 4 EN/FR document templates (primo + rinnovo for each language) to call `linkToDizionario: lang`
- Updated IT templates for consistency (passing `lang` which is nil, defaults safely to 'it')
- Internal `formatNotesContent()` call to `linkToDizionario(bullet)` remains unchanged (no lang = defaults to IT)

## Task Commits

Each task was committed atomically:

1. **Task 1: Expand dizionario-map.json with EN and FR term equivalents** - `71414a6` (feat)
2. **Task 2: Make linkToDizionario language-aware and add EN/FR template calls** - `043675e` (feat)

## Files Created/Modified

- `scripts/templates/dizionario-map.json` - Added 32 EN + 29 FR translated term equivalents (62 new entries)
- `scripts/templates/helpers.js` - linkToDizionario now accepts `lang` param; uses `/dizionario.html` for EN/FR, `dizionario.html` for IT
- `en/src/pages/documents-primo-en.liquid` - docLabel now uses `linkToDizionario: lang` instead of `escapeHtml`
- `en/src/pages/documents-rinnovo-en.liquid` - commonDocLabel + docLabel now use `linkToDizionario: lang`
- `fr/src/pages/documents-primo-fr.liquid` - docLabel now uses `linkToDizionario: lang` instead of `escapeHtml`
- `fr/src/pages/documents-rinnovo-fr.liquid` - commonDocLabel + docLabel now use `linkToDizionario: lang`
- `src/pages/documents-primo.liquid` - IT docLabel updated to pass `lang` for consistency
- `src/pages/documents-rinnovo.liquid` - IT commonDocLabel + docLabel updated to pass `lang`

## Decisions Made

- **Absolute vs relative path:** EN/FR pages live at `/en/` and `/fr/` prefix, so need `/dizionario.html` (absolute from root). IT pages at root use relative `dizionario.html`. The lang parameter in the filter determines which to use.
- **IT dizionario as single source of truth:** No translated dizionario pages. All EN/FR links point to the IT dizionario page. This keeps maintenance simple.
- **Null-safe guard pattern:** `if (!lang) lang = 'it'` ensures internal JS calls from `formatNotesContent()` work without modification - they default to IT paths.
- **Both cased variants in map:** Added both "Questura" and "questura" style pairs for translated terms so case-insensitive matching catches all document name patterns.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Plan 05 is the final plan in phase 53.1-tech-debt
- All 5 tech debt plans complete
- Dizionario linking now works across IT, EN, and FR document pages
- To add a future language (ES, ZH), follow same pattern: add terms to dizionario-map.json, add lang to frontmatter, pass lang to linkToDizionario filter in templates

---
*Phase: 53.1-tech-debt*
*Completed: 2026-02-19*
