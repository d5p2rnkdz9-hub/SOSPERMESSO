---
phase: 53.1-tech-debt
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/permits.liquid
  - en/src/pages/permits-en.liquid
  - fr/src/pages/permits-fr.liquid
  - _data/footer.js
  - _includes/components/footer.liquid
  - _includes/layouts/base.liquid
  - netlify.toml
autonomous: true

must_haves:
  truths:
    - "'Scrivici' button on permit pages opens the correct Typeform (G6YT01Vj), not the old contact modal"
    - "Footer contains a 'Contattaci' link to the Typeform in all three languages"
    - "Homepage canonical URL is '/' not '/index.html', with 301 redirects configured in Netlify"
  artifacts:
    - path: "src/pages/permits.liquid"
      provides: "IT permit template with correct Typeform link"
      contains: "form.typeform.com/to/G6YT01Vj"
    - path: "en/src/pages/permits-en.liquid"
      provides: "EN permit template with correct Typeform link"
      contains: "form.typeform.com/to/G6YT01Vj"
    - path: "fr/src/pages/permits-fr.liquid"
      provides: "FR permit template with correct Typeform link"
      contains: "form.typeform.com/to/G6YT01Vj"
    - path: "_data/footer.js"
      provides: "Footer data with Contattaci link for all three languages"
      contains: "form.typeform.com/to/G6YT01Vj"
    - path: "_includes/components/footer.liquid"
      provides: "Footer template handling external links with target=_blank"
      contains: "external"
    - path: "netlify.toml"
      provides: "301 redirects for /index.html -> /"
      contains: "/index.html"
  key_links:
    - from: "src/pages/permits.liquid"
      to: "https://form.typeform.com/to/G6YT01Vj"
      via: "anchor href"
      pattern: "form\\.typeform\\.com/to/G6YT01Vj"
    - from: "_data/footer.js"
      to: "https://form.typeform.com/to/G6YT01Vj"
      via: "footer link href"
      pattern: "form\\.typeform\\.com/to/G6YT01Vj"
---

<objective>
Fix three quick debt items: broken Typeform "Scrivici" button on permit pages, missing "Contattaci" footer item, and homepage canonical/redirect duplication.

Purpose: These are small, independent fixes that unblock SEO work (Phase 54) and fix user-facing broken links.
Output: Corrected permit templates (IT/EN/FR), updated footer data, canonical fix, and Netlify redirects.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/53.1-tech-debt/53.1-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Scrivici Typeform button on permit pages</name>
  <files>src/pages/permits.liquid, en/src/pages/permits-en.liquid, fr/src/pages/permits-fr.liquid</files>
  <action>
In all three permit templates (IT, EN, FR), the "Scrivici" / "Contact us" / "Contactez-nous" CTA button at the bottom of the content section currently uses `onclick="openContactModal()"` which opens a custom contact form. Replace this with a direct Typeform link.

In `src/pages/permits.liquid` (around line 90), replace:
```html
<button onclick="openContactModal()" class="btn btn-primary btn-sm" style="margin-left: 0; margin-top: 0.5rem;">
  Scrivici
</button>
```
With:
```html
<a href="https://form.typeform.com/to/G6YT01Vj" target="_blank" class="btn btn-primary btn-sm" style="margin-left: 0; margin-top: 0.5rem;">
  Scrivici
</a>
```

Also remove the contact-form-container div and the fetch script at the bottom of the template (lines ~122-132) since it is no longer needed on permit pages.

Apply the same pattern to `en/src/pages/permits-en.liquid` (keeping "Contact us" text) and `fr/src/pages/permits-fr.liquid` (keeping "Contactez-nous" text).

The correct Typeform URL is: `https://form.typeform.com/to/G6YT01Vj`
  </action>
  <verify>
  grep -n "G6YT01Vj" src/pages/permits.liquid en/src/pages/permits-en.liquid fr/src/pages/permits-fr.liquid
  grep -n "openContactModal" src/pages/permits.liquid en/src/pages/permits-en.liquid fr/src/pages/permits-fr.liquid (should return no matches)
  </verify>
  <done>All three permit templates link to the correct Typeform URL. No more openContactModal references in permit templates.</done>
</task>

<task type="auto">
  <name>Task 2: Add Contattaci footer item and fix homepage canonical + redirects</name>
  <files>_data/footer.js, _includes/components/footer.liquid, _includes/layouts/base.liquid, netlify.toml</files>
  <action>
**Footer fix:**
In `_data/footer.js`, add a "Contattaci" / "Contact Us" / "Contactez-nous" link to each language's links array, pointing to `https://form.typeform.com/to/G6YT01Vj`. Add it as the last item before the existing links (or at the end). Since the link is external (Typeform), add an `external: true` property.

Example for IT:
```js
{ label: "Contattaci", href: "https://form.typeform.com/to/G6YT01Vj", external: true }
```
EN: `{ label: "Contact Us", href: "https://form.typeform.com/to/G6YT01Vj", external: true }`
FR: `{ label: "Contactez-nous", href: "https://form.typeform.com/to/G6YT01Vj", external: true }`

Then update `_includes/components/footer.liquid` to handle external links properly. Currently it uses `{{ link.href | url }}` for all links. For external links, use the raw href and add `target="_blank"`:
```liquid
{% if link.external %}
<a href="{{ link.href }}" class="footer-project-link" target="_blank">{{ link.label }}</a>
{% else %}
<a href="{{ link.href | url }}" class="footer-project-link">{{ link.label }}</a>
{% endif %}
```

**Canonical fix:**
In `_includes/layouts/base.liquid`, the canonical tag (line ~28) currently outputs `{{ site.url }}{{ page.url }}`. For homepage this produces `https://www.sospermesso.it/index.html`. This is fine if 11ty outputs `/` for the homepage URL. Check what `page.url` is for the homepage. If it's `/index.html`, no change is needed because 11ty typically outputs `/` for index pages. The Netlify redirects below handle the user-facing side.

**Netlify redirects:**
In `netlify.toml`, add 301 redirect rules so `/index.html` redirects to `/`, `/en/index.html` redirects to `/en/`, and `/fr/index.html` redirects to `/fr/`:

```toml
# Homepage canonical redirects
[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

[[redirects]]
  from = "/en/index.html"
  to = "/en/"
  status = 301
  force = true

[[redirects]]
  from = "/fr/index.html"
  to = "/fr/"
  status = 301
  force = true
```

Add these before the security headers section in netlify.toml.
  </action>
  <verify>
  grep -n "Contattaci\|Contact Us\|Contactez-nous" _data/footer.js
  grep -n "G6YT01Vj" _data/footer.js
  grep -n "external" _includes/components/footer.liquid
  grep -n "index.html" netlify.toml
  </verify>
  <done>Footer shows "Contattaci" link in all three languages. Footer template handles external links with target="_blank" (no mangling by url filter). Netlify redirects /index.html to / for all three language homepages.</done>
</task>

</tasks>

<verification>
1. `grep -rn "openContactModal" src/pages/permits.liquid en/src/pages/permits-en.liquid fr/src/pages/permits-fr.liquid` returns nothing
2. `grep -rn "G6YT01Vj" src/pages/permits.liquid en/src/pages/permits-en.liquid fr/src/pages/permits-fr.liquid _data/footer.js` returns matches in all 4 files
3. `grep -n "index.html" netlify.toml` shows redirect rules
4. Footer template handles external links with target="_blank"
</verification>

<success_criteria>
- Scrivici/Contact us/Contactez-nous buttons on all permit pages link to https://form.typeform.com/to/G6YT01Vj
- Footer has Contattaci/Contact Us/Contactez-nous linking to the same Typeform
- Footer template correctly renders external links without url filter mangling
- netlify.toml has 301 redirects for /index.html, /en/index.html, /fr/index.html
</success_criteria>

<output>
After completion, create `.planning/phases/53.1-tech-debt/53.1-01-SUMMARY.md`
</output>
