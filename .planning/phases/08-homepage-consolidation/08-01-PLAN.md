---
phase: 08-homepage-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/index.html
  - src/pages/chi-siamo.html
autonomous: true

must_haves:
  truths:
    - "Nested homepage has same section structure as root homepage"
    - "I NOSTRI DATABASE section visible on nested homepage"
    - "AIUTO LEGALE section visible on nested homepage"
    - "Navigation from chi-siamo.html leads to root homepage"
    - "All internal links work correctly from nested homepage"
    - "Contact modal opens when Scrivici button clicked"
  artifacts:
    - path: "src/pages/index.html"
      provides: "Synced homepage with Phase 6 structure"
      contains: "I NOSTRI DATABASE"
    - path: "src/pages/chi-siamo.html"
      provides: "Fixed navigation links"
      contains: "../../index.html"
  key_links:
    - from: "src/pages/index.html"
      to: "database.html"
      via: "href in Database section card"
      pattern: 'href="database.html"'
    - from: "src/pages/index.html"
      to: "aiuto-legale.html"
      via: "href in Aiuto legale section"
      pattern: 'href="aiuto-legale.html"'
    - from: "src/pages/chi-siamo.html"
      to: "../../index.html"
      via: "nav menu Home link"
      pattern: 'href="../../index.html"'
    - from: "src/pages/index.html"
      to: "contact modal"
      via: "openContactModal() onclick and fetch('../components/contact-form.html')"
      pattern: "openContactModal|fetch.*contact-form"
---

<objective>
Sync nested homepage with root homepage Phase 6 structure and fix broken navigation.

Purpose: Eliminate content divergence between dual homepages and ensure consistent navigation.
Output: Updated src/pages/index.html with complete Phase 6 sections, fixed chi-siamo.html navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-homepage-consolidation/08-RESEARCH.md

# Source files
@index.html (root - source of truth, lines 186-326 for sections)
@src/pages/index.html (target - needs update)
@src/pages/chi-siamo.html (navigation fix)
</context>

<tasks>

<task type="auto">
  <name>Task 1a: Update nested homepage Hero, Tests, and Database sections</name>
  <files>src/pages/index.html</files>
  <action>
Update the first half of main content sections in src/pages/index.html to match root index.html structure.

Changes required:

1. **Update Hero section** (lines 84-104):
   - Replace old hero with new hero-new class structure
   - Use new hero title: "La Tua Guida" + "Facile" highlight + "ai Permessi di Soggiorno"
   - Add hero-subtitle, btn-hero CTA, hero-notice
   - Add decorative SVG elements (document, passport, calendar, papers, suitcase, map pin)
   - Remove lighthouse hero loading (lighthouse-hero div and fetch script)

2. **Update Tests section** (around line 107):
   - Add inline gradient style: `style="background: linear-gradient(135deg, #E8F5E9 0%, #FFF9E6 100%);"`
   - Add title color: `style="color: var(--accent-green);"`
   - Keep test cards as-is (they're already correct)

3. **ADD Database section** (NEW - insert after Tests, before Guides):
   ```html
   <!-- DATABASE SECTION -->
   <section class="section" style="background: linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 100%);">
     <div class="container">
       <div class="section-header">
         <h2 class="section-title" style="color: var(--accent-teal);">I NOSTRI DATABASE üìö</h2>
         <p class="section-subtitle">Trova rapidamente tutte le informazioni sui permessi</p>
       </div>

       <div class="grid grid-2">
         <a href="database.html" class="card card-link">
           <span class="card-icon">üìö</span>
           <h3 class="card-title">Database permessi</h3>
           <p class="card-description">Tutti i tipi di permesso disponibili in Italia</p>
         </a>

         <a href="documenti-questura.html" class="card card-link">
           <span class="card-icon">üìå</span>
           <h3 class="card-title">Documenti Questura</h3>
           <p class="card-description">Lista completa dei documenti necessari</p>
         </a>
       </div>
     </div>
   </section>
   ```

4. **Update Guides section** (reduce from 5 cards to 3):
   - Add inline gradient style: `style="background: linear-gradient(135deg, #FFF9E6 0%, #FFE0B2 100%);"`
   - Add title color: `style="color: var(--accent-orange);"`
   - REMOVE Database permessi card (moved to Database section)
   - REMOVE Documenti Questura card (moved to Database section)
   - KEEP: Protezione internazionale, Ricongiungimento familiare, Dizionario

Path notes (CRITICAL - nested context):
- All hrefs to pages: NO `src/pages/` prefix needed (e.g., `href="database.html"`)
- Images: `../../images/` prefix needed
- Styles: `../styles/` prefix already correct
  </action>
  <verify>
1. Open src/pages/index.html in browser
2. Verify Hero section has new decorative SVG elements
3. Verify Tests section has green gradient background
4. Verify Database section appears with teal gradient
5. Verify Database section has exactly 2 cards (Database permessi, Documenti Questura)
6. Verify Guides section has exactly 3 cards (not 5)
7. Run: `grep "I NOSTRI DATABASE" src/pages/index.html` - should return 1 match
8. Run: `grep -c "grid-2" src/pages/index.html | grep -v "grid-3"` in Database section
  </verify>
  <done>
Nested homepage has updated Hero, Tests, Database, and Guides sections:
- Hero with new decorative elements
- Tests (3 cards) with green gradient
- Database (2 cards) with teal gradient - NEW
- Guides (3 cards) with orange gradient - reduced from 5
  </done>
</task>

<task type="auto">
  <name>Task 1b: Update nested homepage Aiuto legale, Link utili, CTA, and nav/footer</name>
  <files>src/pages/index.html</files>
  <action>
Update the second half of main content sections in src/pages/index.html.

Changes required:

1. **ADD Aiuto legale section** (NEW - insert after Guides, before Link utili):
   ```html
   <!-- AIUTO LEGALE SECTION -->
   <section class="section aiuto-legale-section" style="background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);">
     <div class="container">
       <div class="section-header">
         <h2 class="section-title" style="color: var(--lighthouse-red);">AIUTO LEGALE ‚öñÔ∏è</h2>
         <p class="section-subtitle">Trova assistenza legale professionale per le tue esigenze</p>
       </div>

       <a href="aiuto-legale.html" class="card card-link aiuto-legale-card">
         <span class="card-icon">‚öñÔ∏è</span>
         <h3 class="card-title">Trova assistenza legale gratuita</h3>
         <p class="card-description">Sportelli, associazioni e avvocati che offrono consulenza gratuita per questioni di immigrazione</p>
         <button class="btn btn-secondary">TROVA AIUTO ‚Üí</button>
       </a>
     </div>
   </section>
   ```

2. **Update Link utili section** (reduce from 3 cards to 2):
   - Add inline gradient style: `style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0E6 100%);"`
   - Add title color: `style="color: var(--accent-orange);"`
   - Change grid from grid-3 to grid-2
   - REMOVE Aiuto legale card (moved to standalone section)
   - KEEP: Kit postale, Controlla permesso

3. **Update CTA section** (use modal instead of direct link):
   - Change from `<a href="https://sospermesso.typeform.com/contatti">` to `<button onclick="openContactModal()">`
   - Add contact form container: `<div id="contact-form-container"></div>`
   - Add script to load contact form at bottom before closing body:
     ```javascript
     // Load contact form
     fetch('../components/contact-form.html')
       .then(response => response.text())
       .then(html => {
         document.getElementById('contact-form-container').innerHTML = html;
       });
     ```

4. **Update nav menu** (line 43-48):
   - Change "Chi siamo" link from `href="#about"` to `href="chi-siamo.html"`
   - Match root index.html nav structure

5. **Add lighthouse animation CSS** (inline styles before closing body):
   - Copy the lighthouse-container styles from root index.html (lines 344-452)

6. **Update footer links** (match root structure):
   - Ensure chi-siamo, database, contatti links present

Path notes (CRITICAL - nested context):
- Contact form fetch: `fetch('../components/contact-form.html')` (note: ../ not src/)
  </action>
  <verify>
1. Verify Aiuto legale section is standalone with coral gradient
2. Verify Aiuto legale has prominent card with "TROVA AIUTO" button
3. Verify Link utili has exactly 2 cards (not 3)
4. Verify Link utili uses grid-2 (not grid-3): `grep -c "grid-3" src/pages/index.html` in Link utili section should be 0
5. Verify CTA section has button with onclick="openContactModal()"
6. Verify contact-form-container div exists
7. Verify script loads contact form via fetch('../components/contact-form.html')
8. Click "Scrivici" button - verify modal opens (not external typeform link)
9. Run: `grep "AIUTO LEGALE" src/pages/index.html` - should return 1 match
10. Run: `grep "openContactModal" src/pages/index.html` - should return at least 1 match
11. Run: `grep "contact-form.html" src/pages/index.html` - should return 1 match
  </verify>
  <done>
Nested homepage has updated Aiuto legale, Link utili, CTA sections and nav/footer:
- Aiuto legale (1 prominent card) with coral gradient - NEW standalone
- Link utili (2 cards) with warm gradient - reduced from 3
- CTA with contact modal integration (not external typeform)
- Nav links updated
- Footer links consistent
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix chi-siamo.html navigation links</name>
  <files>src/pages/chi-siamo.html</files>
  <action>
Fix the navigation links in chi-siamo.html that incorrectly point to nested index.html instead of root.

Changes required:

1. **Line 26** - Fix Home nav link:
   - Change: `<li><a href="index.html" class="nav-link">Home</a></li>`
   - To: `<li><a href="../../index.html" class="nav-link">Home</a></li>`

2. **Line 28** - Fix Test nav link:
   - Change: `<li><a href="index.html#test" class="nav-link">Test</a></li>`
   - To: `<li><a href="../../index.html#test" class="nav-link">Test</a></li>`

Why `../../index.html`:
- chi-siamo.html is at: /src/pages/chi-siamo.html
- Root homepage is at: /index.html
- From /src/pages/ to / requires going up two directories: ../../
  </action>
  <verify>
1. Open src/pages/chi-siamo.html in browser
2. Click "Home" nav link - should navigate to root homepage (with hero decorations)
3. Click "Test" nav link - should navigate to root homepage test section
4. Verify NOT navigating to nested homepage (which has different/outdated structure)
5. Run: `grep 'href="index.html"' src/pages/chi-siamo.html` - should return 0 results
6. Run: `grep 'href="../../index.html"' src/pages/chi-siamo.html` - should return 2 results
  </verify>
  <done>
chi-siamo.html navigation links point to root homepage:
- Home link: href="../../index.html"
- Test link: href="../../index.html#test"
  </done>
</task>

<task type="auto">
  <name>Task 3: Audit all src/pages/*.html for broken navigation patterns</name>
  <files>src/pages/*.html</files>
  <action>
Audit all pages in src/pages/ directory for navigation patterns that incorrectly point to nested index.html instead of root.

Run audit command:
```bash
grep -l 'href="index.html"' src/pages/*.html
```

If any files are found (besides chi-siamo.html which is fixed in Task 2):
- Fix each file by changing `href="index.html"` to `href="../../index.html"`
- Apply same fix to any `href="index.html#section"` patterns

Expected result: After Task 2, this audit should find 0 files with the broken pattern.

This task ensures the phase goal "All internal navigation paths consistent" is fully verified across ALL pages, not just chi-siamo.html.
  </action>
  <verify>
Run comprehensive audit:
```bash
# Should return 0 files after all fixes
grep -l 'href="index.html"' src/pages/*.html 2>/dev/null | wc -l
# Expected: 0

# Verify chi-siamo specifically fixed
grep 'href="../../index.html"' src/pages/chi-siamo.html | wc -l
# Expected: 2 (Home and Test links)
```
  </verify>
  <done>
All pages in src/pages/*.html have consistent navigation:
- No pages contain broken `href="index.html"` pattern
- All Home/Test links use `../../index.html` to reach root homepage
- Internal navigation paths verified consistent across entire site
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Section count verification:**
   - Root index.html sections: Tests, Database, Guides, Aiuto legale, Link utili, CTA (6)
   - Nested index.html sections: Should match (6)

2. **Content parity programmatic checks:**
   ```bash
   # Database section exists
   grep "I NOSTRI DATABASE" src/pages/index.html
   # Expected: 1 match

   # Guides section uses correct grid (not 5-column)
   grep -c "grid-3" src/pages/index.html
   # Expected: 0 in Link utili section (now grid-2)

   # Aiuto legale section exists
   grep "AIUTO LEGALE" src/pages/index.html
   # Expected: 1 match
   ```

3. **Contact modal wiring verification:**
   ```bash
   # openContactModal function called
   grep "openContactModal" src/pages/index.html
   # Expected: at least 1 match

   # Contact form loaded via fetch
   grep "contact-form.html" src/pages/index.html
   # Expected: 1 match (fetch('../components/contact-form.html'))
   ```

4. **Navigation path audit (ALL pages):**
   ```bash
   grep -l 'href="index.html"' src/pages/*.html
   ```
   Should return NO results (all should use ../../index.html or be self-references)

5. **Functional test - Contact modal:**
   - Open src/pages/index.html in browser
   - Click "Scrivici" button
   - Verify modal opens (not external typeform redirect)

6. **Functional test - chi-siamo navigation:**
   - Home link leads to root homepage with new hero
   - Test link leads to root homepage #test section
</verification>

<success_criteria>
1. src/pages/index.html has 6 content sections matching root index.html
2. "I NOSTRI DATABASE" section present with 2 cards (verified by grep)
3. "AIUTO LEGALE" section present as standalone prominent section (verified by grep)
4. Guides section has 3 cards (not 5)
5. Link utili section has 2 cards (not 3), uses grid-2 (verified by grep)
6. Contact modal integration working - openContactModal() wired and fetch loads form
7. chi-siamo.html "Home" and "Test" links navigate to root homepage (verified by grep)
8. All internal navigation paths consistent across ALL src/pages/*.html files (verified by audit)
</success_criteria>

<output>
After completion, create `.planning/phases/08-homepage-consolidation/08-01-SUMMARY.md`
</output>
