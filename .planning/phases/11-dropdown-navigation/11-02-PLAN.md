---
phase: 11-dropdown-navigation
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/pages/*.html
  - src/pages/documenti-questura/*.html
  - src/pages/guide/*.html
autonomous: false

must_haves:
  truths:
    - "User sees consistent dropdown navigation on every page of the site"
    - "All ~190 HTML files have the new header with dropdown structure"
    - "Desktop dropdowns work on any page (not just index.html)"
    - "Mobile flat list navigation works on any page"
  artifacts:
    - path: "src/pages/database.html"
      provides: "Database landing page with dropdown header"
      contains: "has-dropdown"
    - path: "src/pages/permesso-studio.html"
      provides: "Example permit page with dropdown header"
      contains: "has-dropdown"
    - path: "src/pages/chi-siamo.html"
      provides: "About page with dropdown header"
      contains: "has-dropdown"
  key_links:
    - from: "Any src/pages/*.html"
      to: "Dropdown link paths"
      via: "Relative path adjustment (../ or ../../)"
      pattern: "href=.*database\\.html"
---

<objective>
Propagate the dropdown navigation header to all HTML pages across the site.

Purpose: Ensure consistent navigation experience across the entire site, allowing users to access dropdown menus from any page they're viewing.

Output:
- All ~190 HTML files updated with new dropdown header structure
- Path adjustments for different directory depths
- Human verification that dropdowns work site-wide
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-dropdown-navigation/11-01-SUMMARY.md

# Reference for header structure
@index.html (updated header template)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Propagate header to all HTML pages</name>
  <files>
    src/pages/*.html
    src/pages/documenti-questura/*.html
    src/pages/guide/*.html
  </files>
  <action>
Update all HTML files with the new dropdown header structure from index.html.

**Strategy:**
1. Identify all HTML files and their directory depth relative to root
2. For each file, replace the `<ul class="nav-menu">` block with the dropdown version
3. Adjust relative paths based on directory depth

**Directory structure analysis:**
```
/ (root)                          → paths as-is (src/pages/...)
src/pages/                        → paths with ../ (../database.html, ../guide/...)
src/pages/documenti-questura/     → paths with ../../ (../../pages/database.html)
src/pages/guide/                  → paths with ../../ (../../pages/database.html)
```

**Path adjustment patterns:**

For `index.html` (root):
```html
<a href="src/pages/database.html">Database di permessi</a>
<a href="src/pages/documenti-questura.html">Che documenti porto in Questura</a>
<a href="src/pages/guide/protezione-internazionale.html">Protezione internazionale</a>
```

For `src/pages/*.html` (one level deep):
```html
<a href="database.html">Database di permessi</a>
<a href="documenti-questura.html">Che documenti porto in Questura</a>
<a href="guide/protezione-internazionale.html">Protezione internazionale</a>
```

For `src/pages/documenti-questura/*.html` and `src/pages/guide/*.html` (two levels deep):
```html
<a href="../database.html">Database di permessi</a>
<a href="../documenti-questura.html">Che documenti porto in Questura</a>
<a href="../guide/protezione-internazionale.html">Protezione internazionale</a>
```

**Implementation approach:**

Use sed/bash scripting to:
1. Find all HTML files
2. Replace the nav-menu section with the dropdown version
3. Adjust paths based on file location

**Template for src/pages/*.html files:**
```html
<ul class="nav-menu" id="nav-menu">
  <li class="nav-item has-dropdown">
    <a href="#database" class="nav-link" aria-haspopup="true" aria-expanded="false">Database</a>
    <ul class="nav-dropdown" role="menu">
      <li role="none"><a href="database.html" class="dropdown-link" role="menuitem">Database di permessi</a></li>
      <li role="none"><a href="documenti-questura.html" class="dropdown-link" role="menuitem">Che documenti porto in Questura</a></li>
    </ul>
  </li>
  <li class="nav-item has-dropdown">
    <a href="#guide" class="nav-link" aria-haspopup="true" aria-expanded="false">Guide</a>
    <ul class="nav-dropdown" role="menu">
      <li role="none"><a href="guide/protezione-internazionale.html" class="dropdown-link" role="menuitem">Protezione internazionale</a></li>
      <li role="none"><a href="guide/ricongiungimento-familiare.html" class="dropdown-link" role="menuitem">Ricongiungimento familiare</a></li>
      <li role="none"><a href="guide/dizionario.html" class="dropdown-link" role="menuitem">Dizionario</a></li>
    </ul>
  </li>
  <li class="nav-item has-dropdown">
    <a href="#test" class="nav-link" aria-haspopup="true" aria-expanded="false">Test</a>
    <ul class="nav-dropdown" role="menu">
      <li role="none"><a href="https://form.typeform.com/to/kt7P9Ejk" class="dropdown-link" role="menuitem" target="_blank">Posso AVERE un permesso?</a></li>
      <li role="none"><a href="https://form.typeform.com/to/R7HY8nBp" class="dropdown-link" role="menuitem" target="_blank">Posso RINNOVARE il permesso?</a></li>
    </ul>
  </li>
  <li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>
</ul>
```

**Before running bulk update:**
1. Verify actual file paths exist (documenti-questura.html vs documenti-questura/ directory)
2. Check if guide pages exist (protezione-internazionale.html, etc.)
3. Adjust paths accordingly if structure differs

**Execution:**
Use a script that:
1. Reads each HTML file
2. Finds the nav-menu block (between `<ul class="nav-menu"` and closing `</ul>`)
3. Replaces with appropriate depth-adjusted template
4. Writes back to file

Count and verify: ~190 files should be updated.
  </action>
  <verify>
1. Count updated files: `grep -r "has-dropdown" src/pages/ | wc -l` should show ~190 matches
2. Sample check - open 3 different depth files:
   - src/pages/database.html
   - src/pages/documenti-questura/studio.html (or similar)
   - src/pages/chi-siamo.html
3. Verify each has the dropdown structure
4. Verify relative paths are correct for each depth
  </verify>
  <done>
- All HTML files in src/pages/ updated with dropdown navigation
- Paths adjusted for directory depth (../ or ../../ as needed)
- "Il progetto" link paths also adjusted per directory depth
- No broken relative paths
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Dropdown navigation implemented site-wide:
- 3 menu items (Database, Guide, Test) with hover dropdowns on desktop
- Flat list navigation on mobile (hamburger menu)
- Consistent styling (white background, teal text, yellow hover)
- ARIA accessibility attributes
- ~190 HTML files updated with new header structure
  </what-built>
  <how-to-verify>
**Desktop verification (viewport >768px):**
1. Open `index.html` in browser
2. Hover over "Database" - verify dropdown shows:
   - "Database di permessi"
   - "Che documenti porto in Questura"
3. Click "Database di permessi" link - verify navigation works
4. On database.html page, hover over "Guide" - verify dropdown shows:
   - "Protezione internazionale"
   - "Ricongiungimento familiare"
   - "Dizionario"
5. Navigate to a deeper page (e.g., src/pages/documenti-questura/*.html)
6. Verify dropdowns still work and links are not broken

**Mobile verification (viewport <768px or device):**
1. Open any page on mobile or resize browser to <768px
2. Click hamburger menu icon
3. Verify flat list shows ALL items (parent + children):
   - Database
   - → Database di permessi
   - → Che documenti porto in Questura
   - Guide
   - → Protezione internazionale
   - → Ricongiungimento familiare
   - → Dizionario
   - Test
   - → Posso AVERE un permesso?
   - → Posso RINNOVARE il permesso?
   - Il progetto
4. Click any sub-item - verify it navigates and menu closes

**Styling verification:**
1. Dropdown background is white (#FFFFFF)
2. Dropdown text is teal (#1A6B5F)
3. Hover shows subtle yellow tint
4. Shadow matches existing language switcher

**Edge cases:**
1. Test Typeform links open in new tab
2. Verify "Il progetto" (no dropdown) still works
3. Test keyboard navigation (Tab through menu)
  </how-to-verify>
  <resume-signal>Type "approved" if dropdowns work correctly on desktop and mobile across multiple pages, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
After propagation and human verification:

1. **Coverage check:**
   - All HTML files have dropdown structure
   - No files left with old flat nav-menu

2. **Path integrity:**
   - Links work from every directory depth
   - No 404s when clicking dropdown items

3. **Requirements met:**
   - NAV-01: Database has correct 2 items
   - NAV-02: Guide has correct 3 items
   - NAV-03: Test has correct 2 items
   - NAV-04: Desktop hover works site-wide
   - NAV-05: Mobile flat list works site-wide
   - NAV-06: Styling consistent everywhere
</verification>

<success_criteria>
- [ ] All ~190 HTML files updated with dropdown header
- [ ] Relative paths correct for each directory depth
- [ ] Desktop dropdowns work on any page
- [ ] Mobile flat list works on any page
- [ ] No broken links in navigation
- [ ] Human verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/11-dropdown-navigation/11-02-SUMMARY.md`
</output>
