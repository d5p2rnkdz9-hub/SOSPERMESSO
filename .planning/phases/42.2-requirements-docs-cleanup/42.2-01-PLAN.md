---
phase: 42.2-requirements-docs-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/REQUIREMENTS.md
  - .planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "REQUIREMENTS.md includes all 24 v3.1 requirements (16 existing + 8 new)"
    - "Traceability table maps every requirement to its phase"
    - "Phase 41 VERIFICATION.md exists with observable truths verified against build output"
    - "Phase 41 verification covers all 4 PRASSI requirements"
  artifacts:
    - path: ".planning/REQUIREMENTS.md"
      provides: "Complete v3.1 requirements tracking"
      contains: "CONTENT-01|CONTENT-02|COSTI-01|COSTI-02|VALID-01|VALID-02|DIZIO-01|DIZIO-02"
    - path: ".planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md"
      provides: "Retroactive verification report for Phase 41"
      contains: "status: passed"
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/ROADMAP.md"
      via: "requirement IDs match roadmap phase requirements"
      pattern: "CONTENT-01|COSTI-01|VALID-01|DIZIO-01"
    - from: ".planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md"
      to: ".planning/phases/42.1-fix-prassi-integration/42.1-VERIFICATION.md"
      via: "Phase 41 verification references 42.1 fix as evidence for full integration"
      pattern: "PRASSI-0[1-4]"
---

<objective>
Update requirements tracking and generate missing Phase 41 verification.

Purpose: Bring v3.1 documentation up to date before moving to content phases (43-46). REQUIREMENTS.md needs 8 new requirements for upcoming phases. Phase 41 was never formally verified -- now that 42.1 has fixed the integration, generate the retroactive verification.

Output: Updated REQUIREMENTS.md (24 requirements) and new 41-VERIFICATION.md.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/39-document-pages/39-VERIFICATION.md
@.planning/phases/42.1-fix-prassi-integration/42.1-VERIFICATION.md
@.planning/phases/41-prassi-locali-mvp/41-01-SUMMARY.md
@.planning/phases/41-prassi-locali-mvp/41-02-SUMMARY.md
@.planning/phases/41-prassi-locali-mvp/41-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add remaining v3.1 requirements to REQUIREMENTS.md</name>
  <files>.planning/REQUIREMENTS.md</files>
  <action>
Read `.planning/REQUIREMENTS.md` and add 8 new requirements in 4 new sections after the existing "Prassi Locali" section. Keep the same formatting pattern (checkbox + bold ID + description).

Add these sections:

### Content Population
- [ ] **CONTENT-01**: All 17 placeholder permit pages have Q&A content in Notion
- [ ] **CONTENT-02**: Generated pages render correctly with new content

### Costi Section
- [ ] **COSTI-01**: Cost data sourced from Notion database properties
- [ ] **COSTI-02**: Costi section rendered on document pages (primo and rinnovo)

### Content Validation
- [ ] **VALID-01**: All document pages reviewed for content accuracy
- [ ] **VALID-02**: All permit pages reviewed for content accuracy

### Dizionario Links
- [ ] **DIZIO-01**: Glossary term matching improved (covers all relevant terms)
- [ ] **DIZIO-02**: All relevant terms linked correctly across pages

Then update the Traceability table to add these 8 rows:

| CONTENT-01 | Phase 43 | Pending |
| CONTENT-02 | Phase 43 | Pending |
| COSTI-01 | Phase 44 | Pending |
| COSTI-02 | Phase 44 | Pending |
| VALID-01 | Phase 45 | Pending |
| VALID-02 | Phase 45 | Pending |
| DIZIO-01 | Phase 46 | Pending |
| DIZIO-02 | Phase 46 | Pending |

Update the Coverage section:
- v3.1 requirements: 24 total
- Mapped to phases: 24
- Unmapped: 0

Update the intro line from "Requirements for Notion-11ty integration. Converts existing build scripts to 11ty data files." to "Requirements for Notion-11ty integration, prassi locali, and content completion."

Update the "Last updated" footer date.

Do NOT change any existing requirement checkboxes or text -- only add new content.
  </action>
  <verify>
Verify by counting requirements:
- `grep -c '^\- \[' .planning/REQUIREMENTS.md` should return 24
- `grep -c 'CONTENT-0' .planning/REQUIREMENTS.md` should return 2
- `grep -c 'COSTI-0' .planning/REQUIREMENTS.md` should return 2
- `grep -c 'VALID-0' .planning/REQUIREMENTS.md` should return 2
- `grep -c 'DIZIO-0' .planning/REQUIREMENTS.md` should return 2
- Traceability table has 24 rows (16 existing + 8 new)
  </verify>
  <done>REQUIREMENTS.md has 24 requirements in 8 sections with complete traceability table.</done>
</task>

<task type="auto">
  <name>Task 2: Generate Phase 41 VERIFICATION.md retroactively</name>
  <files>.planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md</files>
  <action>
Generate a verification report for Phase 41 (Prassi Locali MVP) following the exact format established by `39-VERIFICATION.md` and `42.1-VERIFICATION.md`.

Use the Phase 41 summaries (41-01, 41-02, 41-03) for what was delivered, and the Phase 42.1 verification for evidence that everything is working now.

**Frontmatter:**
```yaml
---
phase: 41-prassi-locali-mvp
verified: {current ISO timestamp}
status: passed
score: 7/7 must-haves verified
re_verification: false
---
```

**Observable Truths (7):**

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Prassi locali data file fetches approved submissions from Notion | VERIFIED | `_data/prassiLocali.js` exists, exports async function, queries Notion with Status="Approved" filter, groups by slug then city |
| 2 | Document pages display prassi section with city-grouped practices | VERIFIED | `documents-primo.liquid` and `documents-rinnovo.liquid` include prassi section (lines ~169-211), iterate `prassiLocali[doc.slug]` |
| 3 | Submission form sends data via Netlify Function to Notion | VERIFIED | `netlify/functions/submit-prassi.mjs` accepts POST, creates Notion page with Status="Pending". Modal form in `prassi.js` calls endpoint |
| 4 | Upvote/downvote system works with abuse prevention | VERIFIED | `netlify/functions/vote-prassi.mjs` increments Notion vote properties. `prassi.js` uses localStorage to prevent duplicate votes |
| 5 | Practices are filterable by city (client-side) | VERIFIED | `prassi.js` implements city filter. Data pre-grouped by city in `prassiLocali.js` |
| 6 | Empty state displays correctly when no practices exist | VERIFIED | Templates include static empty-state div with "Nessuna segnalazione" message and "Aggiungi la tua esperienza" button |
| 7 | Build succeeds with and without Notion credentials | VERIFIED | `prassiLocali.js` returns `{}` when PRASSI_DB_ID missing. Build completes (60.91s, 392 files per 42.1 verification) |

**Required Artifacts** — verify existence and substance of:
- `_data/prassiLocali.js` — async data file, groups by slug + city
- `src/styles/prassi.css` — section, cards, votes, modal, responsive styles
- `src/scripts/prassi.js` — modal form, voting UI, city autocomplete (105 questure)
- `netlify/functions/submit-prassi.mjs` — submission endpoint with validation
- `netlify/functions/vote-prassi.mjs` — vote counting via Notion API
- `src/pages/documents-primo.liquid` — includes prassi section
- `src/pages/documents-rinnovo.liquid` — includes prassi section

For each artifact, read the actual file and record line count, key exports/functions, and confirm it's not a stub.

**Key Links** — verify wiring between:
- `prassiLocali.js` -> templates (via `prassiLocali[doc.slug]` lookup)
- Templates -> `prassi.css` (via link tag in head)
- Templates -> `prassi.js` (via script tag before body close)
- `prassi.js` -> `submit-prassi.mjs` (via fetch call)
- `prassi.js` -> `vote-prassi.mjs` (via fetch call)

**Requirements Coverage** — map each PRASSI requirement:
- PRASSI-01: Submission form -> Netlify Function -> Notion DB
- PRASSI-02: Display section with city filter
- PRASSI-03: Upvote/downvote with localStorage abuse prevention
- PRASSI-04: Manual moderation (Notion Status="Approved" filter at build time)

**Evidence sources:** Use actual codebase inspection (read files, check line counts, grep for patterns). Reference Phase 42.1 VERIFICATION.md build output (60.91s, 392 files, 43/43 content pages with prassi section) as post-fix evidence.

**Include Human Verification Required section** listing visual checks that need manual testing (same items from 41-04-PLAN.md: visual rendering, submission modal, voting UI, mobile responsiveness).

**Anti-patterns check:** Scan for TODO/FIXME/HACK in prassi-related files. Report findings.

Note in the report that Phase 41 plan 04 (visual verification checkpoint) was never executed as a separate plan, and that Phase 42.1 resolved integration issues discovered later. The verification is retroactive, performed after 42.1 confirmed the feature works end-to-end.
  </action>
  <verify>
- File exists: `.planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md`
- Contains frontmatter with `status: passed`
- Contains "Observable Truths" table with 7 rows
- Contains "Requirements Coverage" section covering PRASSI-01 through PRASSI-04
- Contains "Required Artifacts" section with 7 artifacts
- Contains "Key Link Verification" section with 5+ wiring checks
- Contains "Human Verification Required" section
  </verify>
  <done>Phase 41 has a complete VERIFICATION.md with all observable truths verified, requirements mapped, and evidence documented.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -c '^\- \[' .planning/REQUIREMENTS.md` returns 24
2. `.planning/phases/41-prassi-locali-mvp/41-VERIFICATION.md` exists and has `status: passed`
3. All 4 PRASSI requirements appear in 41-VERIFICATION.md requirements coverage
4. All 8 new requirements appear in REQUIREMENTS.md traceability table
5. No existing content in REQUIREMENTS.md was modified (only additions)
</verification>

<success_criteria>
- REQUIREMENTS.md has 24 requirements (16 existing + 8 new) across 8 sections
- Traceability table maps all 24 requirements to phases
- Phase 41 VERIFICATION.md exists with passed status, 7 observable truths, and PRASSI-01..04 coverage
- Verification report follows established format (matching 39-VERIFICATION.md and 42.1-VERIFICATION.md)
</success_criteria>

<output>
After completion, create `.planning/phases/42.2-requirements-docs-cleanup/42.2-01-SUMMARY.md`
</output>
