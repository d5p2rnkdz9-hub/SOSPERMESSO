---
phase: 33-rtl-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/main.css
  - src/styles/components.css
  - src/styles/mobile.css
  - src/styles/mobile-fix.css
  - src/styles/document-page.css
  - src/styles/rtl.css
autonomous: false

must_haves:
  truths:
    - "Adding dir='rtl' to any page causes text to align right and layout to mirror"
    - "Navigation flows right-to-left when direction is RTL"
    - "Arabic text renders with appropriate font when lang='ar' is set"
    - "Directional arrows/chevrons flip in RTL mode"
  artifacts:
    - path: "src/styles/rtl.css"
      provides: "RTL-specific rules, Arabic font stack, direction variable"
      min_lines: 30
    - path: "src/styles/main.css"
      provides: "Logical spacing properties, direction multiplier variable"
      contains: "--text-x-direction"
    - path: "src/styles/components.css"
      provides: "Logical border, positioning, text-align properties"
      contains: "margin-inline-start"
  key_links:
    - from: "src/styles/rtl.css"
      to: "[dir='rtl']"
      via: "CSS attribute selector"
      pattern: "\\[dir=['\"]rtl['\"]\\]"
    - from: "src/styles/main.css"
      to: "rtl.css"
      via: "--text-x-direction variable"
      pattern: "--text-x-direction"
---

<objective>
Add RTL (Right-to-Left) CSS infrastructure to support Arabic and Hebrew languages.

Purpose: Prepare the codebase for future Arabic translations by converting physical CSS properties to direction-agnostic logical properties. This ensures layouts automatically mirror when dir="rtl" is set on pages.

Output: Updated CSS files using logical properties, new rtl.css file with direction rules and Arabic font stack.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-rtl-infrastructure/33-RESEARCH.md
@src/styles/main.css
@src/styles/components.css
@src/styles/mobile.css
@src/styles/mobile-fix.css
@src/styles/document-page.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add RTL foundation and convert main.css logical properties</name>
  <files>src/styles/main.css</files>
  <action>
Add RTL foundation variables to :root in main.css:

```css
/* RTL Support */
--text-x-direction: 1; /* 1 for LTR, -1 for RTL (set by rtl.css) */
```

Convert ALL physical directional properties to logical equivalents:

**Property mapping (use this exact mapping):**
- `padding-left` → `padding-inline-start`
- `padding-right` → `padding-inline-end`
- `margin-left` → `margin-inline-start`
- `margin-right` → `margin-inline-end`
- `text-align: left` → `text-align: start`
- `text-align: right` → `text-align: end`
- `left: [value]` (in positioning) → `inset-inline-start: [value]`
- `right: [value]` (in positioning) → `inset-inline-end: [value]`
- `border-left` → `border-inline-start`
- `border-right` → `border-inline-end`

**Key conversions in main.css:**
- Line 212: `padding-left: var(--spacing-lg)` → `padding-inline-start: var(--spacing-lg)`
- Line 237: `padding-left: var(--spacing-md)` → `padding-inline-start: var(--spacing-md)`
- Line 244: `padding-left: var(--spacing-lg)` → `padding-inline-start: var(--spacing-lg)`
- Line 249: `padding-left: var(--spacing-lg)` → `padding-inline-start: var(--spacing-lg)`
- Line 255: `padding-left: 0` → `padding-inline-start: 0`
- Line 261: `left: -1.25rem` → `inset-inline-start: -1.25rem`
- Line 383: `.text-left { text-align: left; }` → `.text-left, .text-start { text-align: start; }`
- Line 384: `.text-right { text-align: right; }` → `.text-right, .text-end { text-align: end; }`

**Important:**
- Keep .text-left and .text-right class names for backwards compatibility (they now map to logical values)
- Add .text-start and .text-end as aliases
- Do NOT change `margin: 0 auto` or `margin: X Y` shorthand (these are fine)
  </action>
  <verify>
1. Run: `grep -c "padding-left\|margin-left\|border-left\|text-align: left" src/styles/main.css` — should return 0 or only for shorthand/auto values
2. Run: `grep -c "padding-inline-start\|margin-inline-start\|text-align: start" src/styles/main.css` — should return > 0
3. Run: `grep "text-x-direction" src/styles/main.css` — should show the variable definition
  </verify>
  <done>main.css uses logical properties for all directional spacing and alignment. RTL foundation variable defined.</done>
</task>

<task type="auto">
  <name>Task 2: Convert components.css, mobile.css, mobile-fix.css logical properties</name>
  <files>src/styles/components.css, src/styles/mobile.css, src/styles/mobile-fix.css</files>
  <action>
Apply the same property mapping from Task 1 to these three files.

**components.css key conversions:**
- Line 406: `margin-right: -12px` → `margin-inline-end: -12px`
- Line 420: `padding-left: 8px` → `padding-inline-start: 8px`
- Line 529: `text-align: left` → `text-align: start`
- Line 530: `padding-right: 1rem` → `padding-inline-end: 1rem`
- Line 555: `margin-left: 0.5rem` → `margin-inline-start: 0.5rem`
- Line 581: `right: 0` → `inset-inline-end: 0`
- Line 626: `padding-right: 1.5rem` → `padding-inline-end: 1.5rem`
- Line 633: `right: 0.5rem` → `inset-inline-end: 0.5rem`
- Line 648: `left: 0` → `inset-inline-start: 0`
- Lines 742, 748, 754: `border-left: 4px solid` → `border-inline-start: 4px solid`
- Line 778: `left: 50%` — KEEP AS-IS (centering transform uses physical position)
- Line 875: `left: 0` → `inset-inline-start: 0`
- Lines 943-944: `margin-left/right: auto` — KEEP AS-IS (centering, works same in RTL)
- Line 1100: `padding-right: 1rem` → `padding-inline-end: 1rem`
- Line 1202, 1216: `left: 0` → `inset-inline-start: 0`
- Lines 1251-1252: `margin-left/right: auto` — KEEP AS-IS (centering)

**mobile.css key conversions:**
- Line 59: `left: 0` → `inset-inline-start: 0`
- Line 60: `margin-left: 0` → `margin-inline-start: 0`
- Line 69: `margin-right: 0` → `margin-inline-end: 0`
- Line 193: `padding-left: var(--spacing-md)` → `padding-inline-start: var(--spacing-md)`
- Line 198: `padding-left: var(--spacing-lg)` → `padding-inline-start: var(--spacing-lg)`
- Lines 286-287: `left: 0; right: 0` → `inset-inline-start: 0; inset-inline-end: 0`
- Line 516: `left: 0` → `inset-inline-start: 0`

**mobile-fix.css key conversions:**
- Lines 131-132: `left: 0; right: 0` → `inset-inline-start: 0; inset-inline-end: 0`
- Lines 185-186: `margin-left: auto; margin-right: 0.5rem` → `margin-inline-start: auto; margin-inline-end: 0.5rem`
- Line 272: `text-align: left` → `text-align: start`
- Line 351: `text-align: left` → `text-align: start`
- Line 394: `text-align: left` → `text-align: start`
- Line 407: `margin-left: 0` → `margin-inline-start: 0`

**Exceptions (keep physical properties):**
- `left: 50%` with `transform: translateX(-50%)` for centering — KEEP AS-IS
- Animation keyframes with `left`/`right` — KEEP AS-IS (handled in rtl.css if needed)
- `top`, `bottom` — these are block-direction, not inline-direction, KEEP AS-IS
  </action>
  <verify>
1. Run: `grep -c "padding-left\|margin-left\|text-align: left" src/styles/components.css src/styles/mobile.css src/styles/mobile-fix.css` — should be 0 or minimal (only centering exceptions)
2. Run: `grep -c "inset-inline\|margin-inline\|padding-inline\|text-align: start" src/styles/components.css` — should return > 0
3. Run: `grep "border-inline-start" src/styles/components.css` — should show alert border conversions
  </verify>
  <done>Components, mobile, and mobile-fix CSS files converted to logical properties.</done>
</task>

<task type="auto">
  <name>Task 3: Create rtl.css with direction rules and Arabic font stack</name>
  <files>src/styles/rtl.css</files>
  <action>
Create new file `src/styles/rtl.css` with:

```css
/* ===============================================
   SOS PERMESSO - RTL (Right-to-Left) Support
   For Arabic, Hebrew, and other RTL languages
   =============================================== */

/* ===============================================
   DIRECTION CONTROL
   =============================================== */

/* Set direction multiplier for RTL mode */
[dir="rtl"] {
  --text-x-direction: -1;
  direction: rtl;
  unicode-bidi: embed;
}

/* Ensure LTR is explicit default */
[dir="ltr"],
:root:not([dir="rtl"]) {
  --text-x-direction: 1;
  direction: ltr;
}

/* ===============================================
   ARABIC FONT STACK
   =============================================== */

/* Arabic language-specific typography */
[lang="ar"] {
  font-family: "Geeza Pro", "Arabic Typesetting", "Tahoma", var(--font-primary);
  line-height: 1.8; /* Extra space for diacritics */
  letter-spacing: normal !important; /* NEVER add letter-spacing for Arabic */
}

/* Arabic headings */
[lang="ar"] h1,
[lang="ar"] h2,
[lang="ar"] h3,
[lang="ar"] h4,
[lang="ar"] h5,
[lang="ar"] h6 {
  font-family: "Geeza Pro", "Arabic Typesetting", "Tahoma", var(--font-heading);
  line-height: 1.5;
}

/* ===============================================
   ICON MIRRORING
   =============================================== */

/* Directional icons that should mirror in RTL */
[dir="rtl"] .icon-arrow,
[dir="rtl"] .icon-chevron,
[dir="rtl"] .icon-back,
[dir="rtl"] .icon-forward,
[dir="rtl"] .mirror-rtl {
  transform: scaleX(var(--text-x-direction));
}

/* Navigation dropdown arrow - mirrors in RTL */
[dir="rtl"] .has-dropdown .nav-link::after {
  transform: scaleX(-1);
}

/* Breadcrumb arrows mirror in RTL */
[dir="rtl"] .breadcrumb-nav span {
  transform: scaleX(-1);
  display: inline-block;
}

/* ===============================================
   LAYOUT ADJUSTMENTS
   =============================================== */

/* List bullets should stay on the start side (already handled by logical properties) */
/* This is a fallback for any custom bullet positioning */
[dir="rtl"] .card ul li::before {
  left: auto;
  right: auto;
  inset-inline-start: -1.25rem;
}

/* Shadow direction adaptation */
[dir="rtl"] .card:hover {
  box-shadow: calc(-12px * 1) 40px rgba(255, 215, 0, 0.3);
}

/* ===============================================
   FORM ELEMENTS
   =============================================== */

/* Input text alignment follows direction */
[dir="rtl"] input,
[dir="rtl"] textarea,
[dir="rtl"] select {
  text-align: inherit;
}

/* Placeholder alignment */
[dir="rtl"] input::placeholder,
[dir="rtl"] textarea::placeholder {
  text-align: inherit;
}

/* ===============================================
   HEBREW SUPPORT
   =============================================== */

[lang="he"] {
  font-family: "Arial Hebrew", "Tahoma", var(--font-primary);
  line-height: 1.7;
}

/* ===============================================
   UTILITY CLASSES
   =============================================== */

/* Force LTR for specific content (numbers, code, URLs) */
.ltr-content {
  direction: ltr;
  unicode-bidi: isolate;
}

/* Force RTL for specific content */
.rtl-content {
  direction: rtl;
  unicode-bidi: isolate;
}
```

**After creating rtl.css:**
1. Add rtl.css import to all HTML pages that include main.css (this can be done during Arabic translation phase, not required now)
2. For testing, manually add `<link rel="stylesheet" href="../styles/rtl.css">` after main.css import

**Note:** The file should be loaded AFTER main.css, components.css, etc. so RTL overrides take effect.
  </action>
  <verify>
1. Verify file exists: `ls -la src/styles/rtl.css`
2. Check content: `grep -c "dir.*rtl" src/styles/rtl.css` — should return >= 3
3. Check Arabic font: `grep "Geeza Pro" src/styles/rtl.css` — should return the font stack
4. Check direction variable: `grep "text-x-direction" src/styles/rtl.css` — should show -1 for RTL
  </verify>
  <done>rtl.css file created with direction rules, Arabic font stack, icon mirroring, and utility classes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>RTL CSS infrastructure with logical properties and Arabic support</what-built>
  <how-to-verify>
1. Create test page:
   ```bash
   cp src/pages/chi-siamo.html src/pages/test-rtl.html
   ```

2. Edit src/pages/test-rtl.html:
   - Change `<html lang="it">` to `<html lang="ar" dir="rtl">`
   - Add `<link rel="stylesheet" href="../styles/rtl.css">` after the last CSS link
   - Add some Arabic text in the content (e.g., "مرحبا بكم في SOS Permesso")

3. Open in browser: `open src/pages/test-rtl.html`

4. Verify:
   - [ ] Text aligns to the right
   - [ ] Navigation flows from right to left
   - [ ] Card layouts mirror (content on right side)
   - [ ] Arabic text renders (may show placeholder if font not installed, that's OK)
   - [ ] Breadcrumb arrows point left-to-right (→) instead of right-to-left
   - [ ] Alert borders appear on the right side (start side in RTL)

5. Compare with original: `open src/pages/chi-siamo.html` (should be LTR)

6. Delete test file when done: `rm src/pages/test-rtl.html`
  </how-to-verify>
  <resume-signal>Type "approved" if RTL layout works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
**Requirement coverage:**
- RTL-01 (logical properties): All CSS files converted from physical to logical properties
- RTL-02 (direction selector): `[dir="rtl"]` selector in rtl.css sets `direction: rtl`
- RTL-03 (navigation mirroring): Flexbox auto-adapts, dropdown arrows have scaleX transform
- RTL-04 (Arabic font stack): `[lang="ar"]` selector with Geeza Pro, Arabic Typesetting, Tahoma stack

**Automated checks:**
```bash
# Count remaining physical left/right properties (should be minimal, only centering)
grep -r "padding-left\|margin-left:\|text-align: left\|border-left" src/styles/*.css --include="*.css" | grep -v "rtl.css" | wc -l

# Verify logical properties exist
grep -c "inline-start\|inline-end\|text-align: start" src/styles/main.css src/styles/components.css

# Verify RTL file
ls -la src/styles/rtl.css && grep "direction: rtl" src/styles/rtl.css
```
</verification>

<success_criteria>
1. All directional spacing/alignment properties converted to logical equivalents
2. rtl.css exists with [dir="rtl"] selector, Arabic font stack, and icon mirroring
3. Test page with `dir="rtl"` displays mirrored layout
4. No breaking changes to existing LTR pages (backwards compatible)
</success_criteria>

<output>
After completion, create `.planning/phases/33-rtl-infrastructure/33-01-SUMMARY.md`
</output>
