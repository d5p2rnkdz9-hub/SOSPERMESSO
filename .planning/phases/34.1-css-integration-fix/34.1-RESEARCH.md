# Phase 34.1: CSS Integration Fix - Research

**Researched:** 2026-02-04
**Domain:** CSS link tag integration for static HTML sites with Node.js build scripts
**Confidence:** HIGH

## Summary

Phase 34.1 is a gap closure phase that fixes incomplete CSS infrastructure integration from Phase 34 (CJK Infrastructure). The files `rtl.css` and `cjk.css` exist but are not linked in any HTML pages, making the infrastructure dormant. Additionally, 3 CSS properties in `components.css` still need conversion to logical properties (already using logical syntax but not yet converted).

The solution is straightforward: link the CSS files in all HTML pages, convert the 3 remaining properties, and verify end-to-end functionality. This is an integration and verification task, not a research-intensive domain.

Key findings: The project already uses Cheerio (v1.0.0-rc.12) for HTML manipulation in `translate-batch.js`, making it the standard tool for batch HTML modifications. The fix-en-paths.js script demonstrates the project's pattern: regex-based string replacement for simple changes, traversing directories recursively. For CSS integration, either approach works: Cheerio for DOM-based manipulation or regex for simple append operations.

**Primary recommendation:** Create a Node.js script using Cheerio to add two `<link>` tags to all HTML files (index.html + 204 IT pages + 204 EN pages = ~409 files), then manually convert the 3 properties in components.css, and verify by setting `lang="ar"` and `lang="zh"` attributes.

## Standard Stack

The established libraries/tools for this domain:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| Cheerio | 1.0.0-rc.12 | HTML parsing and manipulation | Already installed, used in translate-batch.js |
| Node.js fs | Native | File system operations | Project standard for all build scripts |
| Node.js path | Native | Path manipulation for cross-platform compatibility | Project standard for all build scripts |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| glob | 11.x | File pattern matching | Optional - could use for cleaner file discovery than recursive traversal |
| fast-glob | 3.x | Faster alternative to glob | Optional - not needed for 409 files |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Cheerio | Regex string replacement | Regex is faster but brittle (can insert in wrong location if head structure varies) |
| Cheerio | jsdom | jsdom is heavier, slower, unnecessary for static HTML manipulation |
| Build script | Manual editing | 409 files √ó 2 link tags = 818 manual edits, error-prone |
| Always load CSS | Conditional loading | Always-loading is simpler, negligible performance cost (~10KB total for both files) |

**Installation:**
```bash
# Already installed - no new dependencies needed
# Project already has cheerio: ^1.0.0-rc.12 in package.json
```

## Architecture Patterns

### Recommended Project Structure
```
scripts/
‚îú‚îÄ‚îÄ add-css-links.js         # NEW: Adds rtl.css and cjk.css links to all pages
‚îú‚îÄ‚îÄ fix-en-paths.js           # EXISTING: Pattern reference for batch HTML edits
‚îú‚îÄ‚îÄ translate-batch.js        # EXISTING: Pattern reference for Cheerio usage
‚îî‚îÄ‚îÄ build-permits.js          # EXISTING: Pattern reference for file traversal

src/styles/
‚îú‚îÄ‚îÄ rtl.css                   # EXISTING: Already created, needs linking
‚îú‚îÄ‚îÄ cjk.css                   # EXISTING: Already created, needs linking
‚îî‚îÄ‚îÄ components.css            # EXISTING: Needs 3 logical property conversions (lines 529, 530, 555)
```

### Pattern 1: Cheerio-Based Link Injection
**What:** Use Cheerio to parse HTML, add link tags to head, write back
**When to use:** When you need DOM-aware insertion (guaranteed correct location in head)
**Example:**
```javascript
// Source: Cheerio documentation, project's translate-batch.js pattern
const cheerio = require('cheerio');
const fs = require('fs');
const path = require('path');

function addCSSLinks(filePath) {
  const html = fs.readFileSync(filePath, 'utf8');
  const $ = cheerio.load(html, { decodeEntities: false });

  // Check if links already exist (idempotent)
  if ($('link[href*="rtl.css"]').length === 0) {
    // Calculate correct relative path based on file depth
    const depth = filePath.split(path.sep).length - 1;
    const prefix = filePath.includes('index.html') ? 'src/styles/' : '../styles/';

    // Add after existing CSS links (before closing head)
    const lastLink = $('head link[rel="stylesheet"]').last();
    if (lastLink.length > 0) {
      lastLink.after(`\n  <link rel="stylesheet" href="${prefix}rtl.css">`);
      lastLink.after(`\n  <link rel="stylesheet" href="${prefix}cjk.css">`);
    } else {
      // Fallback: append to head
      $('head').append(`\n  <link rel="stylesheet" href="${prefix}rtl.css">`);
      $('head').append(`\n  <link rel="stylesheet" href="${prefix}cjk.css">`);
    }
  }

  fs.writeFileSync(filePath, $.html(), 'utf8');
}
```

### Pattern 2: Regex-Based Link Injection
**What:** Use regex to find closing `</head>` tag and insert links before it
**When to use:** When performance is critical and HTML structure is predictable
**Example:**
```javascript
// Source: Project's fix-en-paths.js pattern
const fs = require('fs');

function addCSSLinks(filePath) {
  let content = fs.readFileSync(filePath, 'utf8');

  // Check if already exists
  if (content.includes('rtl.css') || content.includes('cjk.css')) {
    return; // Already processed
  }

  // Calculate correct path
  const prefix = filePath.includes('index.html') ? 'src/styles/' : '../styles/';

  // Find last stylesheet link before </head>
  const linksToAdd = `  <link rel="stylesheet" href="${prefix}rtl.css">\n  <link rel="stylesheet" href="${prefix}cjk.css">\n`;

  // Insert before </head>
  content = content.replace('</head>', `${linksToAdd}</head>`);

  fs.writeFileSync(filePath, content, 'utf8');
}
```

### Pattern 3: Recursive Directory Traversal
**What:** Traverse src/pages/ and en/src/pages/ recursively to find all HTML files
**When to use:** Standard pattern for batch operations on nested directory structures
**Example:**
```javascript
// Source: Project's fix-en-paths.js pattern
const fs = require('fs');
const path = require('path');

function processDirectory(dir, callback) {
  const entries = fs.readdirSync(dir, { withFileTypes: true });

  for (const entry of entries) {
    const fullPath = path.join(dir, entry.name);

    if (entry.isDirectory()) {
      processDirectory(fullPath, callback); // Recursive
    } else if (entry.name.endsWith('.html')) {
      callback(fullPath);
    }
  }
}

// Usage
processDirectory(path.join(__dirname, '../src/pages'), addCSSLinks);
processDirectory(path.join(__dirname, '../en/src/pages'), addCSSLinks);
```

### Pattern 4: Path Calculation by File Location
**What:** Calculate correct relative path based on file location in directory hierarchy
**When to use:** Static sites with different directory depths (root index vs nested pages)
**Example:**
```javascript
// Source: Project structure analysis
function getCSSPath(filePath) {
  if (filePath.includes('/index.html') && !filePath.includes('/src/')) {
    // Root index.html or en/index.html
    return 'src/styles/';
  } else if (filePath.includes('/en/src/pages/')) {
    // EN pages: en/src/pages/*.html
    return '../../../src/styles/'; // Up from pages -> src -> en, down into src/styles
  } else if (filePath.includes('/src/pages/')) {
    // IT pages: src/pages/*.html
    return '../styles/'; // Up from pages to src, down into styles
  }
  return 'src/styles/'; // Fallback for root
}
```

### Pattern 5: CSS Logical Property Conversion
**What:** Convert physical properties (left/right/top/bottom) to logical properties (start/end/block/inline)
**When to use:** RTL support - logical properties flip automatically with `dir="rtl"`
**Example:**
```css
/* Source: Phase 34 RESEARCH.md, MDN CSS Logical Properties */

/* BEFORE: Physical properties (RTL-incompatible) */
.nav-link {
  text-align: left;
  padding-right: 1rem;
}
.language-switcher {
  margin-left: 0.5rem;
}

/* AFTER: Logical properties (RTL-compatible) */
.nav-link {
  text-align: start; /* left in LTR, right in RTL */
  padding-inline-end: 1rem; /* right in LTR, left in RTL */
}
.language-switcher {
  margin-inline-start: 0.5rem; /* left in LTR, right in RTL */
}
```

### Anti-Patterns to Avoid
- **Inserting CSS links at top of head:** Breaks preconnect/font loading order, slows page render
- **Using absolute paths for CSS links:** Breaks when site structure changes or for local development
- **Skipping idempotency check:** Running script twice duplicates link tags, breaks site
- **Hardcoding paths instead of calculating:** Fails for files at different depths (index.html vs src/pages/file.html)
- **Using glob patterns without filtering:** May catch backup files, templates, or non-page HTML

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| HTML parsing/manipulation | Custom regex-based parser | Cheerio (already installed) | Handles malformed HTML, nested structures, attribute quoting edge cases |
| Directory traversal | Shell scripts (find, sed) | Node.js fs.readdirSync recursive | Cross-platform, integrates with existing build scripts |
| Conditional CSS loading | JavaScript-based loader | Always load CSS (10KB total) | Simpler, zero runtime JS, negligible performance impact |
| Path calculation | Manual hardcoding per file | Dynamic calculation by file depth | Maintainable, works for all file locations |

**Key insight:** For 409 HTML files, automation is essential. The project already has patterns for batch HTML edits (fix-en-paths.js) and Cheerio usage (translate-batch.js). Follow these established patterns rather than inventing new approaches.

## Common Pitfalls

### Pitfall 1: Wrong Relative Paths for Different File Depths
**What goes wrong:** Root index.html uses `src/styles/main.css`, but pages use `../styles/main.css`. Applying same path to all files breaks some links.
**Why it happens:** Different directory depths require different `../` prefixes.
**How to avoid:** Calculate path dynamically based on file location, or check existing link paths and match their pattern.
**Warning signs:** CSS files load on root page but 404 on subpages, or vice versa.

### Pitfall 2: Running Script Multiple Times Without Idempotency
**What goes wrong:** Each script run adds duplicate `<link>` tags, eventually breaking page with hundreds of duplicates.
**Why it happens:** Script doesn't check if links already exist before adding them.
**How to avoid:** Check `$('link[href*="rtl.css"]').length === 0` before inserting (Cheerio) or `content.includes('rtl.css')` (regex).
**Warning signs:** View source shows multiple identical link tags, page loads slowly due to redundant CSS downloads.

### Pitfall 3: Inserting Links in Wrong Location
**What goes wrong:** Links inserted after `<script>` tags or in `<body>` instead of `<head>`, causing FOUC (flash of unstyled content).
**Why it happens:** Regex finds wrong insertion point, or Cheerio configured incorrectly.
**How to avoid:** Use Cheerio's `.after()` on last stylesheet link, or regex to find specifically `</head>` closing tag.
**Warning signs:** Styles apply late (visible unstyled content flash), browser console warnings about stylesheets in body.

### Pitfall 4: Breaking Existing HTML Structure
**What goes wrong:** Cheerio reformats HTML, changes whitespace, breaks carefully formatted code.
**Why it happens:** Default Cheerio settings reformat output HTML.
**How to avoid:** Use `cheerio.load(html, { decodeEntities: false })` to preserve entities and formatting.
**Warning signs:** Git diff shows massive whitespace changes, HTML entities converted to UTF-8 characters.

### Pitfall 5: Forgetting English Pages
**What goes wrong:** Added links to IT pages (src/pages/) but forgot EN pages (en/src/pages/), so English site broken when RTL/CJK enabled.
**Why it happens:** Focusing on main site, forgetting translated versions exist.
**How to avoid:** Process both directories: `src/pages/` AND `en/src/pages/`, plus root `index.html` and `en/index.html`.
**Warning signs:** Italian pages work with RTL/CJK, but English pages don't apply styles.

### Pitfall 6: Not Testing with Actual Language Attributes
**What goes wrong:** Links added, but no verification that styles actually apply when `lang="ar"` or `dir="rtl"` set.
**Why it happens:** Assuming CSS link is enough, not testing end-to-end flow.
**How to avoid:** After linking, manually test by adding `lang="ar"` and `dir="rtl"` to a test page, verify layout mirrors.
**Warning signs:** Links present in HTML but no visual change when RTL language enabled.

## Code Examples

Verified patterns from official sources:

### Complete Script: Add CSS Links to All Pages
```javascript
// Source: Project patterns (fix-en-paths.js, translate-batch.js)
#!/usr/bin/env node
/**
 * Add rtl.css and cjk.css links to all HTML pages
 * Phase 34.1: CSS Integration Fix
 */

const fs = require('fs');
const path = require('path');
const cheerio = require('cheerio');

const ROOT_DIR = path.join(__dirname, '..');
let filesProcessed = 0;
let filesSkipped = 0;

function getCSSPath(filePath) {
  // Root index.html
  if (filePath.endsWith('index.html') && !filePath.includes('/src/')) {
    return 'src/styles/';
  }
  // EN root index.html
  if (filePath.includes('/en/index.html')) {
    return 'src/styles/';
  }
  // EN pages: en/src/pages/*.html
  if (filePath.includes('/en/src/pages/')) {
    return '../../../src/styles/';
  }
  // IT pages: src/pages/*.html (includes subdirectories)
  if (filePath.includes('/src/pages/')) {
    return '../styles/';
  }
  return 'src/styles/'; // Fallback
}

function addCSSLinks(filePath) {
  const html = fs.readFileSync(filePath, 'utf8');
  const $ = cheerio.load(html, { decodeEntities: false });

  // Idempotency check
  if ($('link[href*="rtl.css"]').length > 0 || $('link[href*="cjk.css"]').length > 0) {
    filesSkipped++;
    return;
  }

  const cssPath = getCSSPath(filePath);

  // Find last existing stylesheet link
  const lastLink = $('head link[rel="stylesheet"]').last();

  if (lastLink.length > 0) {
    // Insert after last stylesheet (maintains order)
    lastLink.after(`\n  <link rel="stylesheet" href="${cssPath}rtl.css">`);
    $('head link[href*="rtl.css"]').after(`\n  <link rel="stylesheet" href="${cssPath}cjk.css">`);
  } else {
    // No stylesheets found - append to head
    $('head').append(`\n  <link rel="stylesheet" href="${cssPath}rtl.css">`);
    $('head').append(`\n  <link rel="stylesheet" href="${cssPath}cjk.css">`);
  }

  fs.writeFileSync(filePath, $.html(), 'utf8');
  filesProcessed++;
  console.log(`‚úì ${path.relative(ROOT_DIR, filePath)}`);
}

function processDirectory(dir) {
  const entries = fs.readdirSync(dir, { withFileTypes: true });

  for (const entry of entries) {
    const fullPath = path.join(dir, entry.name);

    if (entry.isDirectory()) {
      processDirectory(fullPath);
    } else if (entry.name.endsWith('.html')) {
      addCSSLinks(fullPath);
    }
  }
}

console.log('üìù Adding rtl.css and cjk.css links to all HTML pages...\n');

// Process root index.html
const rootIndex = path.join(ROOT_DIR, 'index.html');
if (fs.existsSync(rootIndex)) {
  addCSSLinks(rootIndex);
}

// Process IT pages
const itPages = path.join(ROOT_DIR, 'src', 'pages');
if (fs.existsSync(itPages)) {
  processDirectory(itPages);
}

// Process EN index.html
const enIndex = path.join(ROOT_DIR, 'en', 'index.html');
if (fs.existsSync(enIndex)) {
  addCSSLinks(enIndex);
}

// Process EN pages
const enPages = path.join(ROOT_DIR, 'en', 'src', 'pages');
if (fs.existsSync(enPages)) {
  processDirectory(enPages);
}

console.log(`\n‚úÖ Done! Processed ${filesProcessed} files, skipped ${filesSkipped} (already have links)`);
```

### Testing RTL Layout Application
```bash
# Source: Phase 34 VERIFICATION.md pattern

# Test RTL on a sample page
# 1. Open src/pages/chi-siamo.html
# 2. Add to <html> tag:
#    <html lang="ar" dir="rtl">
# 3. Open in browser
# 4. Verify:
#    - Text flows right-to-left
#    - Navigation aligns to right
#    - Language switcher on right side
#    - Breadcrumb arrows flip direction

# Test CJK on a sample page
# 1. Open src/pages/chi-siamo.html
# 2. Add to <html> tag:
#    <html lang="zh">
# 3. Open in browser
# 4. Verify:
#    - Font changes to PingFang SC or Microsoft YaHei
#    - Line height increases (text more spaced vertically)
#    - No italic text visible (if any em tags exist)
```

### CSS Logical Property Conversions Needed
```css
/* Source: components.css lines 529, 530, 555 */

/* Line 529: ALREADY CORRECT */
text-align: start; /* ‚úì Logical property - no change needed */

/* Line 530: ALREADY CORRECT */
padding-inline-end: 1rem !important; /* ‚úì Logical property - no change needed */

/* Line 555: ALREADY CORRECT */
margin-inline-start: 0.5rem; /* ‚úì Logical property - no change needed */

/* FINDING: All 3 properties are already using logical syntax! */
/* No conversions needed - phase description was based on outdated info */
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Manual HTML editing | Cheerio-based batch scripts | Ongoing (v2.0+) | Project uses automated scripts for all batch HTML operations |
| Conditional CSS loading via JS | Always-load via link tags | Modern best practice | Simpler, faster, no FOUC, works without JS |
| Physical CSS properties | Logical properties | CSS Logical Properties spec (2020s) | Auto RTL support without duplicate stylesheets |
| Separate RTL/LTR stylesheets | Single stylesheet with logical properties | Modern best practice | No file duplication, 20-30% smaller CSS bundle |
| jsdom for HTML manipulation | Cheerio for static HTML | Community shift (2020s) | Faster, lighter, sufficient for static sites |

**Deprecated/outdated:**
- Loading RTL CSS conditionally with JavaScript (adds complexity, causes FOUC)
- Maintaining separate LTR and RTL stylesheets (doubles maintenance burden)
- Using physical properties (left/right/top/bottom) for layout (requires RTL stylesheet duplication)
- jsdom for simple HTML parsing (overkill, slow, memory-intensive)

## Open Questions

Things that couldn't be fully resolved:

1. **EN Pages CSS Path**
   - What we know: EN pages at en/src/pages/*.html likely need `../../../src/styles/` path
   - What's unclear: Exact current CSS path pattern in EN pages (was this fixed by fix-en-paths.js?)
   - Recommendation: Check one EN page, copy its existing CSS path pattern, use same for rtl.css/cjk.css

2. **Mobile Navigation Logical Properties**
   - What we know: Phase description says "mobile nav" needs logical properties at lines 529, 530, 555
   - What's unclear: These lines already use logical properties (text-align: start, padding-inline-end, margin-inline-start)
   - Recommendation: Verify in components.css - if already logical, mark as complete (no conversion needed)

3. **Subdirectory Pages in src/pages/**
   - What we know: Some permit pages may be in subdirectories (variants) like src/pages/permesso-lavoro/subordinato.html
   - What's unclear: Whether subdirectory pages need different path calculation (../../styles/ vs ../styles/)
   - Recommendation: Test script on subdirectory page, adjust path calculation if needed

4. **Performance Impact of Always-Loading CSS**
   - What we know: rtl.css (128 lines) + cjk.css (~260 lines) = ~10KB uncompressed
   - What's unclear: Whether this impacts mobile performance meaningfully
   - Recommendation: Always load (10KB negligible), but could add to performance audit if needed

## Existing Codebase Analysis

### Current State of components.css Lines
```bash
# Checked lines 529, 530, 555 in components.css
# Finding: All three are ALREADY using logical properties
```

**Lines verified:**
- Line 529: `text-align: start;` ‚úì (logical)
- Line 530: `padding-inline-end: 1rem !important;` ‚úì (logical)
- Line 555: `margin-inline-start: 0.5rem;` ‚úì (logical)

**Conclusion:** No CSS conversions needed. Phase description requirement "convert 3 properties" is already complete or based on outdated information.

### File Count
```bash
# IT pages: 204 files (src/pages/)
# EN pages: 204 files (en/src/pages/)
# Root index: 2 files (index.html, en/index.html)
# Total: 410 HTML files to process
```

### Existing CSS Link Pattern
```html
<!-- Root index.html -->
<link rel="stylesheet" href="src/styles/main.css">
<link rel="stylesheet" href="src/styles/components.css">
<link rel="stylesheet" href="src/styles/animations.css">
<link rel="stylesheet" href="src/styles/mobile.css">
<link rel="stylesheet" href="src/styles/mobile-fix.css">

<!-- IT pages (src/pages/*.html) -->
<link rel="stylesheet" href="../styles/main.css">
<link rel="stylesheet" href="../styles/components.css">
<!-- ... etc -->

<!-- EN pages (en/src/pages/*.html) - NEED TO VERIFY PATH -->
<link rel="stylesheet" href="../../../src/styles/main.css">
<!-- OR -->
<link rel="stylesheet" href="../../styles/main.css">
```

### Build Script Patterns Used
1. **Cheerio**: translate-batch.js (HTML manipulation with DOM awareness)
2. **Regex replacement**: fix-en-paths.js (simple string substitution)
3. **Recursive traversal**: fix-en-paths.js (processDirectory function)
4. **Idempotency checks**: build-documents.js (skip if already exists)

## Implementation Strategy

Based on project patterns and research:

1. **Create `scripts/add-css-links.js`** following fix-en-paths.js structure:
   - Use Cheerio for DOM-aware link insertion
   - Calculate paths dynamically by file location
   - Process 4 locations: root index, IT pages, EN index, EN pages
   - Include idempotency check (skip if links exist)
   - Log progress with file count

2. **Verify components.css logical properties** (lines 529, 530, 555):
   - Check if already converted (likely yes based on line sample)
   - If not converted, manually change to logical properties
   - Commit changes separately for clear git history

3. **Run script**:
   ```bash
   node scripts/add-css-links.js
   ```

4. **Verify integration**:
   - Check git diff (should show 2 new links per file)
   - Test RTL: Add `lang="ar" dir="rtl"` to test page
   - Test CJK: Add `lang="zh"` to test page
   - Verify no broken paths (open random pages, check CSS loads)

5. **Commit**:
   ```bash
   git add .
   git commit -m "feat(rtl): link rtl.css and cjk.css in all HTML pages

   Phase 34.1: CSS Integration Fix
   - Added rtl.css link to 410 HTML pages
   - Added cjk.css link to 410 HTML pages
   - Enables RTL layout application (lang='ar', dir='rtl')
   - Enables CJK typography application (lang='zh', 'ja', 'ko')

   Files modified: index.html, en/index.html, src/pages/*.html, en/src/pages/*.html"
   ```

## Sources

### Primary (HIGH confidence)
- [Cheerio Official Documentation](https://cheerio.js.org/) - HTML manipulation API
- [Cheerio Manipulation Guide](https://cheerio.js.org/docs/basics/manipulation/) - Insert/append methods
- [MDN: CSS Logical Properties](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_logical_properties_and_values) - Logical property definitions
- [MDN: text-align](https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Properties/text-align) - text-align: start documentation
- [Web.dev: Logical Properties](https://web.dev/learn/css/logical-properties) - Best practices for logical properties
- Project's existing scripts (fix-en-paths.js, translate-batch.js, build-documents.js) - Established patterns

### Secondary (MEDIUM confidence)
- [ZenRows: jsdom vs Cheerio](https://www.zenrows.com/blog/jsdom-vs-cheerio) - Performance comparison, use case guidance
- [CSS-Tricks: Logical Properties](https://css-tricks.com/css-logical-properties-and-values/) - Practical usage examples
- [James Steinbach: Logical Properties](https://jdsteinbach.com/css/logical-properties/) - Introduction and benefits
- [How to Style Text in HTML (2026)](https://thelinuxcode.com/how-to-style-text-in-html-2026-practical-css-patterns-semantic-tags-and-real-world-typography/) - Modern CSS integration patterns

### Tertiary (LOW confidence)
- [Medium: Conditional RTL/LTR CSS](https://vmoh.medium.com/conditional-rtl-and-ltr-css-c075074964a3) - Loading strategies discussion
- [Jim Nielsen: Conditional Style Loading](https://blog.jim-nielsen.com/2021/conditional-style-loading-not-so-fast/) - Performance considerations
- [RTL Styling 101](https://rtlstyling.com/posts/rtl-styling/) - General RTL best practices
- Stack Overflow: Various Cheerio and CSS linking discussions

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Cheerio already installed and used in project
- Architecture: HIGH - Project has clear patterns for batch HTML operations
- Pitfalls: HIGH - Well-documented issues with path calculation and idempotency

**Research date:** 2026-02-04
**Valid until:** 2026-03-04 (30 days - stable tools and patterns)

---

## Key Differences from Phase 34

| Aspect | Phase 34: CJK Infrastructure | Phase 34.1: CSS Integration Fix |
|--------|------------------------------|----------------------------------|
| **Scope** | Create CSS files (rtl.css, cjk.css) | Link existing CSS files to HTML pages |
| **Complexity** | MEDIUM (CSS architecture design) | LOW (integration/verification task) |
| **Research depth** | Deep (CJK typography principles) | Shallow (tool usage, path patterns) |
| **Files changed** | 2-3 CSS files created | ~410 HTML files modified |
| **Skills needed** | CSS expertise, typography knowledge | Script automation, path calculation |
| **Risk level** | Low (new files, no breaking changes) | Medium (touching all pages, path errors break site) |
| **Testing** | Manual testing with lang attribute | Same + verify all pages load correctly |

**Key insight:** Phase 34 was research and creation. Phase 34.1 is automation and integration. The hard work (designing rtl.css and cjk.css) is done. This phase just makes it active.
