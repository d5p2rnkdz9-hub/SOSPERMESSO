---
phase: 35-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - eleventy.config.js
  - src/pages/pages.11tydata.json
  - en/src/pages/pages.11tydata.json
autonomous: true

must_haves:
  truths:
    - "Developer can run npm run build and 11ty generates site"
    - "All static assets appear in _site/ with same paths"
    - "Build completes without errors"
    - "All HTML files output to same paths as input (URL preservation)"
  artifacts:
    - path: "eleventy.config.js"
      provides: "11ty configuration with passthrough copy"
      contains: "addPassthroughCopy"
    - path: "src/pages/pages.11tydata.json"
      provides: "URL preservation for IT pages"
      contains: "filePathStem"
    - path: "en/src/pages/pages.11tydata.json"
      provides: "URL preservation for EN pages"
      contains: "filePathStem"
    - path: "package.json"
      provides: "Build scripts"
      contains: "eleventy"
  key_links:
    - from: "eleventy.config.js"
      to: "_site/"
      via: "build output"
      pattern: "output.*_site"
    - from: "pages.11tydata.json"
      to: "HTML file URLs"
      via: "permalink template"
      pattern: "filePathStem.*html"
---

<objective>
Install and configure 11ty v3.x with Liquid templates, passthrough copy for all assets, and URL preservation for all 412 HTML pages.

Purpose: Establish the build infrastructure that transforms static HTML into an 11ty project while preserving all existing URLs for SEO and backward compatibility.

Output: Working 11ty configuration that builds the entire site to `_site/` with identical URL structure.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-setup/35-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install 11ty and create configuration</name>
  <files>
    - package.json
    - eleventy.config.js
  </files>
  <action>
1. Install 11ty v3.x as dev dependency:
   ```bash
   npm install --save-dev @11ty/eleventy@3.1.2
   ```

2. Create `eleventy.config.js` in project root with ESM syntax:
   - Use `export default function(eleventyConfig)` pattern
   - Configure passthrough copy for ALL asset directories:
     - `src/styles` (IT CSS)
     - `src/scripts` (IT JS)
     - `src/components` (HTML includes for dynamic loading)
     - `src/data` (JSON content)
     - `IMAGES` (images)
     - `public` (public assets)
   - Configure passthrough for root files:
     - `robots.txt`
     - `sitemap-it.xml`, `sitemap-en.xml`, `sitemap-index.xml`
     - `netlify.toml`
   - Set dir.input: "." (root directory)
   - Set dir.output: "_site"
   - Set templateFormats: ["html", "liquid", "md"]
   - Set htmlTemplateEngine: "liquid"

3. Update `package.json` scripts:
   - Add "dev": "npx @11ty/eleventy --serve"
   - Add "build": "npx @11ty/eleventy"
   - Keep existing scripts (build:docs, build:sitemap, etc.)

IMPORTANT: Do NOT add passthrough for google*.html or 404.html - these are HTML files that 11ty will process normally.
  </action>
  <verify>
    - `npm run build` executes without error
    - `_site/src/styles/main.css` exists (passthrough worked)
    - `_site/robots.txt` exists
    - `_site/sitemap-index.xml` exists
  </verify>
  <done>
    - eleventy.config.js exists with all passthrough copy configured
    - package.json has dev and build scripts
    - @11ty/eleventy in devDependencies
  </done>
</task>

<task type="auto">
  <name>Task 2: Create directory data files for URL preservation</name>
  <files>
    - src/pages/pages.11tydata.json
    - en/src/pages/pages.11tydata.json
  </files>
  <action>
1. Create `src/pages/pages.11tydata.json`:
   ```json
   {
     "permalink": "{{ page.filePathStem }}.html"
   }
   ```
   This tells 11ty to preserve the full path including `src/pages/` and `.html` extension.

2. Create `en/src/pages/pages.11tydata.json`:
   ```json
   {
     "permalink": "{{ page.filePathStem }}.html"
   }
   ```
   Same pattern - `filePathStem` includes the `en/` prefix automatically.

WHY filePathStem: This variable includes the full directory path from root (e.g., "src/pages/chi-siamo" or "en/src/pages/chi-siamo"). Adding ".html" preserves the exact URL structure.

WHY NOT fileSlug: That's just the filename without path (e.g., "chi-siamo"), which would cause IT and EN pages to overwrite each other.

ROOT-LEVEL HTML FILES (index.html, 404.html, en/index.html, google*.html):
These do NOT need directory data files. 11ty's default behavior for root-level HTML files is correct:
- `index.html` -> `_site/index.html` (default behavior)
- `404.html` -> `_site/404.html` (default behavior)
- `en/index.html` -> `_site/en/index.html` (default behavior)
- `google9d3fb813b4bab969.html` -> `_site/google9d3fb813b4bab969.html` (default behavior)

11ty preserves the input path for HTML files at root level by default. Only the `src/pages/` and `en/src/pages/` directories need explicit permalink templates because without them, 11ty would apply its standard "pretty URLs" transformation (e.g., `chi-siamo.html` -> `chi-siamo/index.html`).
  </action>
  <verify>
```bash
# Verify IT directory data file
test -f src/pages/pages.11tydata.json && grep -q "filePathStem" src/pages/pages.11tydata.json && echo "IT data file: OK" || echo "IT data file: FAIL"

# Verify EN directory data file
test -f en/src/pages/pages.11tydata.json && grep -q "filePathStem" en/src/pages/pages.11tydata.json && echo "EN data file: OK" || echo "EN data file: FAIL"
```
  </verify>
  <done>
    - Both directory data files exist with correct permalink template
    - Root-level HTML files handled by 11ty default behavior (no action needed)
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify build and URL preservation</name>
  <action>
1. Run the build:
   ```bash
   npm run build
   ```

2. Verify file counts match:
   ```bash
   # Count input HTML files (excluding _site and node_modules)
   find . -name "*.html" -not -path "./_site/*" -not -path "./node_modules/*" | wc -l

   # Count output HTML files
   find ./_site -name "*.html" | wc -l
   ```
   Both counts should be approximately 412 (some tolerance for intermediate files).

3. Verify URL structure preserved (sample checks):
   ```bash
   # Root files (11ty default behavior)
   ls _site/index.html
   ls _site/404.html
   ls _site/en/index.html

   # IT pages (should be at exact same path)
   ls _site/src/pages/chi-siamo.html
   ls _site/src/pages/permesso-studio.html

   # EN pages (should be at exact same path)
   ls _site/en/src/pages/chi-siamo.html
   ls _site/en/src/pages/permesso-studio.html

   # Assets (passthrough copy)
   ls _site/src/styles/main.css
   ls _site/src/scripts/app.js
   ls _site/IMAGES/
   ```

4. Verify NO directory-style URLs were created:
   ```bash
   # Should return 0 (only index.html at root and en/)
   find _site -name "index.html" | grep -v "^_site/index.html$" | grep -v "^_site/en/index.html$" | wc -l
   ```

5. If build fails or URLs are wrong, check:
   - Passthrough copy paths match actual directory structure
   - Directory data files are in correct locations
   - No syntax errors in JSON files
  </action>
  <verify>
    - `npm run build` completes with exit code 0
    - Input HTML count equals output HTML count (approximately)
    - Sample URLs verified (chi-siamo.html, permesso-studio.html)
    - No unwanted directory-style URLs
  </verify>
  <done>
    - Build completes without errors
    - All 412 HTML files output to correct paths
    - All static assets copied correctly
    - URL structure identical to input
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **SETUP-01 (11ty installed):** `npm list @11ty/eleventy` shows 3.1.2
2. **SETUP-02 (passthrough copy):** `_site/src/styles/main.css` exists
3. **SETUP-03 (URL preservation):** `_site/src/pages/chi-siamo.html` exists (not `chi-siamo/index.html`)
4. **SETUP-04 (build succeeds):** `npm run build` exits with code 0

Verification commands:
```bash
# All-in-one verification
npm run build && \
echo "Build: OK" && \
ls _site/src/styles/main.css && \
echo "Passthrough: OK" && \
ls _site/src/pages/chi-siamo.html && \
echo "URL preservation: OK"
```
</verification>

<success_criteria>
- [ ] 11ty v3.1.2 installed as devDependency
- [ ] eleventy.config.js exists with passthrough copy for all assets
- [ ] package.json has "dev" and "build" scripts
- [ ] src/pages/pages.11tydata.json preserves IT URLs
- [ ] en/src/pages/pages.11tydata.json preserves EN URLs
- [ ] Root-level HTML files (index.html, 404.html, en/index.html) output correctly via 11ty defaults
- [ ] `npm run build` completes without errors
- [ ] Output file count matches input file count (~412)
- [ ] URLs preserved exactly (no directory-style changes)
- [ ] Static assets in _site/ at correct paths
</success_criteria>

<output>
After completion, create `.planning/phases/35-setup/35-01-SUMMARY.md`
</output>
