---
phase: 37-pages
plan: 02
type: execute
wave: 2
depends_on: ["37-01"]
files_modified:
  - src/pages/*.html
autonomous: true

must_haves:
  truths:
    - "All 204 IT pages in src/pages converted to use shared layouts"
    - "IT pages render with shared header/footer"
    - "Page content unchanged after migration"
  artifacts:
    - path: "src/pages/permesso-studio.html"
      provides: "Sample migrated IT permit page"
      contains: "layout: layouts/base.liquid"
    - path: "src/pages/database.html"
      provides: "Sample migrated IT page with inline styles"
      contains: "layout: layouts/base.liquid"
  key_links:
    - from: "src/pages/*.html"
      to: "_includes/layouts/base.liquid"
      via: "front matter layout"
      pattern: "layout: layouts/base.liquid"
---

<objective>
Migrate all 204 Italian pages in src/pages/ to use the shared layout.

Purpose: Convert IT pages (PAGE-01) to eliminate duplicated header/footer HTML
Output: All IT pages in src/pages/ have front matter and use base.liquid layout
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/37-pages/37-RESEARCH.md
@.planning/phases/37-pages/37-01-SUMMARY.md
@scripts/migrate-pages.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate IT pages in batches</name>
  <files>src/pages/*.html (204 files)</files>
  <action>
Run the migration script on all IT pages in src/pages/:

```bash
# Process all HTML files in src/pages/
node scripts/migrate-pages.js "src/pages/*.html"
```

The script (verified in Plan 01) will:
- Add front matter with layout, title, lang: it
- Extract content between header and footer
- Remove header, footer, head, standard scripts
- Preserve inline styles (database.html) via extraStyles
- Preserve page-specific scripts

After migration, verify sample pages:
1. permesso-studio.html - standard permit page
2. database.html - page with inline styles
3. chi-siamo.html - about page
4. documenti-questura.html - documents index

If any pattern fails, investigate and fix the migration script, then re-run.
  </action>
  <verify>
```bash
# Check sample pages have front matter
head -5 src/pages/permesso-studio.html | grep -q "layout:" && echo "permesso-studio OK"
head -5 src/pages/database.html | grep -q "layout:" && echo "database OK"
head -5 src/pages/chi-siamo.html | grep -q "layout:" && echo "chi-siamo OK"

# Verify count
grep -l "layout: layouts/base.liquid" src/pages/*.html | wc -l
# Should be 204

# Build and verify
npm run build
find _site/src/pages -name "*.html" | wc -l
# Should match input count
```
  </verify>
  <done>All 204 IT pages have front matter, build succeeds, output count matches input</done>
</task>

<task type="auto">
  <name>Task 2: Verify IT pages render correctly</name>
  <files>None (verification only)</files>
  <action>
Verify the migration by checking:

1. Build output count:
   - `find _site/src/pages -name "*.html" | wc -l` should be 204

2. No double headers/footers:
   ```bash
   # Check sample pages for single header/footer
   grep -c "<header" _site/src/pages/permesso-studio.html  # Should be 1
   grep -c "<footer" _site/src/pages/permesso-studio.html  # Should be 1
   ```

3. Lang attribute correct:
   ```bash
   grep -o '<html lang="[^"]*"' _site/src/pages/permesso-studio.html
   # Should show lang="it"
   ```

4. Inline styles preserved for database.html:
   ```bash
   grep -q "category-card" _site/src/pages/database.html && echo "Database styles OK"
   ```

5. Content preserved (spot check):
   - Compare a few pages visually in browser if needed
   - Check that breadcrumb, main content, related links sections exist

If any verification fails, identify the issue and fix (either in migration script or manually for edge cases).
  </action>
  <verify>
```bash
# All checks should pass
echo "IT output count:" && find _site/src/pages -name "*.html" | wc -l
echo "Header count (should be 1):" && grep -c "<header" _site/src/pages/permesso-studio.html
echo "Footer count (should be 1):" && grep -c "<footer" _site/src/pages/permesso-studio.html
echo "Lang attribute:" && grep -o '<html lang="[^"]*"' _site/src/pages/permesso-studio.html
```
  </verify>
  <done>204 IT pages output correctly with single header/footer, correct lang="it", content preserved</done>
</task>

</tasks>

<verification>
- All 204 IT pages in src/pages/ have front matter
- `npm run build` succeeds
- Output count matches input count (204)
- Sample pages have exactly one header and one footer
- HTML lang attribute is "it" for all IT pages
- database.html inline styles preserved
- Breadcrumbs and content sections visible in output
</verification>

<success_criteria>
1. All 204 files in src/pages/ have `layout: layouts/base.liquid` in front matter
2. All 204 files have `lang: it` in front matter
3. Build produces 204 HTML files in _site/src/pages/
4. No page has duplicate header or footer
5. database.html retains its inline styles for category cards
</success_criteria>

<output>
After completion, create `.planning/phases/37-pages/37-02-SUMMARY.md`
</output>
