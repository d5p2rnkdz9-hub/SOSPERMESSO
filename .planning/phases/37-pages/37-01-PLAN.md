---
phase: 37-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/migrate-pages.js
  - index.html
  - 404.html
  - en/index.html
autonomous: false

must_haves:
  truths:
    - "Migration script transforms HTML files correctly"
    - "Root IT index renders with shared header/footer"
    - "Root EN index renders with shared header/footer"
    - "Inline styles preserved in migrated pages"
  artifacts:
    - path: "scripts/migrate-pages.js"
      provides: "Page migration script"
      min_lines: 50
    - path: "index.html"
      provides: "Migrated IT homepage"
      contains: "layout: layouts/base.liquid"
    - path: "en/index.html"
      provides: "Migrated EN homepage"
      contains: "layout: layouts/base.liquid"
  key_links:
    - from: "index.html"
      to: "_includes/layouts/base.liquid"
      via: "front matter layout"
      pattern: "layout: layouts/base.liquid"
---

<objective>
Create the page migration script and validate it by migrating root-level pages.

Purpose: Establish and verify the migration approach before bulk processing 400+ pages
Output: Working migration script + migrated root pages (index.html, 404.html, en/index.html)
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-pages/37-RESEARCH.md
@.planning/phases/36-components/36-02-SUMMARY.md
@_includes/layouts/base.liquid
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration script</name>
  <files>scripts/migrate-pages.js</files>
  <action>
Create a Node.js script that:
1. Uses cheerio (already installed) to parse HTML
2. Extracts title from `<title>` tag, removing " - SOS Permesso" suffix
3. Extracts description from `<meta name="description">` content attribute
4. Extracts inline `<style>` blocks from `<head>` and preserves them via `extraStyles` front matter variable
5. Removes: `<head>`, `<header>`, `<footer>` elements
6. Removes only standard scripts: `<script src="...app.js">` and `<script src="...mobile.js">`
7. Preserves page-specific scripts and inline scripts
8. Determines lang from file path (starts with `en/` = 'en', else 'it')
9. Generates front matter with: layout, title, lang, description (if present), extraStyles (if inline styles exist)
10. Writes front matter + extracted body content back to file

Script accepts glob pattern as argument: `node scripts/migrate-pages.js "src/pages/permesso-*.html"`

Key patterns from research:
- Use `$('body').html()` after removing header/footer to get content
- Escape quotes in title/description for YAML
- Preserve inline styles by extracting `<style>` content and passing via extraStyles
  </action>
  <verify>
node scripts/migrate-pages.js --help (or no args) shows usage message without crashing
  </verify>
  <done>Migration script exists and runs without errors when invoked with no arguments</done>
</task>

<task type="auto">
  <name>Task 2: Migrate root pages</name>
  <files>index.html, 404.html, en/index.html</files>
  <action>
Run the migration script on root-level pages:

```bash
node scripts/migrate-pages.js "index.html"
node scripts/migrate-pages.js "404.html"
node scripts/migrate-pages.js "en/index.html"
```

Note: Skip google9d3fb813b4bab969.html (Google verification file, should not be modified)

After migration, verify each file:
1. Has front matter with `layout: layouts/base.liquid`
2. Has correct `lang:` (it for root, en for en/)
3. Has extracted title
4. Content between header and footer is preserved
5. For index.html: inline `<style>` block with lighthouse animations preserved via extraStyles

If any issues found, fix the migration script and re-run.
  </action>
  <verify>
```bash
head -10 index.html | grep -q "layout: layouts/base.liquid" && echo "IT index migrated"
head -10 en/index.html | grep -q "layout: layouts/base.liquid" && echo "EN index migrated"
grep -q "lighthouse" index.html && echo "Lighthouse styles preserved"
npm run build && echo "Build successful"
```
  </verify>
  <done>Root pages have front matter, correct lang attributes, preserved content and inline styles, build succeeds</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Migration script and migrated root pages (IT homepage, 404, EN homepage)</what-built>
  <how-to-verify>
1. Run: `npm run build`
2. Open in browser: `_site/index.html`
   - Should show IT homepage with header, lighthouse hero, footer
   - Navigation dropdowns work
   - Language switcher visible
   - Lighthouse animation CSS working (lighthouse should animate)
3. Open: `_site/en/index.html`
   - Should show EN homepage with English header/footer
   - Same visual appearance as IT but English labels
4. Open: `_site/404.html`
   - Should show 404 page with header/footer
5. Check for duplicates:
   - No double header (one header only)
   - No double footer (one footer only)
6. Check HTML lang attribute:
   - IT page: `<html lang="it">`
   - EN page: `<html lang="en">`
  </how-to-verify>
  <resume-signal>Type "approved" to proceed with bulk migration, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Migration script exists at scripts/migrate-pages.js
- Script runs without errors
- Root pages migrated with correct front matter
- 11ty build succeeds
- Visual check confirms header/footer render correctly
- No duplicate header/footer elements
- Inline styles (lighthouse animations) preserved and working
</verification>

<success_criteria>
1. scripts/migrate-pages.js exists and processes HTML files correctly
2. index.html has front matter with layout, title, lang: it, extraStyles for lighthouse
3. en/index.html has front matter with layout, title, lang: en
4. 404.html has front matter with layout, title, lang: it
5. `npm run build` succeeds
6. Visual verification confirms root pages render correctly with shared components
</success_criteria>

<output>
After completion, create `.planning/phases/37-pages/37-01-SUMMARY.md`
</output>
