---
phase: 14-propagation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/*.html (97 files need header update)
autonomous: true

must_haves:
  truths:
    - "Every page in src/pages/ displays the Collabora dropdown in header navigation"
    - "Collabora dropdown contains three items: Segnala un errore, Dai una mano, Il progetto"
    - "Mobile navigation displays Collabora items in flat list format"
  artifacts:
    - path: "src/pages/*.html"
      provides: "Collabora dropdown on all 138 pages"
      contains: "Collabora"
  key_links:
    - from: "src/pages/*.html header"
      to: "form.typeform.com/to/FsqvzdXI"
      via: "Segnala un errore link"
      pattern: 'href="https://form.typeform.com/to/FsqvzdXI"'
    - from: "src/pages/*.html header"
      to: "form.typeform.com/to/USx16QN3"
      via: "Dai una mano link"
      pattern: 'href="https://form.typeform.com/to/USx16QN3"'
    - from: "src/pages/*.html header"
      to: "chi-siamo.html"
      via: "Il progetto link in dropdown"
      pattern: 'href="chi-siamo.html".*Il progetto'
---

<objective>
Propagate Collabora dropdown to header navigation in all pages

Purpose: Replace the old "Il progetto" direct link with the Collabora dropdown menu in all 97 pages that still have the old header pattern. This brings error reporting and contribution links to every page.

Output: All pages in src/pages/ updated with Collabora dropdown in navigation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-collabora-dropdown/13-01-SUMMARY.md
@.planning/phases/14-propagation/14-RESEARCH.md

Reference template (Collabora dropdown from src/pages/index.html):
```html
<!-- Collabora with dropdown -->
<li class="nav-item has-dropdown">
  <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>
  <ul class="nav-dropdown" role="menu">
    <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>
    <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>
    <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>
  </ul>
</li>
```

Old header pattern to replace:
```html
<!-- Il progetto - no dropdown -->
<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Il progetto nav item with Collabora dropdown</name>
  <files>src/pages/*.html (97 files with old header)</files>
  <action>
Replace the single "Il progetto" nav item with the full Collabora dropdown structure.

The old pattern is a single line:
`<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>`

This needs to be replaced with the multi-line Collabora dropdown.

Strategy: Use Python or a script approach since sed multi-line replacement can be tricky. Process only files that have the old pattern.

```python
import os
import glob

old_pattern = '<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>'

new_template = '''            <!-- Collabora with dropdown -->
            <li class="nav-item has-dropdown">
              <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>
              <ul class="nav-dropdown" role="menu">
                <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>
                <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>
                <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>
              </ul>
            </li>'''

for filepath in glob.glob('src/pages/*.html'):
    with open(filepath, 'r') as f:
        content = f.read()

    if old_pattern in content:
        content = content.replace(old_pattern, new_template)
        with open(filepath, 'w') as f:
            f.write(content)
        print(f'Updated: {filepath}')
```

Alternative sed approach (if Python unavailable):
```bash
find src/pages -name "*.html" -type f -exec grep -l 'class="nav-item"><a href="chi-siamo.html"' {} \; | while read file; do
  sed -i '' 's|<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>|            <!-- Collabora with dropdown -->\
            <li class="nav-item has-dropdown">\
              <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>\
              <ul class="nav-dropdown" role="menu">\
                <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>\
                <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>\
                <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>\
              </ul>\
            </li>|' "$file"
done
```

Skip files that already have the Collabora dropdown (index.html, chi-siamo.html, permesso-lavoro-autonomo.html).
  </action>
  <verify>
Run verification commands:
```bash
# Count files with old header (should be 0)
grep -l 'class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto' src/pages/*.html | wc -l

# Count files with Collabora (should be 138)
grep -l "Collabora" src/pages/*.html | wc -l

# Spot check 3 random files
shuf -n 3 -e src/pages/*.html | xargs grep -A 8 "Collabora"
```
  </verify>
  <done>
- 0 files have old "Il progetto" as direct nav link
- 138 files have Collabora dropdown
- Spot check shows correct dropdown structure with all 3 items
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify dropdown structure and links</name>
  <files>None (verification only)</files>
  <action>
Verify that all Collabora dropdowns have the correct structure and links:

1. All have exactly 3 dropdown items
2. Segnala un errore points to FsqvzdXI form
3. Dai una mano points to USx16QN3 form
4. Il progetto points to chi-siamo.html

```bash
# Check Segnala un errore link in all files
grep -l "FsqvzdXI" src/pages/*.html | wc -l
# Expected: 138

# Check Dai una mano link in all files
grep -l "USx16QN3" src/pages/*.html | wc -l
# Expected: 138

# Verify Il progetto link in dropdown (not as standalone nav-link)
grep -l 'dropdown-link.*Il progetto' src/pages/*.html | wc -l
# Expected: 138
```
  </action>
  <verify>
All 138 files have:
- Segnala un errore link (FsqvzdXI)
- Dai una mano link (USx16QN3)
- Il progetto as dropdown-link (not nav-link)
  </verify>
  <done>
- All 3 dropdown items present in all files
- All Typeform URLs correct
- No orphaned old-style "Il progetto" nav links remain
  </done>
</task>

</tasks>

<verification>
Overall verification after all tasks:

```bash
# Final counts
echo "Files with Collabora dropdown:"
grep -l "Collabora" src/pages/*.html | wc -l
# Expected: 138

echo "Files with old Il progetto nav link:"
grep -l 'class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto' src/pages/*.html | wc -l
# Expected: 0

echo "Typeform links check:"
echo "FsqvzdXI (Segnala errore):"
grep -l "FsqvzdXI" src/pages/*.html | wc -l
echo "USx16QN3 (Dai una mano):"
grep -l "USx16QN3" src/pages/*.html | wc -l
```
</verification>

<success_criteria>
1. All 138 pages in src/pages/ have the Collabora dropdown in navigation
2. Zero pages have the old "Il progetto" as standalone nav-link
3. All Segnala un errore links point to FsqvzdXI form
4. All Dai una mano links point to USx16QN3 form
5. All Il progetto links in dropdown point to chi-siamo.html
</success_criteria>

<output>
After completion, create `.planning/phases/14-propagation/14-02-SUMMARY.md`
</output>
