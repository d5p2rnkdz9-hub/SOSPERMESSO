---
phase: 14-propagation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/index.html (add Posso convertire to existing Collabora dropdown)
  - src/pages/*.html (97 files need header update)
  - Note: 95 files have ONLY old pattern, 2 files have both old+new patterns
  - Note: 40 redirect-only files excluded
autonomous: true

must_haves:
  truths:
    - "Every full page in src/pages/ displays the Collabora dropdown in header navigation"
    - "Collabora dropdown contains four items: Segnala un errore, Posso convertire, Dai una mano, Il progetto"
    - "Mobile navigation displays Collabora items in flat list format"
  artifacts:
    - path: "src/pages/*.html"
      provides: "Collabora dropdown on all 98 full pages (excluding 40 redirect stubs)"
      contains: "Collabora"
  key_links:
    - from: "src/pages/*.html header"
      to: "form.typeform.com/to/FsqvzdXI"
      via: "Segnala un errore link"
      pattern: 'href="https://form.typeform.com/to/FsqvzdXI"'
    - from: "src/pages/*.html header"
      to: "form.typeform.com/to/oc9jhdkJ"
      via: "Posso convertire link"
      pattern: 'href="https://form.typeform.com/to/oc9jhdkJ"'
    - from: "src/pages/*.html header"
      to: "form.typeform.com/to/USx16QN3"
      via: "Dai una mano link"
      pattern: 'href="https://form.typeform.com/to/USx16QN3"'
    - from: "src/pages/*.html header"
      to: "chi-siamo.html"
      via: "Il progetto link in dropdown"
      pattern: 'href="chi-siamo.html".*Il progetto'
---

<objective>
Propagate Collabora dropdown to header navigation in all pages

Purpose: Replace the old "Il progetto" direct link with the Collabora dropdown menu (4 items: Segnala un errore, Posso convertire, Dai una mano, Il progetto) in all pages. Also add the new "Posso convertire" link to index.html which already has the dropdown.

Output: All full pages in src/pages/ updated with Collabora dropdown in navigation (excluding 40 redirect-only files)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-collabora-dropdown/13-01-SUMMARY.md
@.planning/phases/14-propagation/14-RESEARCH.md

Reference template (Collabora dropdown - UPDATED with Posso convertire):
```html
<!-- Collabora with dropdown -->
<li class="nav-item has-dropdown">
  <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>
  <ul class="nav-dropdown" role="menu">
    <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>
    <li role="none"><a href="https://form.typeform.com/to/oc9jhdkJ" class="dropdown-link" role="menuitem" target="_blank">Posso convertire</a></li>
    <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>
    <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>
  </ul>
</li>
```

Old header pattern to replace:
```html
<!-- Il progetto - no dropdown -->
<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>
```

File breakdown:
- 138 total HTML files in src/pages/
- 40 are redirect stubs (meta refresh only, no header)
- 98 are full pages with header structure
- 97 have old "Il progetto" nav-link pattern (need update)
- 95 have ONLY old pattern (full replacement needed)
- 2 have both old pattern AND Collabora (chi-siamo.html, permesso-lavoro-autonomo.html - need old pattern removed)
- 1 has Collabora with 3 items (index.html - needs Posso convertire added)
</context>

<tasks>

<task type="auto">
  <name>Task 0: Add Posso convertire to index.html Collabora dropdown</name>
  <files>src/pages/index.html</files>
  <action>
index.html already has the Collabora dropdown from Phase 13, but with only 3 items. Add "Posso convertire" as the second item (after Segnala un errore, before Dai una mano).

Find this block in the desktop nav:
```html
<li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>
<li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>
```

Insert after Segnala un errore:
```html
<li role="none"><a href="https://form.typeform.com/to/oc9jhdkJ" class="dropdown-link" role="menuitem" target="_blank">Posso convertire</a></li>
```

Also add to mobile nav section (look for the mobile Collabora items and add Posso convertire in same position).
  </action>
  <verify>
```bash
grep -c "oc9jhdkJ" src/pages/index.html
# Expected: 2 (one in desktop nav, one in mobile nav)
```
  </verify>
  <done>
- index.html has Posso convertire link in both desktop and mobile nav
- Link opens https://form.typeform.com/to/oc9jhdkJ in new tab
  </done>
</task>

<task type="auto">
  <name>Task 1: Replace Il progetto nav item with Collabora dropdown</name>
  <files>src/pages/*.html (97 files with old header)</files>
  <action>
Replace the single "Il progetto" nav item with the full Collabora dropdown structure.

The old pattern is a single line:
`<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>`

This needs to be replaced with the multi-line Collabora dropdown.

Strategy: Use Python or a script approach since sed multi-line replacement can be tricky. Process only files that have the old pattern.

```python
import os
import glob

old_pattern = '<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>'

new_template = '''            <!-- Collabora with dropdown -->
            <li class="nav-item has-dropdown">
              <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>
              <ul class="nav-dropdown" role="menu">
                <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>
                <li role="none"><a href="https://form.typeform.com/to/oc9jhdkJ" class="dropdown-link" role="menuitem" target="_blank">Posso convertire</a></li>
                <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>
                <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>
              </ul>
            </li>'''

for filepath in glob.glob('src/pages/*.html'):
    with open(filepath, 'r') as f:
        content = f.read()

    if old_pattern in content:
        content = content.replace(old_pattern, new_template)
        with open(filepath, 'w') as f:
            f.write(content)
        print(f'Updated: {filepath}')
```

Alternative sed approach (if Python unavailable):
```bash
find src/pages -name "*.html" -type f -exec grep -l 'class="nav-item"><a href="chi-siamo.html"' {} \; | while read file; do
  sed -i '' 's|<li class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto</a></li>|            <!-- Collabora with dropdown -->\
            <li class="nav-item has-dropdown">\
              <a href="#collabora" class="nav-link" aria-haspopup="true" aria-expanded="false">Collabora</a>\
              <ul class="nav-dropdown" role="menu">\
                <li role="none"><a href="https://form.typeform.com/to/FsqvzdXI" class="dropdown-link" role="menuitem" target="_blank">Segnala un errore</a></li>\
                <li role="none"><a href="https://form.typeform.com/to/oc9jhdkJ" class="dropdown-link" role="menuitem" target="_blank">Posso convertire</a></li>\
                <li role="none"><a href="https://form.typeform.com/to/USx16QN3" class="dropdown-link" role="menuitem" target="_blank">Dai una mano</a></li>\
                <li role="none"><a href="chi-siamo.html" class="dropdown-link" role="menuitem">Il progetto</a></li>\
              </ul>\
            </li>|' "$file"
done
```

Skip files that already have the Collabora dropdown (index.html). Files that have both patterns (chi-siamo.html, permesso-lavoro-autonomo.html) will have the old pattern removed by the replacement.
  </action>
  <verify>
Run verification commands:
```bash
# Count files with old header (should be 0)
grep -l 'class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto' src/pages/*.html | wc -l

# Count files with Collabora (should be 98 - all full pages)
grep -l "Collabora" src/pages/*.html | wc -l

# Spot check 3 random files
shuf -n 3 -e src/pages/*.html | xargs grep -A 8 "Collabora"
```
  </verify>
  <done>
- 0 files have old "Il progetto" as direct nav link
- 98 files have Collabora dropdown (all full pages)
- Spot check shows correct dropdown structure with all 4 items
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify dropdown structure, links, and mobile navigation</name>
  <files>None (verification only)</files>
  <action>
Verify that all Collabora dropdowns have the correct structure and links:

1. All have exactly 4 dropdown items
2. Segnala un errore points to FsqvzdXI form
3. Posso convertire points to oc9jhdkJ form
4. Dai una mano points to USx16QN3 form
5. Il progetto points to chi-siamo.html

```bash
# Check Segnala un errore link in all files
grep -l "FsqvzdXI" src/pages/*.html | wc -l
# Expected: 98 (all full pages)

# Check Posso convertire link in all files
grep -l "oc9jhdkJ" src/pages/*.html | wc -l
# Expected: 98 (all full pages)

# Check Dai una mano link in all files
grep -l "USx16QN3" src/pages/*.html | wc -l
# Expected: 98 (all full pages)

# Verify Il progetto link in dropdown (not as standalone nav-link)
grep -l 'dropdown-link.*Il progetto' src/pages/*.html | wc -l
# Expected: 98 (all full pages)
```

5. Verify mobile navigation handles dropdown-link class correctly

```bash
# Verify mobile.css has dropdown-link styles for flat list display
grep -c "dropdown-link" src/styles/mobile.css
# Expected: at least 1 match (styles exist from Phase 13)

# Verify app.js closes menu on dropdown-link click (mobile navigation)
grep -c "dropdown-link" src/scripts/app.js
# Expected: at least 1 match (event handler exists from Phase 13)

# Verify the mobile nav flat list behavior is configured
grep -A 5 "dropdown-link" src/styles/mobile.css
# Expected: shows mobile-specific styling for dropdown items
```
  </action>
  <verify>
All 98 full-page files have:
- Segnala un errore link (FsqvzdXI)
- Posso convertire link (oc9jhdkJ)
- Dai una mano link (USx16QN3)
- Il progetto as dropdown-link (not nav-link)

Mobile navigation verified:
- mobile.css has dropdown-link styles
- app.js handles dropdown-link click events for menu close
  </verify>
  <done>
- All 4 dropdown items present in all 98 full-page files
- All Typeform URLs correct
- No orphaned old-style "Il progetto" nav links remain
- Mobile navigation displays Collabora items correctly (CSS and JS confirmed)
  </done>
</task>

</tasks>

<verification>
Overall verification after all tasks:

```bash
# Final counts
echo "Files with Collabora dropdown:"
grep -l "Collabora" src/pages/*.html | wc -l
# Expected: 98 (all full pages, excluding 40 redirect stubs)

echo "Files with old Il progetto nav link:"
grep -l 'class="nav-item"><a href="chi-siamo.html" class="nav-link">Il progetto' src/pages/*.html | wc -l
# Expected: 0

echo "Typeform links check:"
echo "FsqvzdXI (Segnala errore):"
grep -l "FsqvzdXI" src/pages/*.html | wc -l
echo "oc9jhdkJ (Posso convertire):"
grep -l "oc9jhdkJ" src/pages/*.html | wc -l
echo "USx16QN3 (Dai una mano):"
grep -l "USx16QN3" src/pages/*.html | wc -l

echo "Mobile navigation support:"
grep -c "dropdown-link" src/styles/mobile.css
grep -c "dropdown-link" src/scripts/app.js
```
</verification>

<success_criteria>
1. All 98 full pages in src/pages/ have the Collabora dropdown in navigation
2. Zero pages have the old "Il progetto" as standalone nav-link
3. All Segnala un errore links point to FsqvzdXI form
4. All Posso convertire links point to oc9jhdkJ form
5. All Dai una mano links point to USx16QN3 form
6. All Il progetto links in dropdown point to chi-siamo.html
7. Mobile navigation CSS and JS handle dropdown-link class
</success_criteria>

<output>
After completion, create `.planning/phases/14-propagation/14-02-SUMMARY.md`
</output>
