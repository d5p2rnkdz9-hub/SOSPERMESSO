---
phase: 45-content-validation
plan: 03
type: execute
wave: 3
depends_on: ["45-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Site rebuilds successfully with updated Notion content"
    - "User reviews VALIDATION-REPORT.md and resolves conflicts"
    - "User spot-checks suggested permits in browser"
    - "User explicitly approves Phase 45 completion"
  artifacts: []
  key_links:
    - from: "npm run build"
      to: "_site/"
      via: "11ty build regenerates HTML from updated Notion data"
      pattern: "npm run build"
---

<objective>
Rebuild the site to reflect all Notion edits, then user reviews the validation report and spot-checks output in the browser.

Purpose: Verify that Notion edits appear correctly in generated HTML. User makes final decisions on conflicts and approves phase completion.
Output: Rebuilt site + user approval.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/45-content-validation/45-02-SUMMARY.md
@.planning/phases/45-content-validation/VALIDATION-REPORT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild site with updated Notion content</name>
  <files>No source files modified -- build output in _site/</files>
  <action>
Run the full site build to regenerate all pages from updated Notion content:

```bash
npm run build
```

After build completes:
1. Verify build succeeded (no errors, expected file count)
2. For 2-3 permits that were modified in Plan 02, check their generated HTML:
   - Open `_site/permesso-{slug}.html` and verify new/fixed content appears
   - Confirm no broken HTML or missing sections
3. Check document page output for any pages that were modified
4. Report build time and file count

If build fails, debug the issue. Common causes:
- Notion API rate limiting during build (retry after delay)
- Template errors from unexpected content format
  </action>
  <verify>
1. `npm run build` completes without errors
2. `_site/` contains expected number of files (~400+)
3. Spot-check 2-3 modified permit HTML files for correct content
  </verify>
  <done>
Site rebuilt successfully. Generated HTML reflects all Notion edits from Plan 02.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete content validation pass across all permit and document pages:
- Automated cross-reference of every permit's DB columns vs. page Q&A content (Plan 01)
- Phase 43 rule violations fixed directly in Notion (Plan 02)
- Missing sections added from database column data (Plan 02)
- Conflicts logged for your review (Plan 02)
- Site rebuilt with all changes (this plan)
  </what-built>
  <how-to-verify>
1. **Read the validation report:**
   Open `.planning/phases/45-content-validation/VALIDATION-REPORT.md`
   - Review "Changes Made" section -- do the additions and fixes look correct?
   - Review "Conflicts Requiring User Review" -- decide for each: update DB or update page?
   - Review "Placeholder Pages" -- any that should be populated now?

2. **Spot-check in browser:**
   Start local server if needed: `npx @11ty/eleventy --serve`
   Visit the permits suggested for spot-check in the report:
   - Do new sections read naturally?
   - Is the tone consistent ("tu" not "Lei")?
   - Are document links correct (point to real doc pages)?
   - No broken formatting or missing content?

3. **Resolve conflicts (if any):**
   For each conflict in the report, tell me:
   - "DB is correct, update page" -- I'll fix the Notion page
   - "Page is correct, update DB" -- I'll fix the Notion column
   - "Defer" -- skip for now

4. **Approve or request changes:**
   - If everything looks good: type "approved"
   - If issues found: describe what needs fixing
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 45, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds with updated Notion content
2. User reviews VALIDATION-REPORT.md
3. User spot-checks permits in browser
4. User resolves conflicts (if any)
5. User explicitly approves Phase 45
</verification>

<success_criteria>
- Site rebuilt with all Notion edits reflected in HTML output
- User has reviewed the validation report
- All conflicts resolved or explicitly deferred by user
- User approval received for Phase 45 completion
</success_criteria>

<output>
After completion, create `.planning/phases/45-content-validation/45-03-SUMMARY.md`
</output>
