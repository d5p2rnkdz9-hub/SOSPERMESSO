---
phase: 43-populate-blank-permits
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Exact list of permits needing content is verified against live Notion data"
    - "Duplicate permits (Residenza elettiva x2, Motivi religiosi x2) are merged into single pages"
    - "Reference model (Attesa occupazione) tone and structure is documented for downstream plans"
    - "Each blank permit is categorized by Macrocategoria for batch processing"
  artifacts:
    - path: ".planning/phases/43-populate-blank-permits/43-01-SUMMARY.md"
      provides: "Fresh audit results, duplicate cleanup confirmation, reference model analysis, categorized permit list"
  key_links:
    - from: "43-01-SUMMARY.md"
      to: "Plans 02, 03, 04"
      via: "Categorized permit list with Notion page IDs and content status"
      pattern: "permits_by_category"
---

<objective>
Audit all permits in Notion, merge duplicates, and prepare categorized work list for content population.

Purpose: Establish ground truth for which permits need content, resolve duplicates that would cause build conflicts, and document the reference model so all downstream plans write consistent content.

Output: Summary with categorized permit list (by Macrocategoria), duplicate cleanup confirmation, reference model analysis.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/TODO-permits.md
@.planning/AUDIT-content.md
@.planning/phases/43-populate-blank-permits/43-CONTEXT.md
@.planning/phases/43-populate-blank-permits/43-RESEARCH.md
@_data/permits.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit permits and study reference model</name>
  <files>None (Notion reads only)</files>
  <action>
1. **Study the reference model.** Use Notion MCP tool (`notion-fetch`) to read the "Attesa occupazione (art.22)" page (ID: `2f67355e-7f7f-813a-83f3-d5f229f0ba8c`). Document:
   - Exact section headings used (question text verbatim)
   - Tone patterns (tu/voi address, sentence structure)
   - How document lists are formatted
   - How "Posso lavorare?" info is presented
   - Any callouts, warnings, or special formatting

2. **Fetch fresh permit list.** Use Notion MCP tool (`notion-search`) to query the permit database (ID: `1ad7355e-7f7f-8088-a065-e814c92e2cfd`). For EACH permit, determine:
   - Nome permesso (name)
   - Macrocategoria (category)
   - Whether page blocks exist (has Q&A content or is blank)
   - Key column values: Posso lavorare?, Quanto dura?, Doc primo rilascio, Mod primo rilascio, posso convertire?, NOTES

3. **Cross-reference with TODO-permits.md** (17 permits listed as blank on 2026-02-01). Identify:
   - Which of the 17 are still blank in Notion
   - Any NEW blanks not in the old list
   - Any that were filled since the snapshot
   - The 2 "Unknown" entries (no Nome permesso) — confirm they're still filtered out

4. **Categorize permits needing content** by Macrocategoria:
   - protezione
   - lavoro
   - cure mediche
   - motivi familiari
   - altro

5. **Identify backfill candidates** — permits where old HTML in `src/pages/permesso-*.html` has content but Notion page blocks are empty. Read the HTML files for any permits on the blank list to check.

Record all findings in the SUMMARY.
  </action>
  <verify>
- Reference model analysis includes at least 7 section headings with exact text
- Complete permit list with content status (has_content / blank / backfill_candidate)
- Permits categorized by Macrocategoria with Notion page IDs
- Backfill candidates identified (if any)
- SUMMARY includes structured table with columns: Permit name, Notion ID, Macrocategoria, Status (blank/backfill/has_content)
  </verify>
  <done>Fresh, verified list of permits needing content, categorized by Macrocategoria, with Notion page IDs and content status for each.</done>
</task>

<task type="auto">
  <name>Task 2: Merge duplicate permits</name>
  <files>None (Notion operations only)</files>
  <action>
Two sets of duplicates exist in the Notion database:
- **Residenza elettiva**: IDs `2e77355e-7f7f-8058-beb5-cfcc98c6d2fe` and `1ad7355e-7f7f-80fb-aee6-da46ddbc7ac4`
- **Motivi religiosi**: IDs `2e77355e-7f7f-80f7-897e-d212e47bf04b` and `1ad7355e-7f7f-80a5-9738-cd59474a66a8`

For each duplicate pair:

1. **Read both pages** using `notion-fetch` to check which has more content (page blocks and column data).

2. **Keep the more complete page.** If both are equally blank, keep the one with ID starting with `2e7` (these appear to be the "original" entries based on the audit report ordering).

3. **Merge any unique column data** from the page being removed into the kept page using `notion-update-page`.

4. **Archive the duplicate.** Either:
   - Delete the duplicate page via Notion MCP if the tool supports it, OR
   - Rename it to "[DUPLICATE - DO NOT USE] Residenza elettiva" so the build system's deduplication (which keeps first occurrence by slug) effectively ignores it, OR
   - Note in the SUMMARY that user should manually archive it in Notion

5. **Verify** the build system's deduplication in `_data/permits.js` (line ~619) will handle any remaining edge cases — it already filters duplicates by slug, keeping first occurrence.

Record which page was kept and which was archived/deleted for each pair.
  </action>
  <verify>
- Both duplicate pairs resolved (2 pairs = 4 pages reduced to 2)
- Kept pages have merged column data from both originals
- SUMMARY documents which page ID was kept vs archived for each pair
  </verify>
  <done>Duplicate permits merged — "Residenza elettiva" and "Motivi religiosi" each have exactly one authoritative page in Notion.</done>
</task>

</tasks>

<verification>
1. Reference model (Attesa occupazione) fully analyzed with section headings, tone, and formatting patterns
2. Complete categorized list of permits needing content (grouped by Macrocategoria)
3. Exact count verified (may differ from old count of 17)
4. Both duplicate pairs resolved
5. Backfill vs generate candidates identified
</verification>

<success_criteria>
- Fresh audit data replaces outdated TODO-permits.md snapshot
- Zero duplicate permit names in database
- Categorized work list ready for Plans 02-04 to consume
- Reference model documented for consistent tone across all content
</success_criteria>

<output>
After completion, create `.planning/phases/43-populate-blank-permits/43-01-SUMMARY.md` with:
- Reference model analysis (section headings, tone patterns)
- Categorized permit list with: name, Notion ID, Macrocategoria, status (blank/backfill/has_content)
- Duplicate merge results
- Recommended processing order for Plans 02-04
</output>
