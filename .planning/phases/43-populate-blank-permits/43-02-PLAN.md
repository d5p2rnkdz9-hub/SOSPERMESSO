---
phase: 43-populate-blank-permits
plan: 02
type: execute
wave: 2
depends_on: ["43-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All blank protezione permits have Q&A content in Notion page blocks"
    - "Content matches reference model tone (conversational, tu address, accessible language)"
    - "Standard 7 Q&A sections present where data supports them"
    - "Build produces permit pages with rendered Q&A sections (no placeholder text)"
  artifacts:
    - path: ".planning/phases/43-populate-blank-permits/43-02-SUMMARY.md"
      provides: "List of protezione permits populated, content written, build verification"
  key_links:
    - from: "Notion page blocks"
      to: "_data/permits.js"
      via: "Notion API fetch during build"
      pattern: "fetchPageBlocks -> parseQASections"
---

<objective>
Populate all blank protezione category permits with Q&A content in Notion.

Purpose: Protezione permits serve vulnerable populations (asylum seekers, refugees, trafficking victims). Filling these first gives the most critical user group access to complete information.

Output: All protezione permits have Q&A page blocks in Notion. Built pages render with full content.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/43-populate-blank-permits/43-CONTEXT.md
@.planning/phases/43-populate-blank-permits/43-RESEARCH.md
@.planning/phases/43-populate-blank-permits/43-01-SUMMARY.md
@_data/permits.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write Q&A content for protezione permits</name>
  <files>None (Notion writes only)</files>
  <action>
**Prerequisite check:** Before processing any permits, read 43-01-SUMMARY.md and confirm that duplicate permits (Residenza elettiva, Motivi religiosi) have been merged. If duplicates are not resolved, STOP and flag as blocker.

Using the categorized list from Plan 01 SUMMARY, process all **protezione** category permits that need content.

**Known protezione permits likely needing content** (verify against 01 SUMMARY):
- Protezione sociale vittime di violenza domestica (art.18 bis) — ID: `2ef7355e-7f7f-8000-9c13-cea8a7c0c0df`
- Familiari di titolari di status di rifugiato o protezione sussidiaria — ID: `2ef7355e-7f7f-801c-ba02-edc8ccf9e8bc`
- Apolidia (art.17 D.P.R. n. 572/93) — ID: `2e77355e-7f7f-804d-91cb-d88e50daec05`

**For each blank permit:**

1. **Read existing data** from Notion database columns using `notion-fetch`:
   - Posso lavorare? (maps to "Che diritti mi da?")
   - Quanto dura? (maps to "Quanto dura?")
   - Mod primo rilascio (maps to "Come/dove si chiede?")
   - Doc primo rilascio (maps to document checklist)
   - posso convertire? (maps to "Posso convertirlo?")
   - NOTES column (additional context)

2. **Check for backfill content** — if Plan 01 identified HTML content in `src/pages/permesso-*.html` for this permit, use that as the primary content source. Convert HTML Q&A sections to Notion Markdown format.

3. **Transform column data into Q&A narrative** following the reference model tone from Plan 01 SUMMARY. Write content using these standard sections:

   ```
   **Che cos'e questo permesso?**
   [Narrative from NOTES + permit context. Conversational tone, "tu" address.]

   **Chi puo chiederlo?**
   [From NOTES. Who qualifies for this permit.]

   **Come/dove si chiede?**
   [From "Mod primo rilascio" column: KIT -> posta, QUESTURA -> questura, SPORTELLO -> sportello unico]

   **Che diritti mi da? A cosa ho accesso?**
   [From "Posso lavorare?" column. Expand to include SSN, residenza, etc.]

   **Quanto dura questo permesso?**
   [From "Quanto dura?" column. Add renewal context if in NOTES.]

   **Quando scade posso rinnovarlo?**
   [From NOTES or general renewal info for this permit type.]

   **Posso convertirlo in un altro permesso?**
   [From "posso convertire?" column. Only include if column has value.]
   ```

4. **Write content to Notion** using `notion-update-page` MCP tool with:
   - `page_id`: the permit's Notion page ID
   - `command`: "replace_content" (for blank pages) or appropriate command
   - `new_str`: the Q&A Markdown content

   **IMPORTANT:** Use Notion enhanced Markdown format. Bold text with `**text**`, lists with `- item`, paragraphs separated by blank lines.

5. **Verify each write** by re-fetching the page with `notion-fetch` to confirm blocks were created.

**Tone reminders** (from Attesa occupazione reference):
- Use "tu" not "Lei" or "voi"
- Short sentences, simple vocabulary
- "Con questo permesso puoi..." not "Il titolare del permesso ha facolta di..."
- Use emoji sparingly for section markers (only standard ones like checkmark for diritti)
- Lists for documents and rights, paragraphs for explanations
  </action>
  <verify>
- Duplicate merge confirmed from 43-01-SUMMARY.md before content population started
- Each protezione permit page has Q&A blocks when fetched from Notion (run notion-fetch for each page ID, confirm block count > 0 with heading + paragraph block types)
- At least 5 Q&A sections per permit (some may not have all 7 if data is limited)
- Content uses conversational "tu" tone
- Document lists formatted as bulleted lists
  </verify>
  <done>All protezione permits have Q&A content in Notion matching reference model tone and structure.</done>
</task>

<task type="auto">
  <name>Task 2: Build and verify protezione pages</name>
  <files>None (build output in _site/)</files>
  <action>
1. Run the build: `npm run build` from project root.

2. Check build output for each protezione permit:
   - Verify the built HTML files exist in `_site/permesso-*.html`
   - Verify they contain Q&A section cards (look for `<div class="card"` with `<h2>` headings)
   - Verify they do NOT show the placeholder "Contenuto in arrivo" text
   - Verify the `isPlaceholder` flag is false for these permits in the build log

3. Count the Q&A sections in each built page to confirm they match what was written to Notion.

4. Note any rendering issues for the checkpoint.
  </action>
  <verify>
- `npm run build` completes without errors
- Each protezione permit page in `_site/` contains Q&A cards (not placeholder)
- Build log shows `isPlaceholder: false` for populated permits
  </verify>
  <done>Build produces rendered Q&A pages for all protezione permits.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Q&A content for all protezione category permits (asylum, refugee family members, trafficking victims, statelessness). Content written to Notion and rendered via 11ty build.</what-built>
  <how-to-verify>
1. Open the built site locally or check `_site/` directory
2. Review each protezione permit page:
   - Check the tone matches the Attesa occupazione reference (conversational, simple)
   - Check content accuracy (does the info make sense for this permit type?)
   - Check completeness (are all relevant sections present?)
   - Check formatting (lists render properly, no broken HTML)
3. Specific pages to check (exact URLs depend on Plan 01 audit results):
   - `_site/permesso-apolidia-art-17-d-p-r-n-572-93.html`
   - `_site/permesso-protezione-sociale-vittime-di-violenza-domestica-art-18-bis.html`
   - `_site/permesso-familiari-di-titolari-di-status-di-rifugiato-o-protezione-sussidiaria.html`
  </how-to-verify>
  <resume-signal>Type "approved" to proceed to lavoro category, or describe issues to fix.</resume-signal>
</task>

</tasks>

<verification>
1. All protezione permits populated in Notion (no blank page blocks)
2. Build produces Q&A pages (not placeholder pages) for all protezione permits
3. User has spot-checked and approved the content quality
</verification>

<success_criteria>
- Zero protezione permits showing "Contenuto in arrivo" placeholder
- User-approved content tone and accuracy for protezione batch
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/43-populate-blank-permits/43-02-SUMMARY.md` with:
- List of protezione permits populated (name, ID, section count)
- Any issues found during build verification
- User feedback from checkpoint
</output>
