---
phase: 34-cjk-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/cjk.css
autonomous: true

must_haves:
  truths:
    - "Chinese fonts render correctly when lang='zh' is set"
    - "Italic text displays as normal (non-slanted) in CJK pages"
    - "Long Chinese text wraps at character boundaries without overflow"
    - "Line spacing is comfortable and readable for CJK characters"
  artifacts:
    - path: "src/styles/cjk.css"
      provides: "CJK typography infrastructure"
      min_lines: 80
      contains:
        - "[lang=\"zh\"]"
        - "font-family"
        - "line-height"
        - "font-style: normal"
        - "word-break"
  key_links:
    - from: "src/styles/cjk.css"
      to: "[lang=\"zh\"]"
      via: "CSS language selector"
      pattern: "\\[lang=\"zh\"\\]"
---

<objective>
Create CJK typography infrastructure with font stacks, line-height adjustments, italic overrides, and word-break rules.

Purpose: Enable Chinese (and Japanese/Korean) translations with correct typography that respects CJK typographic conventions.

Output: A new `cjk.css` file that provides proper CJK support when pages have `lang="zh"` (or `lang="ja"`, `lang="ko"`) attribute.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-cjk-infrastructure/34-RESEARCH.md
@.planning/phases/33-rtl-infrastructure/33-01-SUMMARY.md

Reference files:
@src/styles/rtl.css (similar pattern for language-specific styling)
@src/styles/components.css (italic usage at line 1117 - .hero-tagline)
@src/styles/document-page.css (italic usage at line 152 - .disputed-note)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cjk.css with font stacks and base typography</name>
  <files>src/styles/cjk.css</files>
  <action>
Create `src/styles/cjk.css` with CJK typography infrastructure:

1. **Header comment** explaining CJK Typography Infrastructure purpose

2. **Chinese (Simplified) font stack** for `[lang="zh"]` and `[lang="zh-CN"]`:
   - Primary: "PingFang SC" (macOS)
   - Fallbacks: "Microsoft YaHei" (Windows), "Noto Sans SC" (Android/Linux), "Hiragino Sans GB", sans-serif

3. **Chinese (Traditional) font stack** for `[lang="zh-TW"]` and `[lang="zh-HK"]`:
   - Primary: "PingFang TC" (macOS)
   - Fallbacks: "Microsoft JhengHei" (Windows), "Noto Sans TC" (Android/Linux), "Hiragino Sans CNS", sans-serif

4. **Japanese font stack** for `[lang="ja"]`:
   - Primary: "Hiragino Sans", "Hiragino Kaku Gothic ProN" (macOS)
   - Fallbacks: "Yu Gothic" (Windows), "Noto Sans JP" (Android/Linux), "Meiryo", sans-serif

5. **Korean font stack** for `[lang="ko"]`:
   - Primary: "Noto Sans KR"
   - Fallbacks: "Nanum Gothic", "Malgun Gothic" (Windows), "Apple SD Gothic Neo" (macOS), sans-serif

6. **Line-height adjustments**:
   - Body text: `line-height: 1.8` for all CJK languages
   - Headings (h1-h4): `line-height: 1.5`
   - Hero title: `line-height: 1.4` (large display text can be tighter)

7. **Letter-spacing override**:
   - All CJK: `letter-spacing: normal !important` to prevent spacing being applied
  </action>
  <verify>
    - File exists at src/styles/cjk.css
    - Contains font-family rules for [lang="zh"], [lang="ja"], [lang="ko"]
    - Contains line-height: 1.8 for body text
    - Contains letter-spacing: normal !important
  </verify>
  <done>CJK font stacks and line-height rules defined for Chinese, Japanese, Korean</done>
</task>

<task type="auto">
  <name>Task 2: Add italic overrides for CJK languages</name>
  <files>src/styles/cjk.css</files>
  <action>
Add italic override rules to cjk.css:

1. **Global italic override** (catches all cases):
   ```css
   /* CJK languages don't use italics - override to normal */
   [lang="zh"] *,
   [lang="zh-CN"] *,
   [lang="zh-TW"] *,
   [lang="zh-HK"] *,
   [lang="ja"] *,
   [lang="ko"] * {
     font-style: normal !important;
   }
   ```

2. **Specific class overrides** (for known italic selectors):
   - `.hero-tagline` (components.css:1117)
   - `.disputed-note` (document-page.css:152)
   - `em`, `i` semantic elements

3. **Optional text-emphasis** (progressive enhancement):
   - Japanese: `text-emphasis: dot; text-emphasis-position: over right;`
   - Chinese: `text-emphasis: sesame; text-emphasis-position: under right;`
   - Korean: `font-weight: 700;` (bold instead of dots)

Note: Use !important for global override since these must always win over component styles.
  </action>
  <verify>
    - cjk.css contains font-style: normal rules
    - Selectors cover [lang="zh"], [lang="ja"], [lang="ko"]
    - Text-emphasis rules exist (optional enhancement)
  </verify>
  <done>Italic text displays as normal (non-slanted) when CJK language is set</done>
</task>

<task type="auto">
  <name>Task 3: Add word-break rules for character-based text</name>
  <files>src/styles/cjk.css</files>
  <action>
Add word-break rules to cjk.css:

1. **Chinese and Japanese word-break** (break at any character):
   ```css
   [lang="zh"],
   [lang="zh-CN"],
   [lang="zh-TW"],
   [lang="zh-HK"],
   [lang="ja"] {
     word-break: normal; /* Browser default breaks at characters */
     overflow-wrap: break-word; /* Safety for URLs/long strings */
   }
   ```

2. **Korean word-break** (uses spaces like English):
   ```css
   [lang="ko"] {
     word-break: normal;
     overflow-wrap: break-word;
   }
   ```

3. **Override existing keep-all rules** for CJK:
   - components.css has `.card h2 { word-break: keep-all; }`
   - Add override: `.card h2:lang(zh), .card h2:lang(ja) { word-break: normal; }`
   - Or use `[lang="zh"] .card h2, [lang="ja"] .card h2 { word-break: normal; }`

4. **Ensure no horizontal overflow** with long Chinese text
  </action>
  <verify>
    - cjk.css contains word-break rules
    - Contains overflow-wrap: break-word for safety
    - Override for .card h2 exists for Chinese/Japanese
  </verify>
  <done>Long CJK text wraps correctly at character boundaries without horizontal overflow</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **File check:**
   ```bash
   cat src/styles/cjk.css | head -100
   ```
   - File exists with proper structure
   - Contains all CJK language selectors

2. **Content validation:**
   ```bash
   grep -c "\[lang=\"zh\"\]" src/styles/cjk.css  # Should show multiple matches
   grep "font-family" src/styles/cjk.css | head -5  # Show font stack
   grep "font-style: normal" src/styles/cjk.css  # Show italic overrides
   grep "word-break" src/styles/cjk.css  # Show word-break rules
   ```

3. **Manual browser test:**
   - Create a test copy: `cp src/pages/chi-siamo.html src/pages/test-cjk.html`
   - Add `lang="zh"` to `<html>` tag
   - Add `<link rel="stylesheet" href="../styles/cjk.css">` to `<head>`
   - Add sample Chinese text: "这是测试文本"
   - Open in browser and verify:
     - Chinese text uses proper fonts
     - No italic/slanted text
     - Long text wraps correctly
     - Line spacing looks comfortable
</verification>

<success_criteria>
1. `src/styles/cjk.css` exists with 80+ lines
2. Font stacks defined for Chinese (Simplified/Traditional), Japanese, Korean
3. Line-height: 1.8 for body text, 1.5 for headings
4. Italic text displays as normal (font-style: normal override)
5. Word-break allows character-level breaking for Chinese/Japanese
6. No letter-spacing applied to CJK text
7. Git commit created with feat(34-01): message
</success_criteria>

<output>
After completion, create `.planning/phases/34-cjk-infrastructure/34-01-SUMMARY.md` following the template at @./.claude/get-shit-done/templates/summary.md
</output>
