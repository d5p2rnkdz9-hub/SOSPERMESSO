---
phase: 36-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - eleventy.config.mjs
  - _data/site.js
  - _data/nav.js
  - _data/footer.js
  - _includes/layouts/base.liquid
autonomous: true

must_haves:
  truths:
    - "11ty config includes _includes directory setting"
    - "Site-wide data (name, URL, year) accessible in templates"
    - "Navigation items for IT and EN defined in data file"
    - "Footer links for IT and EN defined in data file"
    - "Base layout contains complete HTML document structure"
  artifacts:
    - path: "_includes/layouts/base.liquid"
      provides: "HTML document wrapper with doctype, head, body"
      contains: "<!DOCTYPE html>"
    - path: "_data/site.js"
      provides: "Site configuration (name, url, year)"
      exports: "module.exports"
    - path: "_data/nav.js"
      provides: "Navigation items keyed by language"
      contains: "it:"
    - path: "_data/footer.js"
      provides: "Footer links keyed by language"
      contains: "it:"
  key_links:
    - from: "_includes/layouts/base.liquid"
      to: "site.*"
      via: "Liquid variable access"
      pattern: "site\\."
    - from: "eleventy.config.mjs"
      to: "_includes"
      via: "dir.includes setting"
      pattern: "includes.*_includes"
---

<objective>
Create the foundation for 11ty component extraction: base layout template and data files for site config, navigation, and footer content.

Purpose: Establish the data layer and base HTML structure that component includes will plug into in Plan 02.
Output: Base layout template, site/nav/footer data files, updated 11ty config
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-components/36-RESEARCH.md
@eleventy.config.mjs
@index.html (reference for header/footer/nav structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create data files for site config, navigation, and footer</name>
  <files>
    _data/site.js
    _data/nav.js
    _data/footer.js
  </files>
  <action>
Create three JavaScript data files in the existing `_data/` directory:

**_data/site.js** - Site-wide configuration:
```javascript
module.exports = {
  name: "SOS Permesso",
  url: "https://www.sospermesso.it",
  year: new Date().getFullYear(),
  defaultDescription: "Guida completa ai permessi di soggiorno in Italia"
};
```

**_data/nav.js** - Navigation items keyed by language (it/en):
- Extract navigation structure from index.html (IT) and en/index.html (EN)
- Include all 4 dropdowns: Database, Guide, Test, Collabora
- For internal links, use root-relative paths (e.g., `/src/pages/database.html`)
- For EN internal links, use `/en/src/pages/...`
- External links (Typeform) stay as absolute URLs
- Include `external: true` flag for links that should open in new tab

**_data/footer.js** - Footer links keyed by language (it/en):
- IT: Il Progetto, Chi Siamo, Privacy e altro (link to `/src/pages/...`)
- EN: The Project, About Us, Privacy and more (link to `/en/src/pages/...`)

Use CommonJS format (`module.exports = {}`) to match existing `_data/eleventyComputed.js`.
  </action>
  <verify>
```bash
node -c _data/site.js && echo "site.js: valid syntax"
node -c _data/nav.js && echo "nav.js: valid syntax"
node -c _data/footer.js && echo "footer.js: valid syntax"
```
  </verify>
  <done>All three data files exist with valid JavaScript syntax, containing IT and EN content</done>
</task>

<task type="auto">
  <name>Task 2: Create base layout template</name>
  <files>
    _includes/layouts/base.liquid
  </files>
  <action>
Create the directory structure and base layout file:

```bash
mkdir -p _includes/layouts _includes/components
```

Create `_includes/layouts/base.liquid` with:

1. **DOCTYPE and html tag** with dynamic lang attribute:
   - `<html lang="{{ lang | default: 'it' }}">`

2. **Complete head section** extracted from index.html:
   - meta charset, viewport
   - meta description using `{{ description | default: site.defaultDescription }}`
   - title using `{% if title %}{{ title }} - {% endif %}{{ site.name }}`
   - Favicon links using `{{ '/IMAGES/logo-full.png' | url }}`
   - Open Graph meta tags (og:type, og:url, og:title, og:description, og:image)
   - Font preconnect and Google Fonts link (Inter, Poppins, DM Serif Display)
   - All 5 stylesheet links using `{{ '/src/styles/...' | url }}` for each
   - Optional `{% if extraStyles %}{{ extraStyles }}{% endif %}` for page-specific styles

3. **Body structure**:
   - Placeholder comments for header/footer includes (to be added in Plan 02):
     ```liquid
     {%- comment -%}Header include goes here in Plan 02{%- endcomment -%}
     ```
   - `{{ content }}` for page content
   - Placeholder for footer include
   - Script tags using `{{ '/src/scripts/app.js' | url }}` and `{{ '/src/scripts/mobile.js' | url }}`
   - Optional `{% if extraScripts %}{{ extraScripts }}{% endif %}`

Use `{{ '...' | url }}` filter for ALL asset paths (CSS, JS, images) - this is critical for path resolution.
  </action>
  <verify>
```bash
# Verify file exists and has DOCTYPE
head -1 _includes/layouts/base.liquid | grep -q "<!DOCTYPE html>" && echo "Has DOCTYPE"
# Verify uses url filter for assets
grep -c "| url" _includes/layouts/base.liquid
# Verify has content variable
grep -q "{{ content }}" _includes/layouts/base.liquid && echo "Has content variable"
```
  </verify>
  <done>Base layout exists at `_includes/layouts/base.liquid` with complete HTML structure, url filters for all assets, and {{ content }} insertion point</done>
</task>

<task type="auto">
  <name>Task 3: Update 11ty config and verify build</name>
  <files>
    eleventy.config.mjs
  </files>
  <action>
Update the existing `eleventy.config.mjs` to explicitly set the includes directory:

1. Add to the return object:
```javascript
return {
  dir: {
    input: ".",
    output: "_site",
    includes: "_includes"  // Add this line
  },
  // ... rest of existing config
};
```

2. Run build to verify no errors:
```bash
npm run build
```

The build should complete successfully. Since no pages use the layout yet (that's Phase 37), the base.liquid file won't be rendered directly - it's just included infrastructure.

3. Verify data files are accessible by checking 11ty recognizes them:
```bash
npx @11ty/eleventy --dryrun 2>&1 | head -20
```
  </action>
  <verify>
```bash
# Build completes without errors
npm run build 2>&1 | tail -5
# Verify _site directory still has expected output
ls _site/index.html && echo "Build output exists"
```
  </verify>
  <done>11ty config updated with includes directory, build completes without errors</done>
</task>

</tasks>

<verification>
1. `_data/` directory contains: site.js, nav.js, footer.js, eleventyComputed.js
2. `_includes/layouts/base.liquid` exists with DOCTYPE, head, body structure
3. `_includes/components/` directory created (empty, for Plan 02)
4. `npm run build` completes without errors
5. No regression: all 415 HTML files still build to correct paths
</verification>

<success_criteria>
- All data files valid JavaScript with IT/EN content
- Base layout has complete HTML document structure
- All asset paths use `{{ '...' | url }}` filter
- Build completes without errors
- Foundation ready for Plan 02 component includes
</success_criteria>

<output>
After completion, create `.planning/phases/36-components/36-01-SUMMARY.md`
</output>
