---
phase: 36-components
plan: 02
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - _includes/layouts/base.liquid
  - _includes/components/header.liquid
  - _includes/components/nav.liquid
  - _includes/components/footer.liquid
  - _includes/components/language-switcher.liquid
autonomous: false

must_haves:
  truths:
    - "Header displays logo, language switcher, and navigation"
    - "Navigation renders all 4 dropdowns with correct IT/EN labels"
    - "Footer displays links and copyright with correct IT/EN content"
    - "Language switcher shows current language and all 5 options"
    - "Base layout includes all component files"
  artifacts:
    - path: "_includes/components/header.liquid"
      provides: "Site header with logo, language switcher, nav"
      contains: "class=\"header\""
    - path: "_includes/components/nav.liquid"
      provides: "Navigation menu from data file"
      contains: "nav[lang]"
    - path: "_includes/components/footer.liquid"
      provides: "Site footer with links and copyright"
      contains: "class=\"footer\""
    - path: "_includes/components/language-switcher.liquid"
      provides: "Language dropdown component"
      contains: "language-switcher"
  key_links:
    - from: "_includes/layouts/base.liquid"
      to: "_includes/components/header.liquid"
      via: "Liquid include"
      pattern: "include.*header"
    - from: "_includes/layouts/base.liquid"
      to: "_includes/components/footer.liquid"
      via: "Liquid include"
      pattern: "include.*footer"
    - from: "_includes/components/nav.liquid"
      to: "_data/nav.js"
      via: "nav[lang] data access"
      pattern: "nav\\[lang\\]"
    - from: "_includes/components/footer.liquid"
      to: "_data/footer.js"
      via: "footer[lang] data access"
      pattern: "footer\\[lang\\]"
---

<objective>
Extract header, footer, navigation, and language switcher into reusable Liquid includes, then wire them into the base layout.

Purpose: Complete the component extraction so Phase 37 can convert pages to use the shared layout.
Output: Four component includes, updated base layout with includes
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-components/36-RESEARCH.md
@.planning/phases/36-components/36-01-SUMMARY.md
@_includes/layouts/base.liquid
@_data/nav.js
@_data/footer.js
@index.html (reference for HTML structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create component includes (header, nav, footer, language-switcher)</name>
  <files>
    _includes/components/header.liquid
    _includes/components/nav.liquid
    _includes/components/footer.liquid
    _includes/components/language-switcher.liquid
  </files>
  <action>
Create four component include files based on the HTML structure in index.html:

**_includes/components/language-switcher.liquid:**
- Extract the `<div class="language-switcher">...</div>` from index.html
- Make the current language display dynamic based on `lang` variable:
  - If `lang == 'en'`: show "EN" with GB flag
  - Otherwise: show "IT" with IT flag
- Keep all 5 language options (IT, EN, FR, ES, ZH) static - JS handles switching

**_includes/components/nav.liquid:**
- Create `<div class="nav-wrapper">` with `<ul class="nav-menu">`
- Loop through `nav[lang]` data to render navigation items:
  ```liquid
  {% for item in nav[lang] %}
  <li class="nav-item{% if item.children %} has-dropdown{% endif %}">
    <a href="{{ item.url | url }}" class="nav-link"
       {% if item.external %}target="_blank"{% endif %}
       {% if item.children %}aria-haspopup="true" aria-expanded="false"{% endif %}>
      {{ item.label }}
    </a>
    {% if item.children %}
    <ul class="nav-dropdown" role="menu">
      {% for child in item.children %}
      <li role="none">
        <a href="{{ child.url | url }}" class="dropdown-link" role="menuitem"
           {% if child.external %}target="_blank"{% endif %}>
          {{ child.label }}
        </a>
      </li>
      {% endfor %}
    </ul>
    {% endif %}
  </li>
  {% endfor %}
  ```
- IMPORTANT: Use `{{ item.url | url }}` for internal links, but NOT for external (Typeform) links

**_includes/components/header.liquid:**
- Extract `<header class="header">...</header>` structure
- Logo links to home: `{% if lang == 'en' %}{{ '/en/' | url }}{% else %}{{ '/' | url }}{% endif %}`
- Logo image: `{{ '/IMAGES/logo-full.png' | url }}`
- Include language-switcher: `{% include "components/language-switcher.liquid" %}`
- Mobile menu toggle button
- Include nav: `{% include "components/nav.liquid" %}`

**_includes/components/footer.liquid:**
- Extract `<footer class="footer">...</footer>` structure
- Loop through `footer[lang].links` for footer links:
  ```liquid
  {% assign footerData = footer[lang] | default: footer.it %}
  {% for link in footerData.links %}
    <a href="{{ link.url | url }}" class="footer-project-link">{{ link.label }}</a>
    {% unless forloop.last %}<span class="footer-separator">|</span>{% endunless %}
  {% endfor %}
  ```
- Copyright: `&copy; {{ site.year }} {{ site.name }}`

Use `{{ '...' | url }}` filter for ALL internal paths. External URLs (https://...) should NOT use the url filter.
  </action>
  <verify>
```bash
# All component files exist
ls -la _includes/components/
# Check for url filter usage (should be multiple per file)
grep -c "| url" _includes/components/header.liquid
grep -c "| url" _includes/components/nav.liquid
# Check data file access patterns
grep "nav\[lang\]" _includes/components/nav.liquid
grep "footer\[lang\]" _includes/components/footer.liquid
```
  </verify>
  <done>All four component includes exist with correct HTML structure, url filters, and data file access</done>
</task>

<task type="auto">
  <name>Task 2: Wire includes into base layout</name>
  <files>
    _includes/layouts/base.liquid
  </files>
  <action>
Update `_includes/layouts/base.liquid` to include the component files:

1. Replace the header placeholder comment with:
   ```liquid
   {% include "components/header.liquid" %}
   ```

2. Replace the footer placeholder comment with:
   ```liquid
   {% include "components/footer.liquid" %}
   ```

The body structure should now be:
```liquid
<body>
  {% include "components/header.liquid" %}

  {{ content }}

  {% include "components/footer.liquid" %}

  <!-- Scripts -->
  <script src="{{ '/src/scripts/app.js' | url }}"></script>
  <script src="{{ '/src/scripts/mobile.js' | url }}"></script>
  {% if extraScripts %}{{ extraScripts }}{% endif %}
</body>
```

3. Run build to verify no template errors:
```bash
npm run build
```

The build should complete successfully. Template syntax errors will appear if includes are malformed.
  </action>
  <verify>
```bash
# Verify includes are wired
grep -c "include.*header" _includes/layouts/base.liquid
grep -c "include.*footer" _includes/layouts/base.liquid
# Build succeeds
npm run build 2>&1 | tail -3
```
  </verify>
  <done>Base layout includes header and footer components, build completes without template errors</done>
</task>

<task type="auto">
  <name>Task 3: Create test page to verify components render correctly</name>
  <files>
    _test-layout.html
  </files>
  <action>
Create a temporary test page to verify the layout and components work:

```html
---
layout: layouts/base.liquid
title: Layout Test
lang: it
description: Testing the new 11ty layout system
---
<main class="section">
  <div class="container">
    <h1>Layout Test Page</h1>
    <p>If you can see this content with header and footer, the layout system works!</p>
    <ul>
      <li>Header should show logo, language switcher (IT), navigation</li>
      <li>Footer should show Il Progetto, Chi Siamo, Privacy links</li>
      <li>Navigation should have 4 dropdowns: Database, Guide, Test, Collabora</li>
    </ul>
  </div>
</main>
```

Run build and check the output:
```bash
npm run build
cat _site/_test-layout.html | head -50
```

The output should show:
- DOCTYPE and full HTML structure
- Header with navigation
- Test content
- Footer with links

Also create an EN test:
```html
---
layout: layouts/base.liquid
title: Layout Test EN
lang: en
---
<main class="section">
  <div class="container">
    <h1>English Layout Test</h1>
    <p>Header should show EN flag, footer should show English labels.</p>
  </div>
</main>
```

Save as `_test-layout-en.html` and verify EN content renders.
  </action>
  <verify>
```bash
# Build and check IT test page
npm run build
# Check header appears in output
grep -q "class=\"header\"" _site/_test-layout.html && echo "Header present"
# Check footer appears
grep -q "class=\"footer\"" _site/_test-layout.html && echo "Footer present"
# Check navigation dropdowns
grep -c "nav-dropdown" _site/_test-layout.html
# Check EN test page has English content
grep "About Us\|The Project" _site/_test-layout-en.html || echo "Check EN nav data"
```
  </verify>
  <done>Test pages render with complete header/footer/nav from layout system</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete 11ty layout system with reusable header, footer, navigation, and language switcher components. Test pages demonstrate IT and EN variants.
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:8080/_test-layout.html
3. Verify:
   - Header displays with logo (top left), language switcher (IT flag), hamburger menu
   - Navigation has 4 dropdowns: Database, Guide, Test, Collabora
   - Hover over each dropdown - child links should appear
   - Footer shows: Il Progetto | Chi Siamo | Privacy e altro | copyright
   - Page content ("Layout Test Page") appears between header and footer

4. Open http://localhost:8080/_test-layout-en.html
5. Verify:
   - Language switcher shows "EN" with GB flag
   - Navigation labels are in English (Database, Guides, Test, Collaborate)
   - Footer links are in English (The Project, About Us, Privacy and more)

6. Test mobile:
   - Resize browser to mobile width (~375px)
   - Hamburger menu should appear
   - Click hamburger - navigation should expand
   - Dropdowns should work on mobile
  </how-to-verify>
  <resume-signal>Type "approved" if components render correctly, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Task 4: Clean up test files</name>
  <files>
    _test-layout.html
    _test-layout-en.html
  </files>
  <action>
After user approval, remove the test files:

```bash
rm _test-layout.html _test-layout-en.html
npm run build
```

Verify clean build with no test files in output:
```bash
ls _site/_test-layout*.html 2>/dev/null || echo "Test files cleaned up"
```
  </action>
  <verify>
```bash
# Test files removed from source
ls _test-layout*.html 2>/dev/null || echo "Source files removed"
# Test files removed from output
ls _site/_test-layout*.html 2>/dev/null || echo "Output files removed"
# Build still works
npm run build 2>&1 | tail -3
```
  </verify>
  <done>Test files removed, clean build verified</done>
</task>

</tasks>

<verification>
1. All component includes exist in `_includes/components/`
2. Base layout includes header and footer
3. IT test page shows Italian navigation and footer
4. EN test page shows English navigation and footer
5. Dropdowns work on hover (desktop)
6. Mobile hamburger menu works
7. Build completes without errors
8. Test files cleaned up
</verification>

<success_criteria>
- Header include renders logo, language switcher, navigation
- Navigation renders 4 dropdowns from data file, correct language
- Footer renders links from data file, correct language
- Language switcher shows current language
- Mobile navigation works (hamburger menu)
- User confirms visual correctness
- Test files cleaned up
</success_criteria>

<output>
After completion, create `.planning/phases/36-components/36-02-SUMMARY.md`
</output>
