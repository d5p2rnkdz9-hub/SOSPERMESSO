---
phase: 47-notion-cache
plan: 02
type: execute
wave: 2
depends_on: ["47-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Build time with warm cache is measurably faster than cold cache build"
    - "Editing one Notion page causes exactly 1 miss on next build"
    - "Build output HTML is identical whether served from cache or fresh fetch"
  artifacts: []
  key_links: []
---

<objective>
Verify the Notion cache works correctly by measuring build times and confirming selective re-fetching behavior.

Purpose: Confirm the cache delivers the expected performance improvement and that cached content produces identical HTML output to fresh fetches.

Output: Verified timing data and behavioral confirmation.
</objective>

<execution_context>
@/Users/albertopasquero/.claude/get-shit-done/workflows/execute-plan.md
@/Users/albertopasquero/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/47-notion-cache/47-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Measure build times and verify cache behavior</name>
  <files></files>
  <action>
Run the following measurements and record results:

1. **Cold build (no cache):**
   - Run `npm run cache:clear`
   - Run `time npm run build` and record total time
   - Note the cache line: should show "43 misses, 0 hits"
   - Verify `.notion-cache/blocks/` contains ~43 JSON files

2. **Warm build (full cache):**
   - Run `time npm run build` again immediately (no Notion changes)
   - Record total time
   - Note the cache line: should show "0 misses, 43 hits"
   - Compare times: warm should be noticeably faster (no 350ms delays, no API calls)

3. **Cache clear and rebuild:**
   - Run `npm run cache:clear`
   - Verify `.notion-cache/` directory is gone
   - Run `npm run build` — should show all misses again

Log all timing results. The expected improvement: cold build ~72s, warm build should be significantly faster since it skips 43 block fetches (each with 350ms delay = ~15s saved minimum).
  </action>
  <verify>
- Cold build completes and shows all misses
- Warm build completes faster and shows all hits
- Cache clear + rebuild shows all misses again
  </verify>
  <done>
- Build timing data recorded: cold vs warm
- Cache hit/miss behavior verified across 3 scenarios (cold, warm, post-clear)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Notion cache layer that skips unchanged page fetches during build</what-built>
  <how-to-verify>
1. Review the build timing data from Task 1
2. Run `npm run build` yourself and verify the cache hit/miss log line appears
3. Run `npm run cache:clear` and verify it works
4. Spot-check one permit page in `_site/` to confirm content is correct
5. If you want to test selective re-fetch: edit one permit in Notion, run build, check that only 1 miss appears
  </how-to-verify>
  <resume-signal>Type "approved" to mark Phase 47 complete, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Cold build timing recorded
2. Warm build timing recorded — measurably faster
3. Cache clear works cleanly
4. HTML output is correct (no content regression)
</verification>

<success_criteria>
- Warm build is faster than cold build (quantified)
- Cache behavior is correct: hits when unchanged, misses when changed or cleared
- User approves the implementation
</success_criteria>

<output>
After completion, create `.planning/phases/47-notion-cache/47-02-SUMMARY.md`
</output>
