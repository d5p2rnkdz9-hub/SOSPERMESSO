# Project State: SOS Permesso

**Last Updated:** 2026-02-17
**Status:** v3.2 — Phase 47-01 complete

## Project Reference

See: .planning/PROJECT.md (updated 2026-02-17)

**Core value:** Users can quickly find accurate, understandable information about their specific permit type and what documents they need for the Questura.

**Current focus:** v3.2 EN Translation Pipeline

## Current Position

**Current Milestone:** v3.2 EN Translation Pipeline
**Phase:** 47 of 50 (Notion Cache) — in progress
**Plan:** 1 of 2
**Status:** In progress
**Last activity:** 2026-02-17 — Completed 47-01-PLAN.md (Notion cache module)

```
Progress: [█░░░░░░░░░] 10%
```

(1 of ~8 plans across phases 47-50 complete)

## v3.2 Architecture Decisions

**Approach:** Same-pipeline (Path A)
- Notion response cache with `last_edited_time` — incremental builds for both IT and EN
- Translation happens offline via `npm run translate`, not during every build
- Translations written back to Notion as EN columns; 11ty reads them at build time
- Section-level hashing prevents re-translating unchanged Q&A sections
- EN pages generated by 11ty at `/en/` prefix (same templates as IT, parameterized by lang)

## Accumulated Context

### Decisions

- **v3.2-arch: notion-cache** — Cache Notion API responses locally with `last_edited_time` check; Phase 47
- **v3.2-arch: offline-translation** — `npm run translate` is a separate step, not part of every build
- **v3.2-arch: notion-en-columns** — EN translations written back to Notion DB as properties alongside IT
- **v3.2-arch: section-hashing** — Only re-translate sections whose Italian source text changed
- **47-01: cache-blocks-only** — Only cache blocks (not search results); search is fast, block fetching is the ~15s bottleneck
- **47-01: last_edited_time-string** — Compare last_edited_time with strict string !== to avoid timezone parsing edge cases
- **47-01: cache-safety-net** — If getBlocks() returns null despite index hit, re-fetch from Notion (guards against corrupted cache)

### Carried from v3.1

- Dizionario links need revision (deferred from v3.1)
- Content validation pass (deferred from v3.1)
- 3 unrecognized permits in DB (Tirocinio, Lavoro artistico, Sanatoria) — user to decide

### Blockers/Concerns

None. Cache infrastructure is in place. Phase 47-02 (if planned) can extend to documents.js.

## Session Continuity

**Last session:** 2026-02-17
**Stopped at:** Completed 47-01-PLAN.md — Notion cache module with 41 hits/0 misses on second build
**Resume file:** None

---

*This file is the single source of truth for project state. Update after every significant change.*
